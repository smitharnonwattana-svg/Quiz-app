<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Science Practice v30</title>
  <style>
    :root{--border:#e5e7eb;--muted:#6b7280;--bg:#f9fafb;--black:#111827;--ok:#16a34a;--warn:#f59e0b;}
    *{box-sizing:border-box;}
    html,body{margin:0;padding:0;}
    body{font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans Thai","Noto Sans","Liberation Sans";color:#111;background:#fff;}
    a{color:inherit;text-decoration:none;}
    .container{max-width:1200px;margin:0 auto;padding:24px;}
    .h1{font-size:22px;font-weight:900;margin:0;}
    .h2{font-size:16px;font-weight:900;margin:0;}
    .muted{color:var(--muted);font-size:12px;}
    .card{border:1px solid var(--border);border-radius:14px;background:#fff;}
    .linkCard{padding:16px;border:1px solid var(--border);border-radius:14px;background:#fff;display:block;cursor:pointer;}
    .linkCard:hover{background:var(--bg);}
    .btn{border:1px solid var(--border);background:#fff;padding:10px 12px;border-radius:12px;cursor:pointer;font-size:14px;font-family:inherit;}
    .btnPrimary{background:var(--black);border-color:var(--black);color:#fff;}
    .btn:disabled{opacity:.5;cursor:not-allowed;}
    .list{display:grid;gap:12px;margin-top:16px;}
    .tableWrap{overflow:auto;border:1px solid var(--border);border-radius:14px;margin-top:16px;}
    table{border-collapse:collapse;width:100%;font-size:13px;min-width:760px;}
    th,td{padding:10px 12px;border-top:1px solid var(--border);vertical-align:top;text-align:left;}
    thead th{background:var(--bg);border-top:none;position:sticky;top:0;z-index:1;}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);}
    .badge.ok{background:#dcfce7;border-color:#bbf7d0;color:#166534;}
    .badge.warn{background:#fffbeb;border-color:#fde68a;color:#92400e;}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .hr{height:1px;background:var(--border);margin:14px 0;}
    .toast{position:fixed;right:16px;bottom:16px;background:#111;color:#fff;padding:10px 12px;border-radius:12px;opacity:0;transform:translateY(8px);transition:.2s;font-size:13px;z-index:9999;}
    .toast.show{opacity:1;transform:translateY(0);}
    .page{display:none;}
    .page.active{display:block;}

    /* take page */
    /* Desktop layout */
    .takeRoot{height:100vh;width:100vw;overflow:hidden;}
    .takeGrid{height:100%;display:grid;grid-template-columns:8fr 2fr;}
    .takeLeft{border-right:1px solid var(--border);overflow:hidden;display:flex;flex-direction:column;}
    .takeRight{overflow:auto;-webkit-overflow-scrolling:touch;background:#fff;}
    .stickyBar{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border);padding:12px;display:flex;justify-content:space-between;align-items:center;gap:12px;}
    .choice{display:flex;align-items:center;justify-content:center;gap:0;border:2px solid var(--border);border-radius:10px;padding:8px 0;cursor:pointer;transition:all .15s;background:#fff;font-weight:900;font-size:15px;min-width:0;}
    .choice:hover{border-color:#9ca3af;background:#f9fafb;}
    .choice.active{border-color:var(--black);background:var(--black);color:#fff;}
    .gridNums{display:flex;flex-wrap:wrap;gap:6px;}
    .numBtn{width:34px;height:34px;padding:0;border-radius:8px;font-size:11px;font-weight:700;transition:all .12s;}
    .iframePdf{width:100%;height:calc(100vh - 56px);border:none;display:block;}
    .pdfWrapTake{flex:1;min-height:0;position:relative;display:flex;flex-direction:column;}
    .pdfOverlay{position:absolute;inset:56px 0 0 0;background:rgba(17,24,39,.65);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;padding:18px;}
    .pdfOverlayInner{background:#fff;border-radius:16px;padding:16px;max-width:420px;width:100%;border:1px solid var(--border);}
    .pdfOverlayInner .title{font-weight:900;font-size:16px;}
    .pdfOverlayInner .desc{margin-top:6px;color:var(--muted);font-size:13px;}
    .pdfOverlayInner .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;}
    .pdfOverlay.hide{display:none;}
    @keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}

    /* ‚ïê‚ïê DESKTOP: side-by-side ‚ïê‚ïê */
    @media (min-width: 901px) {
      .takeRoot{height:100vh;overflow:hidden;}
      .takeGrid{height:100%;display:grid;grid-template-columns:8fr 2fr;}
      .takeLeft{border-right:1px solid var(--border);overflow:hidden;display:flex;flex-direction:column;}
      .takeRight{overflow:auto;}
    }

    /* ‚ïê‚ïê MOBILE: PDF 80% top, controls 20% bottom ‚ïê‚ïê */
    @media (max-width: 900px) {
      /* takeRoot ‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
      .takeRoot{height:100vh;overflow:hidden;}
      .takeGrid{height:100%;display:flex;flex-direction:column;}

      /* PDF zone: 80% */
      .takeLeft{
        flex:0 0 80vh;
        height:80vh;
        border-right:none;
        border-bottom:2px solid var(--border);
        overflow:hidden;
        display:flex;flex-direction:column;
      }
      /* ‡∏ã‡πà‡∏≠‡∏ô title bar ‡∏ã‡πâ‡∏≤‡∏¢ (‡∏ä‡∏∑‡πà‡∏≠ exam + ‡πÄ‡∏ß‡∏•‡∏≤) ‚Äî ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
      .takeLeft .stickyBar{display:none;}

      /* Controls zone: 20vh fixed ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà ‡∏Å ‡∏Ç ‡∏Ñ ‡∏á + prev/unsure/next */
      .takeRight{
        flex:0 0 20vh;
        height:20vh;
        overflow:hidden;
        background:#fff;
        border-top:1px solid var(--border);
      }

      /* ‡∏ã‡πà‡∏≠‡∏ô stickyBar (‡∏Ç‡πâ‡∏≠/‡πÄ‡∏ß‡∏•‡∏≤/‡∏≠‡∏≠‡∏Å/‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö) */
      .takeRight .stickyBar{display:none !important;}

      /* ‡∏ã‡πà‡∏≠‡∏ô label "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö" ‡πÅ‡∏•‡∏∞ grid ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠ */
      .takeNumsWrap { display:none !important; }
      .takeRight > div > .muted { display:none !important; }

      /* content wrapper ‚Äî flex column ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á */
      .takeRight > div {
        padding:6px 10px !important;
        gap:5px !important;
        display:flex !important;
        flex-direction:column !important;
        justify-content:center !important;
        height:100%;
        box-sizing:border-box;
      }

      /* choice grid 2x2 ‡∏™‡∏π‡∏á‡∏û‡∏≠‡∏î‡∏µ */
      #takeChoices{
        gap:4px !important;
        flex:1;
        min-height:0;
      }
      .choice{
        padding:0 4px !important;
        font-size:15px !important;
        border-radius:10px !important;
        min-height:0 !important;
        height:100%;
        align-items:center;
        justify-content:center;
      }

      /* ‡∏õ‡∏∏‡πà‡∏° prev/unsure/next */
      #takePrevBtn,#takeUnsureBtn,#takeNextBtn{
        padding:3px 10px !important;
        font-size:11px !important;
        border-radius:8px !important;
      }

      /* pdfOverlay ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
      .pdfOverlay{position:fixed;inset:0;z-index:200;}

      /* review page */
      #reviewPdfViewer{min-height:300px;}
    }

    /* review page */
    .reviewLayout{display:grid;grid-template-columns:1fr 420px;gap:14px;align-items:start;}
    .examGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;margin-top:16px;}
    .examCard{background:#fff;border:1px solid var(--border);border-radius:16px;padding:18px;cursor:pointer;transition:all .15s;display:flex;flex-direction:column;gap:8px;}
    .examCard:hover{border-color:#6b7280;box-shadow:0 4px 16px rgba(0,0,0,.08);transform:translateY(-1px);}
    .examCard .subj{display:inline-block;background:#f3f4f6;border-radius:99px;padding:3px 10px;font-size:12px;font-weight:700;color:#374151;}
    .examCard .title{font-weight:900;font-size:15px;line-height:1.4;}
    .examCard .meta{display:flex;gap:12px;font-size:12px;color:var(--muted);margin-top:2px;}
    .examCard .score-badge{margin-top:6px;padding:6px 10px;background:#f9fafb;border-radius:8px;font-size:12px;border:1px solid var(--border);}
    @media(max-width:980px){.reviewLayout{grid-template-columns:1fr;}.reviewSide{position:static!important;}}
    .reviewPdfWrap{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:#fff;display:flex;flex-direction:column;height:90vh;}
    .reviewPdfBar{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);}
    .reviewSide{position:sticky;top:12px;}
    .reviewCard{border:1px solid var(--border);border-radius:16px;background:#fff;padding:12px;}
    .chips{display:flex;flex-wrap:wrap;gap:6px;}
    .chip{border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:#fff;cursor:pointer;font-family:inherit;}
    .chip.bad{border-color:#ef4444;color:#b91c1c;background:#fff5f5;}
    .chip.good{border-color:#22c55e;color:#166534;background:#f0fdf4;}
    .wrongText{font-size:15px;line-height:1.4;}
    .wrongText .label{color:#6b7280;}
    .wrongText .list{color:#b91c1c;font-weight:800;}
    .qListReview{display:flex;flex-direction:column;gap:10px;margin-top:12px;}
    .qItem{border:1px solid var(--border);border-radius:16px;padding:10px;}
    .qHead{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;}
    .qBadge{border-radius:999px;padding:4px 10px;font-weight:600;border:1px solid var(--border);}
    .qBadge.good{border-color:#22c55e;color:#166534;background:#f0fdf4;}
    .qBadge.bad{border-color:#ef4444;color:#b91c1c;background:#fff5f5;}
    .opts{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px;}
    @media(max-width:980px){.opts{grid-template-columns:1fr;}}
    .opt{border:1px solid var(--border);border-radius:14px;padding:10px;min-height:44px;display:flex;gap:10px;align-items:flex-start;}
    .optKey{width:26px;height:26px;border-radius:999px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-weight:700;flex:0 0 auto;}
    .opt.correct{border-color:#22c55e;background:#f0fdf4;}
    .opt.correct .optKey{border-color:#22c55e;color:#166534;}
    .opt.chosen.bad{border-color:#ef4444;background:#fff5f5;}
    .opt.chosen.bad .optKey{border-color:#ef4444;color:#b91c1c;}
    .opt.chosen.good{border-color:#22c55e;background:#f0fdf4;}
    .opt .tag{margin-left:auto;font-size:12px;font-weight:700;opacity:.9;}

    /* stats page */
    .stat-card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px 18px;display:flex;flex-direction:column;gap:4px;}
    .stat-card .sc-label{font-size:11px;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:.05em;}
    .stat-card .sc-value{font-size:26px;font-weight:900;color:#111;line-height:1.1;}
    .stat-card .sc-sub{font-size:12px;color:var(--muted);}
    .stat-card.accent{background:#111;border-color:#111;}
    .stat-card.accent .sc-label{color:#9ca3af;}
    .stat-card.accent .sc-value{color:#fff;}
    .stat-card.accent .sc-sub{color:#6b7280;}
    /* progress bar in table */
    .score-cell{display:flex;flex-direction:column;gap:4px;}
    .score-bar-wrap{height:4px;background:#e5e7eb;border-radius:99px;overflow:hidden;}
    .score-bar-fill{height:100%;border-radius:99px;transition:width .5s ease;}
    /* wrong top list */
    .wrong-row{display:flex;align-items:center;gap:8px;font-size:13px;}
    .wrong-rank{width:22px;height:22px;border-radius:99px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:11px;flex-shrink:0;}
    .wrong-rank.top3{background:#111;color:#fff;}
    .wrong-bar-wrap{flex:1;height:6px;background:#f3f4f6;border-radius:99px;overflow:hidden;}
    .wrong-bar-fill{height:100%;border-radius:99px;background:#ef4444;}
    .stats-table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed;}
    .stats-table th,.stats-table td{padding:14px 16px;vertical-align:top;border-top:1px solid #e9eef7;}
    .stats-table thead th{background:#fbfcff;font-weight:700;}
    .stats-table thead th:first-child{border-top-left-radius:18px;}
    .stats-table thead th:last-child{border-top-right-radius:18px;}
    .stats-table tbody tr:last-child td:first-child{border-bottom-left-radius:18px;}
    .stats-table tbody tr:last-child td:last-child{border-bottom-right-radius:18px;}
    .stats-table td small{display:block;color:#6b7280;margin-top:6px;word-break:break-all;}
    .btn-delete{border:1px solid rgba(239,68,68,.55);color:#b91c1c;background:#fff;border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:700;}
    .btn-delete:hover{background:rgba(239,68,68,.08);}
    .modal-overlay{position:fixed;inset:0;background:rgba(17,24,39,.55);display:none;align-items:center;justify-content:center;padding:18px;z-index:9999;}
    .modal-overlay.show{display:flex;}
    .modal{background:#fff;border-radius:18px;width:min(520px,96vw);padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.18);}
    .modal h3{margin:0 0 8px;font-size:18px;}
    .modal p{margin:0 0 14px;color:#4b5563;}
    .modal .mrow{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;}
    .btn-ghost{border:1px solid #e5e7eb;background:#fff;border-radius:999px;padding:10px 14px;cursor:pointer;font-weight:700;}
    .btn-danger{border:1px solid rgba(239,68,68,.55);background:#ef4444;color:#fff;border-radius:999px;padding:10px 14px;cursor:pointer;font-weight:800;}

    /* admin editor */
    textarea{width:100%;min-height:64px;resize:vertical;font-family:inherit;}
    input[type="number"]{width:72px;}
    .tableBox{overflow:auto;max-height:calc(100vh - 210px);}
    .bar2{padding:12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;background:#fff;}
    .rowActive{background:#f3f4f6;}
    .ctrls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .titleInput{min-width:260px;max-width:520px;width:38vw;padding:8px 10px;border:1px solid var(--border);border-radius:10px;font-family:inherit;}
    .correctBtns{display:flex;gap:4px;}
    .correctBtn{width:34px;height:30px;border:1px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;font-weight:700;font-size:13px;font-family:inherit;transition:all .12s;}
    .correctBtn:hover{border-color:#9ca3af;background:#f3f4f6;}
    .correctBtn.selected{background:var(--black);border-color:var(--black);color:#fff;}
  </style>
  <!-- PDF.js from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    // Setup PDF.js worker
    if(typeof pdfjsLib !== 'undefined'){
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
  </script>
</head>
<body>

<!-- ===================== PAGE: LOGIN ===================== -->
<div id="page-login" class="page active">
  <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#f0f4ff 0%,#fafafa 100%);">
    <div style="width:100%;max-width:360px;padding:24px;">
      <div style="text-align:center;margin-bottom:32px;">
        <div style="font-size:48px;margin-bottom:12px;">üéØ</div>
        <div style="font-size:24px;font-weight:900;color:#111827;">Science Practice</div>
        <div style="font-size:13px;color:#6b7280;margin-top:6px;">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 6 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
      </div>

      <div class="card" style="padding:28px;">
        <div style="margin-bottom:20px;">
          <label style="font-size:13px;font-weight:700;color:#374151;display:block;margin-bottom:8px;">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input id="loginPinInput" type="password" inputmode="numeric" maxlength="6"
            placeholder="‚óè ‚óè ‚óè ‚óè ‚óè ‚óè"
            style="width:100%;padding:14px;font-size:22px;text-align:center;letter-spacing:8px;border:2px solid #e5e7eb;border-radius:12px;outline:none;font-family:monospace;"
            oninput="this.value=this.value.replace(/[^0-9]/g,'')"
            onkeydown="if(event.key==='Enter') doLogin()"
          />
        </div>
        <div id="loginError" style="color:#dc2626;font-size:13px;text-align:center;margin-bottom:12px;min-height:18px;"></div>
        <button onclick="doLogin()" class="btn btnPrimary" style="width:100%;padding:14px;font-size:15px;font-weight:700;border-radius:12px;">
          ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚Üí
        </button>
      </div>

      <div style="text-align:center;margin-top:20px;font-size:11px;color:#9ca3af;">
        Nanont Exam System
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<!-- ===================== PAGE: HOME ===================== -->
<div id="page-home" class="page">
  <div class="container">
    <h1 class="h1">Science Practice</h1>
    <p class="muted" style="margin-top:8px;">‡πÄ‡∏î‡πÇ‡∏° HTML ‡∏•‡πâ‡∏ß‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ server/db) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ UI ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö</p>
    <div class="list">
      <div class="linkCard" onclick="navigate('exams')">
        <div style="font-weight:900;">1) ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</div>
        <div class="muted" style="margin-top:6px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥ (PDF + timer)</div>
      </div>
      <div class="linkCard" onclick="navigate('stats')">
        <div style="font-weight:900;">2) ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</div>
        <div class="muted" style="margin-top:6px;">‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage)</div>
      </div>
      <div class="linkCard" onclick="navigate('admin')">
        <div style="font-weight:900;">3) Admin</div>
        <div class="muted" style="margin-top:6px;">‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö + preview PDF + ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏£‡πá‡∏ß</div>
      </div>
      <div class="linkCard" onclick="navigate('entrance_stats')">
        <div style="font-weight:900;">4) ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏°.1</div>
        <div class="muted" style="margin-top:6px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö GATE/EPLUS ¬∑ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏™‡∏≠‡∏ö</div>
      </div>
    </div>
    <div class="hr"></div>
    <div class="muted">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏î‡πÇ‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå (localStorage) ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á Android ‡πÅ‡∏•‡∏∞ iOS</div>
  </div>
</div>

<!-- ===================== PAGE: EXAMS ===================== -->
<div id="page-exams" class="page">
  <div class="container">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h1>
        <div class="muted" style="margin-top:6px;">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥</div>
      </div>
      <button class="btn" onclick="navigate('home')">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
    <div class="card" style="padding:12px;margin-top:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
      <span class="muted">‡∏ß‡∏¥‡∏ä‡∏≤</span>
      <select id="examsSubjFilter" class="btn" style="padding:10px 12px;min-width:240px;"></select>
    </div>
    <div id="examsList" class="list"></div>
  </div>
</div>

<!-- ===================== PAGE: EXAM DETAIL ===================== -->
<div id="page-exam" class="page">
  <div class="container" style="max-width:900px;">
    <div id="examDetailWrap"></div>
    <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;">
      <button class="btn" onclick="navigate('exams')">‡∏Å‡∏•‡∏±‡∏ö</button>
      <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
  </div>
</div>

<!-- ===================== PAGE: TAKE ===================== -->
<div id="page-take" class="page">
  <div class="takeRoot">
    <div class="takeGrid">
      <div class="takeLeft">
        <div class="stickyBar">
          <div>
            <div id="takeExamTitle" style="font-weight:900;">Exam</div>
            <div class="muted" id="takePdfPage">PDF ‡∏´‡∏ô‡πâ‡∏≤ -</div>
          </div>
          <div style="font-weight:900;">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <span id="takeTimer">--:--</span></div>
        </div>
        <div class="pdfWrapTake">
          <div id="takePdfViewer" style="width:100%;height:100%;position:relative;flex:1;min-height:0;"></div>

        </div>
      </div>
      <div class="takeRight">
        <div class="stickyBar">
          <div>
            <div style="font-weight:900;">‡∏Ç‡πâ‡∏≠ <span id="takeQNo">-</span> / <span id="takeQTotal">-</span></div>
            <div class="muted">‡πÄ‡∏ß‡∏•‡∏≤ <span id="takeTimer2">--:--</span></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
            <button class="btn" id="takeExitBtn" style="padding:8px 12px;">‡∏≠‡∏≠‡∏Å</button>
            <button class="btn btnPrimary" id="takeSubmitBtn" disabled>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
          </div>
        </div>
        <div style="padding:12px;display:grid;gap:10px;">
          <div class="muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</div>
          <div id="takeChoices" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;"></div>
          <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center;">
            <button class="btn" id="takePrevBtn" style="padding:6px 10px;font-size:12px;">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
            <button class="btn" id="takeUnsureBtn" style="padding:6px 10px;font-size:12px;">‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à</button>
            <button class="btn" id="takeNextBtn" style="padding:6px 10px;font-size:12px;">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
          </div>
          <div class="takeNumsWrap" style="margin-top:6px;">
            <div class="muted" style="margin-bottom:8px;">‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠</div>
            <div id="takeNums" class="gridNums"></div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===================== PAGE: REVIEW ===================== -->
<div id="page-review" class="page">
  <div class="container" style="max-width:1200px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;margin:14px 0 10px;">
      <div>
        <div style="font-size:26px;font-weight:800;" id="reviewTitle">‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</div>
        <div class="muted" id="reviewSub"></div>
      </div>
      <div style="display:flex;gap:10px;align-items:center;">
        <button class="btn" onclick="navigate('stats')">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
        <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      </div>
    </div>
    <div class="reviewLayout">
      <div class="reviewPdfWrap">
        <div class="reviewPdfBar">
          <div style="font-weight:700;" id="reviewPdfLabel">PDF</div>
          <div class="muted" style="font-size:12px;">(‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡πÉ‡∏ô PDF ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)</div>
        </div>
        <div id="reviewPdfViewer" style="width:100%;flex:1;min-height:400px;position:relative;"></div>
      </div>
      <div class="reviewSide" style="position:sticky;top:12px;">
        <div class="reviewCard">
          <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;">
            <div>
              <div style="font-weight:800;" id="reviewScore">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô -/-</div>
              <div class="muted" id="reviewMeta"></div>
              <div style="margin-top:6px;font-weight:700;" id="reviewSummaryLine"></div>
            </div>
            <button class="btn" id="reviewScrollTop">‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô</button>
          </div>
          <div style="margin-top:10px;">
            <div id="reviewWrongListText" class="wrongText"></div>
          </div>
        </div>
        <div class="reviewCard" style="margin-top:12px;">
          <div class="muted" style="margin-bottom:6px;">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠</div>
          <div class="chips" id="reviewNavChips"></div>
        </div>

      </div>
    </div>
    <div class="qListReview" id="reviewQList"></div>
  </div>
</div>

<!-- ===================== PAGE: ENTRANCE STATS ===================== -->
<!-- ===================== PAGE: ENTRANCE STATS (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô) ===================== -->
<div id="page-entrance_stats" class="page">
  <div class="container" style="max-width:800px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏°.1</h1>
        <div class="muted" style="margin-top:6px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏™‡∏≠‡∏ö</div>
      </div>
      <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
    <div class="list" style="margin-top:24px;" id="esSchoolList"></div>
  </div>
</div>

<!-- ===================== PAGE: ENTRANCE PROGRAM (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°) ===================== -->
<div id="page-entrance_program" class="page">
  <div class="container" style="max-width:800px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1" id="epSchoolTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</h1>
        <div class="muted" id="epSchoolSub" style="margin-top:6px;"></div>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn" onclick="navigate('entrance_stats')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      </div>
    </div>
    <div class="list" style="margin-top:24px;" id="epProgramList"></div>
  </div>
</div>

<!-- ===================== PAGE: ENTRANCE YEAR (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ + ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥) ===================== -->
<div id="page-entrance_year" class="page">
  <div class="container" style="max-width:1100px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1" id="eyTitle">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h1>
        <div class="muted" id="eySub" style="margin-top:6px;"></div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
        <button class="btn btnPrimary" id="eyCompareBtnTop" onclick="navigate('entrance_compare')">üéØ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏™‡∏≠‡∏ö</button>
        <button class="btn" id="eyBackBtn">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      </div>
    </div>

    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ -->
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:20px;" id="eyYearTabs"></div>

    <!-- Overview cards -->
    <div id="esOverviewCards" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px;margin-top:16px;"></div>

    <!-- ‡∏Å‡∏£‡∏≤‡∏ü + ‡πÄ‡∏Å‡∏ì‡∏ë‡πå -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
      <div class="card" style="padding:16px;">
        <div style="font-weight:800;margin-bottom:4px;">üìä Distribution ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
        <div class="muted" style="font-size:11px;margin-bottom:10px;">‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡πâ‡∏á = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö &nbsp;|&nbsp; ‡πÅ‡∏Å‡∏ô‡∏ô‡∏≠‡∏ô = ‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° (‡πÄ‡∏ï‡πá‡∏° 1,000)</div>
        <canvas id="esDistChart" style="width:100%;"></canvas>
        <div id="esDistEmpty" class="muted" style="display:none;font-size:13px;padding:8px 0;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      </div>
      <div class="card" style="padding:16px;">
        <div style="font-weight:800;margin-bottom:10px;">‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        <div id="esCriteria"></div>
      </div>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö -->
    <div class="card" style="padding:16px;margin-top:16px;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:12px;">
        <div style="font-weight:800;">üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</div>
        <input id="esRankSearch" class="btn" style="text-align:left;padding:8px 12px;width:160px;font-size:13px;border-radius:10px;" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö..."/>
      </div>
      <div class="tableWrap"><table id="esRankTable"><thead id="esRankHead"></thead><tbody id="esRankBody"></tbody></table></div>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏° compare ‡∏•‡πà‡∏≤‡∏á -->
    <div style="margin-top:20px;text-align:center;">
      <button class="btn btnPrimary" style="padding:14px 32px;font-size:15px;" onclick="navigate('entrance_compare')">üéØ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Üí</button>
    </div>
  </div>
</div>

<!-- ===================== PAGE: ENTRANCE COMPARE ===================== -->
<div id="page-entrance_compare" class="page">
  <div class="container" style="max-width:860px;">
    <!-- Header -->
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1">üéØ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏™‡∏≠‡∏ö</h1>
        <div class="muted" style="margin-top:6px;">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå</div>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn" id="ecBackBtn">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      </div>
    </div>

    <!-- Program tabs -->
    <div style="display:flex;gap:10px;margin-top:20px;" id="ecProgTabs"></div>

    <!-- Active program area -->
    <div id="ecActiveSection" style="margin-top:20px;"></div>

    <!-- ‡∏ú‡∏•‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö -->
    <!-- Overview Chart -->
    <div id="ecOverviewWrap" style="margin-top:24px;" class="card" style="padding:20px;"></div>
    <!-- Individual results -->
    <div style="margin-top:12px;font-weight:900;font-size:15px;margin-bottom:8px;" id="ecResultsTitle"></div>
    <div id="ecCompareResults" style="display:grid;gap:14px;"></div>

    <!-- ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°/ranking -->
    <div class="hr" style="margin:28px 0;"></div>
    <div id="ecOverviewChart" style="margin-bottom:32px;"></div>
  </div>
</div>


<!-- ===================== PAGE: ADMIN BENCHMARK ===================== -->
<div id="page-admin_benchmark" class="page">
  <div class="container" style="max-width:1000px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1">üìä ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Benchmark</h1>
        <div class="muted" style="margin-top:6px;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏à‡∏£‡∏¥‡∏á</div>
      </div>
      <button class="btn" onclick="navigate('admin')">‡∏Å‡∏•‡∏±‡∏ö Admin</button>
    </div>

    <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á benchmark ‡πÉ‡∏´‡∏°‡πà -->
    <div class="card" style="padding:20px;margin-top:20px;display:grid;gap:14px;">
      <div style="font-weight:900;font-size:15px;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° Benchmark ‡πÉ‡∏´‡∏°‡πà</div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <label style="display:grid;gap:6px;">
          <span style="font-weight:700;font-size:13px;">‡∏ä‡∏∑‡πà‡∏≠ Benchmark</span>
          <input id="bmName" class="btn" style="text-align:left;padding:10px 12px;border-radius:12px;" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö 67 - ‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á" />
        </label>
        <label style="display:grid;gap:6px;">
          <span style="font-weight:700;font-size:13px;">‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö <span class="muted">(‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</span></span>
          <select id="bmExamLink" class="btn" style="padding:10px 12px;border-radius:12px;"></select>
        </label>
      </div>

      <div style="border:2px dashed var(--border);border-radius:12px;padding:16px;background:#f9fafb;display:grid;gap:8px;">
        <div style="font-weight:700;font-size:13px;">üìÇ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Excel</div>
        <div class="muted" style="font-size:12px;line-height:1.7;">
          ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å = <b>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</b> ¬∑ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà 2 = <b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</b> ¬∑ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ = <b>‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</b> (‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ match ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)<br>
          ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô header ‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô: ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö | ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° | ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå | ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå
        </div>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
          <button class="btn" id="bmDownloadTemplate">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template</button>
          <label class="btn" style="cursor:pointer;">
            üìÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel
            <input id="bmExcelFile" type="file" accept=".xlsx,.xls,.csv" style="display:none;" />
          </label>
          <span id="bmExcelStatus" class="muted" style="font-size:12px;"></span>
        </div>
        <div id="bmPreview" style="display:none;padding:8px 12px;background:#dcfce7;border-radius:8px;font-size:12px;color:#166534;font-weight:700;"></div>
      </div>

      <button class="btn btnPrimary" id="bmSaveBtn" style="width:fit-content;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Benchmark</button>
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ benchmarks -->
    <h2 class="h2" style="margin-top:24px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Benchmark</h2>
    <div id="bmList" style="margin-top:12px;display:grid;gap:10px;"></div>
  </div>
</div>


<!-- ===================== PAGE: STATS ===================== -->
<div id="page-stats" class="page">
  <div class="container">

    <!-- header -->
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h1>
        <div class="muted">‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Cloud (sync ‡∏ó‡∏∏‡∏Å device ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        <button class="btn btnPrimary" onclick="navigate('exams')">‡πÑ‡∏õ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
      </div>
    </div>

    <!-- ‚ë† Summary cards -->
    <div id="statsSummaryCards" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:20px;"></div>

    <!-- ‚ë° ‡∏Å‡∏£‡∏≤‡∏ü + TOP10 -->
    <div style="display:grid;grid-template-columns:1fr 340px;gap:14px;margin-top:16px;align-items:start;" id="statsChartsRow">
      <div class="card" style="padding:16px;">
        <div style="font-weight:800;font-size:14px;margin-bottom:12px;">üìà ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        <canvas id="statsChart" height="160" style="width:100%;display:block;"></canvas>
        <div id="statsChartEmpty" class="muted" style="display:none;text-align:center;padding:24px 0;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      </div>
      <div class="card" style="padding:16px;">
        <div style="font-weight:800;font-size:14px;margin-bottom:12px;">‚ùå ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏ö‡πà‡∏≠‡∏¢‡∏™‡∏∞‡∏™‡∏° TOP 10</div>
        <div id="statsWrongTop" style="display:grid;gap:6px;"></div>
        <div id="statsWrongTopEmpty" class="muted" style="display:none;text-align:center;padding:24px 0;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      </div>
    </div>
    <style>
      @media(max-width:760px){ #statsChartsRow{grid-template-columns:1fr;} }
    </style>

    <!-- ‚ë¢ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
    <div class="card" style="padding:16px;margin-top:16px;">
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
          <span class="muted" style="white-space:nowrap;">‡∏ß‡∏¥‡∏ä‡∏≤</span>
          <select id="statsFilterSubject" class="btn" style="padding:10px 12px;min-width:200px;"><option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option></select>
          <span class="muted" style="white-space:nowrap;">‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</span>
          <select id="statsFilterExam" class="btn" style="padding:10px 12px;min-width:240px;"><option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option></select>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
          <button id="statsBtnExport" class="btn btnPrimary">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
          <label class="btn">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥<input id="statsFileImport" type="file" accept=".xlsx" style="display:none;" /></label>
          <button id="statsBtnClear" class="btn">‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
        </div>
      </div>
      <div style="overflow:auto;">
        <table class="stats-table" style="min-width:860px;">
          <thead>
            <tr>
              <th style="width:50px;">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</th>
              <th style="width:180px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</th>
              <th style="width:140px;">‡∏ú‡∏π‡πâ‡∏ó‡∏≥</th>
              <th style="width:120px;">‡∏ß‡∏¥‡∏ä‡∏≤</th>
              <th>‡∏ä‡∏∏‡∏î</th>
              <th style="width:160px;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
              <th style="width:100px;">‡πÄ‡∏ß‡∏•‡∏≤</th>
              <th style="width:110px;"></th>
            </tr>
          </thead>
          <tbody id="statsRows">
            <tr><td colspan="8" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div id="statsConfirmOverlay" class="modal-overlay" role="dialog">
    <div class="modal">
      <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
      <p id="statsConfirmText">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°</p>
      <div class="mrow">
        <button id="statsConfirmCancel" class="btn-ghost">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="statsConfirmOk" class="btn-danger">‡∏•‡∏ö</button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== PAGE: ADMIN ===================== -->
<div id="page-admin" class="page">
  <div class="container">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1">Admin</h1>
        <div class="muted" style="margin-top:6px;">‡πÄ‡∏î‡πÇ‡∏°‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° login/logout ‡∏à‡∏≥‡∏•‡∏≠‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏à‡∏£‡∏¥‡∏á)</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        <button class="btn" id="adminLoginBtn">Login</button>
        <button class="btn" id="adminLogoutBtn">Logout</button>
      </div>
    </div>
    <div id="adminGate" style="margin-top:16px;"></div>
    <div id="adminContent" style="display:none;">
      <div class="list" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="linkCard" onclick="navigate('admin_new')">
          <div style="font-weight:900;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</div>
          <div class="muted" style="margin-top:6px;">‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ß‡∏•‡∏≤/pdfUrl</div>
        </div>
        <div class="linkCard" onclick="navigate('admin_benchmark')">
          <div style="font-weight:900;">üìä ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Benchmark</div>
          <div class="muted" style="margin-top:6px;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
        </div>
      </div>
      <h2 class="h2" style="margin-top:16px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2>
      <div class="card" style="padding:12px;margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
        <span class="muted">‡∏ß‡∏¥‡∏ä‡∏≤</span>
        <select id="adminSubjFilter" class="btn" style="padding:10px 12px;min-width:240px;"></select>
      </div>
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î</th>
              <th style="width:160px;">‡∏ß‡∏¥‡∏ä‡∏≤</th>
              <th style="width:120px;">‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
              <th style="width:160px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th style="width:70px;">‡∏Ç‡πâ‡∏≠</th>
              <th style="width:150px;">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</th>
              <th>PDF URL</th>
              <th style="width:110px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
              <th style="width:70px;">‡∏•‡∏ö</th>
            </tr>
          </thead>
          <tbody id="adminTbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ===================== PAGE: ADMIN NEW ===================== -->
<div id="page-admin_new" class="page">
  <div class="container" style="max-width:900px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</h1>
        <div class="muted" style="margin-top:6px;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÉ‡∏ô localStorage</div>
      </div>
      <button class="btn" onclick="navigate('admin')">‡∏Å‡∏•‡∏±‡∏ö Admin</button>
    </div>
    <div class="card" style="padding:16px;margin-top:16px;display:grid;gap:10px;">
      <label style="display:grid;gap:6px;">
        <span style="font-weight:900;">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</span>
        <input id="newTitle" style="padding:12px;border:1px solid var(--border);border-radius:12px;font-family:inherit;" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà 2" />
      </label>
      <label style="display:grid;gap:6px;">
        <span style="font-weight:900;">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</span>
        <input id="newSubject" style="padding:12px;border:1px solid var(--border);border-radius:12px;font-family:inherit;" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå / ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" />
      </label>
      <div class="grid2">
        <label style="display:grid;gap:6px;">
          <span style="font-weight:900;">‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ)</span>
          <input id="newMinutes" type="number" min="1" value="45" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;font-family:inherit;" />
        </label>
        <label style="display:grid;gap:6px;">
          <span style="font-weight:900;">‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</span>
          <select id="newPublished" style="padding:12px;border:1px solid var(--border);border-radius:12px;font-family:inherit;">
            <option value="true">‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</option>
            <option value="false">‡∏ã‡πà‡∏≠‡∏ô</option>
          </select>
        </label>
      </div>
      <label style="display:grid;gap:6px;">
        <span style="font-weight:900;">PDF URL</span>
        <input id="newPdfUrl" value="./pdfs/science_sample.pdf" style="padding:12px;border:1px solid var(--border);border-radius:12px;font-family:inherit;" />
        <span class="muted">‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà Google Drive /preview link</span>
      </label>
      <label style="display:grid;gap:6px;">
        <span style="font-weight:900;">‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î PDF ‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</span>
        <input id="newPdfFile" type="file" accept="application/pdf" style="padding:12px;border:1px dashed var(--border);border-radius:12px;background:#fff;" />
        <span class="muted">‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå (IndexedDB) ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</span>
      </label>
      <div style="display:grid;gap:6px;">
        <span style="font-weight:900;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠</span>
        <input id="newQCount" type="number" min="1" max="999" value="50" style="width:200px;padding:12px;border:1px solid var(--border);border-radius:12px;font-family:inherit;" />
        <span class="muted">‡πÅ‡∏Å‡πâ‡∏´‡∏ô‡πâ‡∏≤ PDF / ‡πÄ‡∏â‡∏•‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô Editor</span>
      </div>
      <!-- hidden: ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô JS ‡∏≠‡∏¢‡∏π‡πà -->
      <input id="newCreatePlaceholder" type="checkbox" checked style="display:none;" />
      <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏•‡∏¢‡∏à‡∏≤‡∏Å Excel -->
      <div style="border:2px dashed var(--border);border-radius:12px;padding:16px;background:#f9fafb;display:grid;gap:8px;">
        <div style="font-weight:900;">üìä ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏•‡∏¢‡∏à‡∏≤‡∏Å Excel <span class="muted" style="font-size:12px;font-weight:400;">(‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</span></div>
        <div class="muted" style="font-size:12px;line-height:1.7;">
          ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå <b>A = ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà</b> ¬∑ <b>B = ‡∏´‡∏ô‡πâ‡∏≤ PDF</b> ¬∑ <b>C = ‡πÄ‡∏â‡∏•‡∏¢</b> (‡∏Å/‡∏Ç/‡∏Ñ/‡∏á ‡∏´‡∏£‡∏∑‡∏≠ A/B/C/D)<br>
          ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô header ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        </div>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
          <button type="button" class="btn" id="newDownloadTemplate" style="gap:6px;">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template</button>
          <label class="btn" style="cursor:pointer;">
            üìÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel / CSV
            <input id="newExcelFile" type="file" accept=".xlsx,.xls,.csv" style="display:none;" />
          </label>
          <span id="newExcelStatus" class="muted" style="font-size:12px;"></span>
        </div>
        <div id="newExcelPreview" style="display:none;padding:8px 12px;background:#dcfce7;border-radius:8px;font-size:12px;color:#166534;font-weight:700;"></div>
      </div>

      <button class="btn btnPrimary" id="newCreateBtn" style="width:fit-content;">‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
    </div>
  </div>
</div>

<!-- ===================== PAGE: ADMIN EDITOR ===================== -->
<div id="page-admin_editor" class="page">
  <div class="container" style="max-width:1400px;">
    <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 class="h1" id="editorTitle">Editor</h1>
        <div class="muted" id="editorMeta" style="margin-top:6px;"></div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn" onclick="navigate('admin')">‡∏Å‡∏•‡∏±‡∏ö Admin</button>
        <button class="btn" onclick="navigate('home')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      </div>
    </div>
    <div style="margin-top:16px;">
      <div class="card">
        <div class="bar2">
          <div class="ctrls" style="gap:14px;flex-wrap:wrap;align-items:flex-end;">
            <div style="display:flex;flex-direction:column;gap:4px;">
              <div style="font-size:13px;font-weight:800;">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</div>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <input id="editorExamTitle" class="titleInput" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö" />
                <button class="btn" id="editorRenameBtn" type="button">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠</button>
              </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:4px;">
              <div style="font-size:13px;font-weight:800;">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</div>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <input id="editorExamSubject" class="titleInput" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" />
                <button class="btn" id="editorSubjectBtn" type="button">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤</button>
              </div>
              <div class="muted" style="font-size:12px;">‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</div>
            </div>

          </div>
          <div class="ctrls">
            <!-- hidden: ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô JS ‡∏≠‡∏¢‡∏π‡πà -->
            <input id="editorFast" type="checkbox" checked style="display:none;" />
            <button type="button" class="btn" id="editorDownloadTemplate">‚¨áÔ∏è Template Excel</button>
            <label class="btn" style="cursor:pointer;" title="‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: A=‡∏Ç‡πâ‡∏≠, B=‡∏´‡∏ô‡πâ‡∏≤PDF, C=‡πÄ‡∏â‡∏•‡∏¢(‡∏Å/‡∏Ç/‡∏Ñ/‡∏á)">
              üìä ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏¢ Excel
              <input id="editorExcelFile" type="file" accept=".xlsx,.xls,.csv" style="display:none;" />
            </label>
            <span id="editorExcelStatus" class="muted" style="font-size:12px;"></span>
            <button class="btn btnPrimary" id="editorSave">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          </div>
        </div>
        <div id="editorMsg" class="muted" style="padding:12px;display:none;"></div>
        <div class="tableBox">
          <table style="min-width:300px;">
            <thead>
              <tr>
                <th style="width:56px;">‡∏Ç‡πâ‡∏≠</th>
                <th style="width:100px;">‡∏´‡∏ô‡πâ‡∏≤ PDF</th>
                <th style="width:120px;">‡πÄ‡∏â‡∏•‡∏¢</th>
              </tr>
            </thead>
            <tbody id="editorTbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ===================== PDF VIEWER (PDF.js) =====================
// Single-page viewer ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å browser/OS
const PdfViewer = (() => {
  function create(containerId) {
    let pdfDoc = null;
    let currentUrl = null;
    let pageCanvases = []; // ‡πÄ‡∏Å‡πá‡∏ö canvas ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤

    const container = document.getElementById(containerId);
    container.style.cssText = 'width:100%;height:100%;background:#525659;display:flex;flex-direction:column;overflow:hidden;';

    // Scroll area ‚Äî render ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡πâ scroll ‡πÑ‡∏î‡πâ
    const scrollArea = document.createElement('div');
    scrollArea.style.cssText = 'flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding:8px 8px 24px;display:flex;flex-direction:column;gap:8px;align-items:center;';

    const statusDiv = document.createElement('div');
    statusDiv.style.cssText = 'color:#ccc;font-size:13px;padding:40px 20px;text-align:center;';
    statusDiv.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î PDF...';
    scrollArea.appendChild(statusDiv);
    container.appendChild(scrollArea);

    async function renderAllPages() {
      if (!pdfDoc) return;
      scrollArea.innerHTML = '';
      pageCanvases = [];

      // ‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤ container ‡∏à‡∏∞‡∏°‡∏µ width ‡∏à‡∏£‡∏¥‡∏á‡πÜ (max 20 ‡∏£‡∏≠‡∏ö = ~333ms)
      let waitCount = 0;
      while ((scrollArea.clientWidth || container.clientWidth) < 10 && waitCount < 20) {
        await new Promise(r => requestAnimationFrame(r));
        waitCount++;
      }

      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      const containerWidth = Math.max(scrollArea.clientWidth || container.clientWidth || 0, 10) - 16;
      if (containerWidth < 10) {
        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ width ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤ element ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà ‚Äî retry ‡∏´‡∏•‡∏±‡∏á 300ms
        await new Promise(r => setTimeout(r, 300));
      }

      for (let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {
        const wrapper = document.createElement('div');
        wrapper.id = `${containerId}-page-${pageNum}`;
        wrapper.style.cssText = 'width:100%;display:flex;flex-direction:column;align-items:center;gap:4px;';

        const label = document.createElement('div');
        label.style.cssText = 'color:#aaa;font-size:11px;padding:4px 0 2px;';
        label.textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${pageNum} / ${pdfDoc.numPages}`;

        const canvas = document.createElement('canvas');
        canvas.style.cssText = 'max-width:100%;border-radius:4px;box-shadow:0 2px 12px rgba(0,0,0,0.5);background:#fff;display:block;';

        wrapper.appendChild(label);
        wrapper.appendChild(canvas);
        scrollArea.appendChild(wrapper);
        pageCanvases[pageNum] = canvas;

        try {
          const page = await pdfDoc.getPage(pageNum);
          const viewport = page.getViewport({ scale: 1 });
          // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ width ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
          const w = scrollArea.clientWidth > 16 ? scrollArea.clientWidth - 16 : containerWidth;
          const scale = (w / viewport.width) * dpr;
          const scaledVp = page.getViewport({ scale });
          canvas.width = scaledVp.width;
          canvas.height = scaledVp.height;
          canvas.style.width = Math.round(scaledVp.width / dpr) + 'px';
          canvas.style.height = Math.round(scaledVp.height / dpr) + 'px';
          const ctx = canvas.getContext('2d');
          // PDF.js render ‡∏ó‡∏µ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‚Äî ‡πÉ‡∏ä‡πâ await ‡πÄ‡∏û‡∏∑‡πà‡∏≠ sequential
          await page.render({ canvasContext: ctx, viewport: scaledVp }).promise;
          // cleanup page object ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î memory
          page.cleanup();
        } catch(e) {
          console.warn(`Page ${pageNum} render error:`, e);
          canvas.style.display = 'none';
          const err = document.createElement('div');
          err.style.cssText = 'color:#f88;font-size:12px;padding:8px;background:rgba(0,0,0,0.3);border-radius:6px;margin:4px;';
          err.textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${pageNum}: ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${e?.message||e})`;
          wrapper.appendChild(err);
        }
      }
    }

    // Scroll ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà re-render
    function scrollToPage(pageNum) {
      const el = document.getElementById(`${containerId}-page-${pageNum}`);
      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // ‡∏î‡∏∂‡∏á Google Drive File ID ‡∏à‡∏≤‡∏Å URL ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ
    function getGDriveFileId(url) {
      if (!url) return null;
      const m1 = url.match(/drive\.google\.com\/file\/d\/([^/?#]+)/);
      if (m1) return m1[1];
      const m2 = url.match(/[?&]id=([^&]+)/);
      if (m2 && url.includes('drive.google.com')) return m2[1];
      return null;
    }

    // ‡πÅ‡∏™‡∏î‡∏á Google Drive PDF ‡∏ú‡πà‡∏≤‡∏ô iframe embed (‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á CORS ‡πÑ‡∏î‡πâ)
    function loadGDriveEmbed(fileId) {
      // reset container ‡πÄ‡∏õ‡πá‡∏ô block ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÉ‡∏´‡πâ iframe ‡πÉ‡∏ä‡πâ height ‡∏à‡∏≤‡∏Å CSS ‡∏Ç‡∏≠‡∏á #takePdfViewer
      container.style.cssText = 'width:100%;height:100%;background:#525659;display:block;overflow:hidden;';
      scrollArea.style.cssText = 'width:100%;height:100%;padding:0;overflow:hidden;display:block;';
      scrollArea.innerHTML = '';
      const iframe = document.createElement('iframe');
      iframe.src = `https://drive.google.com/file/d/${fileId}/preview`;
      iframe.allow = 'autoplay';
      iframe.style.cssText = 'width:100%;height:100%;border:none;display:block;';
      scrollArea.appendChild(iframe);
    }

    async function loadUrl(url, page) {
      page = page || 1;
      scrollArea.innerHTML = '';
      scrollArea.appendChild(statusDiv);
      statusDiv.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î PDF...';
      pageCanvases = [];
      currentUrl = url;
      pdfDoc = null;

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Google Drive URL ‚Äî ‡πÉ‡∏ä‡πâ iframe embed ‡πÅ‡∏ó‡∏ô PDF.js (‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î CORS)
      const gdriveId = getGDriveFileId(url);
      if (gdriveId) {
        loadGDriveEmbed(gdriveId);
        return;
      }

      // URL ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‚Äî ‡πÉ‡∏ä‡πâ PDF.js render
      try {
        if (typeof pdfjsLib === 'undefined') throw new Error('PDF.js ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä');

        // ‡πÅ‡∏õ‡∏•‡∏á relative path ‡πÄ‡∏õ‡πá‡∏ô absolute
        let absUrl = url;
        if (!url.startsWith('blob:') && !url.startsWith('http') && !url.startsWith('data:')) {
          absUrl = new URL(url, window.location.href).href;
        }

        statusDiv.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á render PDF...';
        pdfDoc = await pdfjsLib.getDocument({
          url: absUrl,
          cMapUrl: 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/cmaps/',
          cMapPacked: true,
        }).promise;
        await renderAllPages();
        setTimeout(() => scrollToPage(page), 150);
      } catch(e) {
        console.error('loadUrl error', e);
        const msg = e?.message || String(e);
        let hint = '';
        if (msg.includes('Invalid PDF') || msg.includes('structure')) {
          hint = '<br><small style="color:#faa;">üí° ‡∏•‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î PDF ‡πÉ‡∏´‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Admin</small>';
        } else if (msg.includes('404') || msg.includes('403')) {
          hint = '<br><small style="color:#faa;">üí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞ PDF ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</small>';
        }
        scrollArea.innerHTML = `<div style="color:#f88;padding:20px;font-size:13px;line-height:1.8;">‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î PDF ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<br><code style="font-size:11px;opacity:.7;">${msg}</code>${hint}</div>`;
      }
    }

    // setPage ‡πÅ‡∏Ñ‡πà scroll ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á re-render
    async function setPage(page) {
      if (!pdfDoc) return;
      scrollToPage(page);
    }

    return { loadUrl, setPage };
  }

  return { create };
})();

// ===================== FIREBASE SYNC =====================
const FirebaseSync = (() => {
  const CFG = {
    apiKey: "AIzaSyArMMqFEN4SuJGA_GxoCAvcn-_8kTm9yU0",
    authDomain: "nanont-exam.firebaseapp.com",
    projectId: "nanont-exam",
    storageBucket: "nanont-exam.firebasestorage.app",
    messagingSenderId: "693537085236",
    appId: "1:693537085236:web:862dcb5af879787450b761"
  };

  let db = null, _ready = false, _statusEl = null;

  function init() {
    try {
      if (!window.firebase) { console.warn('[FB] SDK not loaded'); return; }
      if (!firebase.apps.length) firebase.initializeApp(CFG);
      db = firebase.firestore();
      // Enable offline persistence (works on mobile too)
      db.enablePersistence({ synchronizeTabs: true }).catch(e => {
        if (e.code !== 'failed-precondition' && e.code !== 'unimplemented')
          console.warn('[FB] persistence err', e);
      });
      _ready = true;
      setStatus('online', '‚òÅÔ∏è sync ‡∏û‡∏£‡πâ‡∏≠‡∏°');
      console.log('[FB] ready');
    } catch(e) { console.warn('[FB] init err', e); setStatus('offline', 'üì¥ offline (local only)'); }
  }

  function setStatus(state, txt) {
    if (!_statusEl) _statusEl = document.getElementById('fbSyncStatus');
    if (_statusEl) {
      _statusEl.textContent = txt;
      _statusEl.style.color = state==='online'?'#16a34a':state==='saving'?'#f59e0b':state==='error'?'#dc2626':'#9ca3af';
    }
  }

  function _doc(id) { return db.collection('app').doc(id); }

  // Write to Firestore
  async function saveDoc(id, data) {
    if (!_ready) return false;
    try {
      setStatus('saving', 'üíæ ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...');
      await _doc(id).set({ _d: JSON.stringify(data), _ts: Date.now() });
      setStatus('online', '‚òÅÔ∏è sync ‡πÅ‡∏•‡πâ‡∏ß ' + new Date().toLocaleTimeString('th'));
      return true;
    } catch(e) { console.warn('[FB] save err', e); setStatus('error', '‚ö†Ô∏è sync ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'); return false; }
  }

  // Read once from Firestore
  async function loadDoc(id) {
    if (!_ready) return null;
    try {
      const s = await _doc(id).get();
      if (!s.exists) return null;
      return JSON.parse(s.data()._d || 'null');
    } catch(e) { console.warn('[FB] load err', e); return null; }
  }

  // Real-time listener ‚Äî calls cb(data) whenever doc changes from any device
  function listenDoc(id, cb) {
    if (!_ready) return () => {};
    return _doc(id).onSnapshot(s => {
      if (!s.exists) return;
      try { const d = JSON.parse(s.data()._d || 'null'); if (d) cb(d); } catch(e) {}
    }, e => { console.warn('[FB] listen err', e); setStatus('error', '‚ö†Ô∏è sync ‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á'); });
  }

  // One-time migration: copy localStorage data ‚Üí Firestore (only if Firestore empty)
  async function migrateLS(lsKey, docId) {
    if (!_ready) return;
    try {
      const cloud = await loadDoc(docId);
      if (cloud !== null) return; // already in cloud
      const local = localStorage.getItem(lsKey);
      if (!local) return;
      await saveDoc(docId, JSON.parse(local));
      console.log('[FB] migrated', lsKey, '->', docId);
    } catch(e) { console.warn('[FB] migrate err', e); }
  }

  return { init, saveDoc, loadDoc, listenDoc, migrateLS, ready: () => _ready };
})();

// ===================== STORE =====================
const Store = {
  lastError:null,
  key:"quizSciDemoStoreV1",
  migrate(s){
    if(!s||typeof s!=='object') return s;
    if(!Array.isArray(s.exams)) s.exams=[];
    if(!s.adminExamSortBy) s.adminExamSortBy='order';
    if(!s.adminExamSortDir) s.adminExamSortDir='asc';
    let changed=false, maxOrder=0;
    s.exams.forEach((e,idx)=>{
      if(!e) return;
      if(!e.subject||typeof e.subject!=='string'){e.subject='‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';changed=true;}
      if(typeof e.uploadedAt!=='number'){e.uploadedAt=Date.now()-(s.exams.length-idx)*1000;changed=true;}
      if(typeof e.order!=='number'){e.order=idx+1;changed=true;}
      if(e.order>maxOrder) maxOrder=e.order;
    });
    const seen=new Set();
    s.exams.forEach((e)=>{
      if(!e) return;
      if(seen.has(e.order)){maxOrder+=1;e.order=maxOrder;changed=true;}
      seen.add(e.order);
    });
    if(changed) this.save(s);
    // migrate: benchmarks
    if(!Array.isArray(s.benchmarks)) s.benchmarks=[];
    // inject preset benchmarks ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏¢
    if(s.benchmarks.length===0 && typeof PRESET_BENCHMARKS!=='undefined'){
      s.benchmarks=JSON.parse(JSON.stringify(PRESET_BENCHMARKS));
      this.save(s);
    }
    return s;
  },
  load(){try{return JSON.parse(localStorage.getItem(this.key)||"{}");}catch{return {};}},
  save(data){
    try{
      this.lastError=null;
      localStorage.setItem(this.key,JSON.stringify(data));
      // async sync to Firestore (fire-and-forget, non-blocking)
      if(FirebaseSync.ready()) FirebaseSync.saveDoc('mainStore', data).catch(()=>{});
      return true;
    } catch(e){this.lastError=String(e&&e.message?e.message:e);console.warn('Store.save failed',e);return false;}
  },
  // Load from Firestore and overwrite localStorage (called once on startup)
  async syncFromCloud(){
    const cloud = await FirebaseSync.loadDoc('mainStore');
    if(!cloud) return;
    try{ localStorage.setItem(this.key, JSON.stringify(cloud)); }catch(e){}
    console.log('[Store] synced from cloud');
    // Refresh current page if it shows exam list or stats
    if(typeof navigate==='function' && window._currentPage){
      navigate(window._currentPage, window._currentParams||{});
    }
  },
  init(){
    // Boot Firebase, migrate old localStorage data to cloud
    FirebaseSync.init();
    FirebaseSync.migrateLS(this.key, 'mainStore').then(()=>{
      this.syncFromCloud();
    });
    // Real-time listener: if another device saves, reload local + re-render
    FirebaseSync.listenDoc('mainStore', (cloudData) => {
      try{ localStorage.setItem(this.key, JSON.stringify(cloudData)); }catch(e){}
      if(typeof navigate==='function' && window._currentPage){
        navigate(window._currentPage, window._currentParams||{});
      }
    });
    const s=this.load();
    if(!s.exams){
      const examId="exam1";
      s.exams=[{id:examId,subject:"‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",title:"‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå A Level 5 ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà 1 (Demo)",durationSeconds:2700,published:true,pdfUrl:"./pdfs/science_sample.pdf",questionCount:50,uploadedAt:Date.now(),order:1}];
      s.questions={};
      const pageFor=(n)=>{
        if(n<=4)return 1;if(n<=9)return 2;if(n<=14)return 3;if(n<=19)return 4;
        if(n<=24)return 5;if(n<=27)return 6;if(n<=32)return 7;if(n<=36)return 8;
        if(n<=40)return 9;if(n<=46)return 10;return 11;
      };
      s.questions[examId]=Array.from({length:50}).map((_,i)=>({id:"q"+(i+1),number:i+1,no:i+1,page:pageFor(i+1),choices:{A:"",B:"",C:"",D:""},correct:"A"}));
      s.attempts=[];
      s.benchmarks=[];
      s.adminLoggedIn=false;
      this.save(s);
    }
    // Ensure no field is missing from the seed data
    (s.questions||{});
    if(!s.questions) s.questions={};
    return this.migrate(s);
  }
};

const PdfDB=(()=>{
  const DB_NAME="quiz_pdf_db",STORE_NAME="pdfs",VERSION=1;
  function open(){
    return new Promise((resolve,reject)=>{
      const req=indexedDB.open(DB_NAME,VERSION);
      req.onupgradeneeded=()=>{const db=req.result;if(!db.objectStoreNames.contains(STORE_NAME))db.createObjectStore(STORE_NAME);};
      req.onsuccess=()=>resolve(req.result);
      req.onerror=()=>reject(req.error);
    });
  }
  async function put(key,blob){const db=await open();return new Promise((resolve,reject)=>{const tx=db.transaction(STORE_NAME,"readwrite");tx.objectStore(STORE_NAME).put(blob,key);tx.oncomplete=()=>resolve(true);tx.onerror=()=>reject(tx.error);});}
  async function get(key){const db=await open();return new Promise((resolve,reject)=>{const tx=db.transaction(STORE_NAME,"readonly");const req=tx.objectStore(STORE_NAME).get(key);req.onsuccess=()=>resolve(req.result||null);req.onerror=()=>reject(req.error);});}
  async function del(key){const db=await open();return new Promise((resolve,reject)=>{const tx=db.transaction(STORE_NAME,"readwrite");tx.objectStore(STORE_NAME).delete(key);tx.oncomplete=()=>resolve(true);tx.onerror=()=>reject(tx.error);});}
  const blobUrlCache={};
  async function getPdfBlobUrl(key){
    if(blobUrlCache[key]) return blobUrlCache[key];
    const blob=await get(key);
    if(!blob) return null;
    blobUrlCache[key]=URL.createObjectURL(blob);
    return blobUrlCache[key];
  }
  return{put,get,del,getPdfBlobUrl};
})();

function toast(msg){
  const el=document.getElementById("toast");
  if(!el) return alert(msg);
  el.textContent=msg;el.classList.add("show");
  setTimeout(()=>el.classList.remove("show"),1600);
}
function fmtTime(sec){
  sec=Math.max(0,sec|0);
  return String(Math.floor(sec/60)).padStart(2,"0")+":"+String(sec%60).padStart(2,"0");
}
function esc(v){return String(v??"").replace(/[&<>"']/g,(c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}
function escHtml(s){return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;');}

// ===================== ROUTER =====================
let _currentPage='home';
let _pageParams={};


// ‚îÄ‚îÄ Home page render (role-aware) ‚îÄ‚îÄ
function renderHome(){
  const isTeacher = Auth.isTeacher();
  const role = Auth.getRole();
  const homeEl = document.getElementById('page-home');
  if(!homeEl) return;
  homeEl.innerHTML = `
    <div class="container">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
        <div>
          <h1 class="h1">Science Practice</h1>
          <div class="muted" style="margin-top:4px;">${isTeacher ? 'üë®‚Äçüè´ ‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏£‡∏π' : 'üë®‚Äçüéì ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}</div>
        </div>
        <button class="btn" onclick="Auth.logout()" style="font-size:13px;color:#dc2626;border-color:#fca5a5;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
      <div class="list" style="margin-top:20px;">
        <div class="linkCard" onclick="navigate('exams')">
          <div style="font-weight:900;">üìù ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</div>
          <div class="muted" style="margin-top:6px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥ (PDF + timer)</div>
        </div>
        <div class="linkCard" onclick="navigate('stats')">
          <div style="font-weight:900;">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</div>
          <div class="muted" style="margin-top:6px;">‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</div>
        </div>
        ${isTeacher ? `
        <div class="linkCard" onclick="navigate('admin')">
          <div style="font-weight:900;">‚öôÔ∏è Admin</div>
          <div class="muted" style="margin-top:6px;">‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö + preview PDF</div>
        </div>` : ''}
        <div class="linkCard" onclick="navigate('entrance_stats')">
          <div style="font-weight:900;">üéØ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏°.1</div>
          <div class="muted" style="margin-top:6px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô GATE/EPLUS ¬∑ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏™‡∏≠‡∏ö</div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="muted" style="font-size:11px;">‚òÅÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• sync ‡∏Å‡∏±‡∏ö Firebase ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
    </div>
  `;
}

// ===================== AUTH =====================
const Auth = (() => {
  const PINS = {
    '134140': 'teacher',
    '311257': 'student',
  };
  const SESSION_KEY = 'appSession';

  function getRole() {
    try { return JSON.parse(sessionStorage.getItem(SESSION_KEY))?.role || null; }
    catch { return null; }
  }
  function setRole(role) {
    sessionStorage.setItem(SESSION_KEY, JSON.stringify({ role, ts: Date.now() }));
  }
  function isLoggedIn() { return !!getRole(); }
  function isTeacher()  { return getRole() === 'teacher'; }
  function logout() {
    sessionStorage.removeItem(SESSION_KEY);
    navigate('login');
  }
  function login(pin) {
    const role = PINS[pin.trim()];
    if (!role) return false;
    setRole(role);
    return role;
  }
  return { login, logout, isLoggedIn, isTeacher, getRole };
})();

function doLogin() {
  const pin = document.getElementById('loginPinInput').value.trim();
  const errEl = document.getElementById('loginError');
  if (pin.length < 6) { errEl.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 6 ‡∏´‡∏•‡∏±‡∏Å'; return; }
  const role = Auth.login(pin);
  if (!role) {
    errEl.textContent = '‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
    document.getElementById('loginPinInput').value = '';
    document.getElementById('loginPinInput').focus();
    return;
  }
  errEl.textContent = '';
  navigate('home');
}

function navigate(page, params={}){
  // hide take page cleanup
  if(_currentPage==='take') cleanupTake();

  // ‚îÄ‚îÄ Auth guard: redirect to login if not logged in ‚îÄ‚îÄ
  if(page !== 'login' && !Auth.isLoggedIn()){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    const lel=document.getElementById('page-login');
    if(lel){ lel.classList.add('active'); setTimeout(()=>document.getElementById('loginPinInput')?.focus(),100); }
    return;
  }

  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const el=document.getElementById('page-'+page);
  if(!el){console.warn('page not found:',page);return;}
  el.classList.add('active');
  _currentPage=page;
  _pageParams=params;
  window._currentPage=page;
  window._currentParams=params;

  // init page
  if(page==='home'){ renderHome(); }
  else if(page==='exams') initExams();
  else if(page==='exam') initExamDetail(params.id);
  else if(page==='take') initTake(params.id);
  else if(page==='review') initReview(params.attemptId);
  else if(page==='stats') initStats();
  else if(page==='admin'){ if(!Auth.isTeacher()){navigate('home');return;} initAdmin(); }
  else if(page==='admin_new'){ if(!Auth.isTeacher()){navigate('home');return;} initAdminNew(); }
  else if(page==='admin_editor'){ if(!Auth.isTeacher()){navigate('home');return;} initEditor(params.id); }
  else if(page==='admin_benchmark'){ if(!Auth.isTeacher()){navigate('home');return;} initAdminBenchmark(); }
  else if(page==='entrance_stats') initEntranceStats();
  else if(page==='entrance_program') initEntranceProgram(params);
  else if(page==='entrance_year') initEntranceYear(params);
  else if(page==='entrance_compare') initEntranceCompare(params);

  window.scrollTo(0,0);
}

// ===================== EXAMS PAGE =====================
function initExams(){
  const s=Store.load();
  const published=(s.exams||[]).filter(e=>e.published);
  const subjFilterEl=document.getElementById('examsSubjFilter');
  let subjectFilter='';

  const subjects=Array.from(new Set(published.map(e=>(e.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏')))).sort((a,b)=>a.localeCompare(b,'th'));
  subjFilterEl.innerHTML=`<option value="">‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>${subjects.map(sub=>`<option value="${esc(sub)}">${esc(sub)}</option>`).join('')}`;

  function renderExams(){
    const s2=Store.load();
    const allAttempts=s2.attempts||[];
    const exams=subjectFilter?published.filter(e=>(e.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏')===subjectFilter):published;
    const list=document.getElementById('examsList');
    list.className='examGrid';
    list.innerHTML='';
    exams.forEach(e=>{
      // ‡∏´‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      const myAttempts=allAttempts.filter(a=>a.examId===e.id);
      const last=myAttempts[0];
      const bestScore=myAttempts.length?Math.max(...myAttempts.map(a=>a.score)):null;
      const card=document.createElement('div');
      card.className='examCard';
      const scoreHtml=last
        ?`<div class="score-badge">üèÜ ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î <b>${bestScore}/${e.questionCount}</b> &nbsp;‚Ä¢&nbsp; ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î <b>${last.score}/${last.total}</b> (${Math.round(last.score/last.total*100)}%) &nbsp;‚Ä¢&nbsp; ‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß ${myAttempts.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>`
        :`<div class="score-badge" style="color:var(--muted);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥</div>`;
      card.innerHTML=`
        <span class="subj">${esc(e.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏')}</span>
        <div class="title">${esc(e.title)}</div>
        <div class="meta">
          <span>üìù ${e.questionCount} ‡∏Ç‡πâ‡∏≠</span>
          <span>‚è± ${Math.round(e.durationSeconds/60)} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
        </div>
        ${scoreHtml}
      `;
      card.onclick=()=>navigate('exam',{id:e.id});
      list.appendChild(card);
    });
    if(!list.children.length) list.innerHTML=`<div class="muted" style="padding:20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</div>`;
  }

  subjFilterEl.onchange=(e)=>{subjectFilter=e.target.value;renderExams();};
  renderExams();
}

// ===================== EXAM DETAIL PAGE =====================
function initExamDetail(id){
  const LAST_TAKER_KEY='nanont:lastTakerName';
  const s=Store.load();
  const exam=s.exams.find(e=>e.id===id);
  const wrap=document.getElementById('examDetailWrap');
  if(!exam){wrap.innerHTML=`<h1 class="h1">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h1>`;return;}
  wrap.innerHTML=`
    <h1 class="h1">${esc(exam.title)}</h1>
    <div style="margin-top:8px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;">
      <span class="badge ok">${esc(exam.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏')}</span>
      <span class="muted" style="font-size:14px;">üìù ${exam.questionCount} ‡∏Ç‡πâ‡∏≠</span>
      <span class="muted" style="font-size:14px;">‚è± ${Math.round(exam.durationSeconds/60)} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
    </div>
    <div class="hr"></div>
    <div class="card" style="padding:20px;display:grid;gap:12px;max-width:480px;">
      <div style="display:flex;gap:10px;align-items:center;">
        <input id="detailTakerName" class="btn" style="text-align:left;padding:12px 14px;flex:1;font-size:15px;border-radius:14px;" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏≥ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" />
        <button class="btn btnPrimary" id="examStartBtn" style="padding:12px 20px;font-size:15px;border-radius:14px;white-space:nowrap;">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥</button>
      </div>
      <div class="muted" style="font-size:12px;">‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πá‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ¬∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
    </div>
  `;
  // restore last taker name
  const takerEl = document.getElementById('detailTakerName');
  takerEl.value = localStorage.getItem(LAST_TAKER_KEY) || '';

  document.getElementById('examStartBtn').onclick=()=>{
    const name = takerEl.value.trim();
    if(name) localStorage.setItem(LAST_TAKER_KEY, name);
    navigate('take', {id:exam.id, takerName:name});
  };
  // ‡∏Å‡∏î Enter ‡∏Å‡πá‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
  takerEl.addEventListener('keydown', (e)=>{
    if(e.key==='Enter') document.getElementById('examStartBtn').click();
  });
}

// ===================== TAKE PAGE =====================
let _takeInterval=null;
let _takeState=null;

function cleanupTake(){
  if(_takeInterval){clearInterval(_takeInterval);_takeInterval=null;}
  _takeState=null;
}

function initTake(id){
  cleanupTake();
  const s=Store.load();
  const exam=s.exams.find(e=>e.id===id);
  if(!exam){navigate('exams');return;}

  // normalize questions: ensure .no field
  const qsList=(s.questions[id]||[]).map(q=>({...q, no: q.no??q.number??0}));
  const total=qsList.length;
  const attemptId='att_'+Math.random().toString(16).slice(2);
  const LAST_TAKER_KEY='nanont:lastTakerName';
  // ‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å params (‡∏Å‡∏£‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ detail ‡πÅ‡∏•‡πâ‡∏ß)
  const _takerName = (_pageParams.takerName||localStorage.getItem(LAST_TAKER_KEY)||'').trim();
  if(_takerName) localStorage.setItem(LAST_TAKER_KEY, _takerName);

  _takeState={s,exam,qsList,total,attemptId,
    currentIndex:0,answers:{},unsure:{},
    started:false,startedAt:null,createdAt:Date.now(),
    takerName:_takerName
  };
  const st=_takeState;

  document.getElementById('takeExamTitle').textContent=exam.title;
  document.getElementById('takeQTotal').textContent=total;

  // PDF.js viewer for take page
  // ‡∏•‡πâ‡∏≤‡∏á viewer ‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô cache ‡∏Ç‡πâ‡∏≤‡∏°‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
  document.getElementById('takePdfViewer').innerHTML = '';
  const _takePdfViewer = PdfViewer.create('takePdfViewer');
  let _takePdfLoaded = false; // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

  async function getPdfBlobUrl(pdfUrl){
    if(pdfUrl.startsWith('localpdf:')){
      const key=pdfUrl.slice('localpdf:'.length);
      const blob=await PdfDB.get(key);
      if(!blob) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ß‡πâ');
      return URL.createObjectURL(blob);
    }
    return pdfUrl;
  }

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Google Drive URL ‡πÑ‡∏´‡∏°
  const _isGDrive = !!(exam.pdfUrl||'').match(/drive\.google\.com/);

  // ‡πÇ‡∏´‡∏•‡∏î PDF ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‚Äî ‡πÑ‡∏°‡πà auto-scroll ‡∏ï‡∏≠‡∏ô‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏≠‡∏á)
  async function loadPdfOnce(){
    if(_takePdfLoaded) return;
    _takePdfLoaded = true;
    try{
      let pdfUrl = exam.pdfUrl||'';
      if(pdfUrl.startsWith('./') || pdfUrl.startsWith('../')){
        pdfUrl = new URL(pdfUrl, window.location.href).href;
      }
      const url = pdfUrl.startsWith('localpdf:') ? await getPdfBlobUrl(pdfUrl) : pdfUrl;
      await _takePdfViewer.loadUrl(url, 1);
    } catch(err){ toast(err?.message||String(err)); }
  }

  // setPdfPage ‡∏ï‡∏≠‡∏ô take = ‡πÅ‡∏Ñ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡πÑ‡∏°‡πà scroll
  async function setPdfPage(page){
    await loadPdfOnce();
  }

  if(qsList[0]) setPdfPage(qsList[0].page||1);

  // build num buttons
  const numsEl=document.getElementById('takeNums');
  numsEl.innerHTML='';
  qsList.forEach((q,idx)=>{
    const b=document.createElement('button');
    b.className='btn numBtn';
    b.textContent=q.number||q.no;
    b.addEventListener('click',()=>{st.currentIndex=idx;render();});
    numsEl.appendChild(b);
  });

  function setNumStyles(){
    [...numsEl.children].forEach((b,idx)=>{
      const q=qsList[idx];
      const done=!!st.answers[q.id];
      const markUnsure=!!st.unsure[q.id];
      const active=idx===st.currentIndex;
      b.style.fontWeight=active?900:800;
      b.style.borderColor=active?'var(--black)':'var(--border)';
      b.style.background='#fff';b.style.color='#111';
      if(done){b.style.background='var(--black)';b.style.borderColor='var(--black)';b.style.color='#fff';}
      if(markUnsure){b.style.background='var(--warn)';b.style.borderColor='var(--warn)';b.style.color='#111';}
      if(active) b.style.boxShadow='0 0 0 2px rgba(17,24,39,.25)';
      else b.style.boxShadow='none';
    });
  }

  const labelMap={A:'‡∏Å',B:'‡∏Ç',C:'‡∏Ñ',D:'‡∏á'};

  function render(){
    const q=qsList[st.currentIndex];
    document.getElementById('takeQNo').textContent=q.number||q.no;
    document.getElementById('takePdfPage').textContent=_isGDrive ? 'üìÑ Google Drive (scroll ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏¥‡πâ‡∏ß)' : 'PDF ‡∏´‡∏ô‡πâ‡∏≤ '+(q.page||1);
    const ub=document.getElementById('takeUnsureBtn');
    if(ub){
      ub.disabled=!st.started;
      const u=!!st.unsure[q.id];
      ub.textContent=u?'‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‚úì':'‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à';
      ub.className=u?'btn btnPrimary':'btn';
    }
    setPdfPage(q.page||1);
    const wrap=document.getElementById('takeChoices');
    wrap.innerHTML='';
    ['A','B','C','D'].forEach(lab=>{
      const div=document.createElement('label');
      div.className='choice'+((st.answers[q.id]===lab)?' active':'');
      if(!st.started){div.style.opacity='0.6';div.style.pointerEvents='none';}
      div.innerHTML=`<span style="font-weight:900;font-size:15px;">${labelMap[lab]}</span>`;
      div.addEventListener('click',()=>{if(!st.started) return;st.answers[q.id]=lab;render();});
      wrap.appendChild(div);
    });
    document.getElementById('takePrevBtn').disabled=st.currentIndex===0;
    document.getElementById('takeNextBtn').disabled=st.currentIndex===total-1;
    setNumStyles();
  }

  document.getElementById('takePrevBtn').onclick=()=>{st.currentIndex=Math.max(0,st.currentIndex-1);render();};
  document.getElementById('takeNextBtn').onclick=()=>{st.currentIndex=Math.min(total-1,st.currentIndex+1);render();};
  document.getElementById('takeUnsureBtn').onclick=()=>{
    if(!st.started){toast('‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô');return;}
    const q=qsList[st.currentIndex];
    st.unsure[q.id]=!st.unsure[q.id];
    render();
  };

  function submit(){
    if(!st.started){toast('‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô');return;}
    if(_takeInterval){clearInterval(_takeInterval);_takeInterval=null;}
    let score=0;
    qsList.forEach(q=>{if(st.answers[q.id]&&st.answers[q.id]===q.correct) score++;});
    const perQuestion=qsList.map(q=>{
      const chosen=st.answers[q.id]||null;
      const correct=q.correct||null;
      return{qid:q.id,no:q.no||q.number,page:q.page,chosen,correct,isCorrect:chosen&&correct?(chosen===correct):false,unsure:!!st.unsure[q.id]};
    });
    const usedSeconds=st.startedAt?Math.min(Math.floor((Date.now()-st.startedAt)/1000),exam.durationSeconds):0;
    const takerName=st.takerName||localStorage.getItem(LAST_TAKER_KEY)||'';
    const savedS=Store.load();
    savedS.attempts.unshift({id:st.attemptId,examId:exam.id,examTitle:exam.title,examSubject:exam.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',takerName,startedAt:new Date(st.startedAt??st.createdAt).toISOString(),submittedAt:new Date().toISOString(),usedSeconds,score,total,answers:{...st.answers},perQuestion});
    const ok=Store.save(savedS);
    if(!ok) alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢: ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡∏ö‡∏ô iPad/iOS ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö localStorage\n\n‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ: ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå https ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ');
    navigate('review',{attemptId:st.attemptId});
  }

  const submitBtn=document.getElementById('takeSubmitBtn');
  // remove old listeners by replacing
  const newSubmitBtn=submitBtn.cloneNode(true);
  submitBtn.parentNode.replaceChild(newSubmitBtn,submitBtn);
  newSubmitBtn.addEventListener('click',()=>{if(confirm('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ? (‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏â‡∏•‡∏¢/‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô)')) submit();});

  const t1=document.getElementById('takeTimer'),t2=document.getElementById('takeTimer2');
  function setTimerDisplay(remaining){
    const fmt=fmtTime(remaining);
    t1.textContent=fmt; t2.textContent=fmt;
    const urgent = remaining <= 600; // 10 ‡∏ô‡∏≤‡∏ó‡∏µ
    const color = urgent ? '#dc2626' : '';
    const weight = urgent ? '900' : '';
    [t1,t2].forEach(t=>{t.style.color=color;t.style.fontWeight=weight;});
    // ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1 ‡∏ô‡∏≤‡∏ó‡∏µ
    if(remaining <= 60){
      t1.style.animation='pulse 1s infinite';
      t2.style.animation='pulse 1s infinite';
    }
  }
  setTimerDisplay(exam.durationSeconds);

  function doStart(){
    if(st.started) return;
    st.started=true;
    st.startedAt=Date.now();
    newSubmitBtn.disabled=false; // ‡πÉ‡∏ä‡πâ newSubmitBtn ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà getElementById ‡∏ó‡∏µ‡πà‡∏´‡∏≤ element ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà replace ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)
    render();
    _takeInterval=setInterval(()=>{
      const elapsed=Math.floor((Date.now()-st.startedAt)/1000);
      const remaining=Math.max(0,exam.durationSeconds-elapsed);
      setTimerDisplay(remaining);
      if(remaining===0){clearInterval(_takeInterval);_takeInterval=null;submit();}
    },250);
  }

  // Auto-start ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ take (‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô)
  setTimeout(doStart, 300);
  document.getElementById('takeExitBtn').onclick=()=>{if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?\n\n‡∏ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á')){cleanupTake();navigate('exams');}};

  render();
}

// ===================== REVIEW PAGE =====================
function initReview(attemptId){
  const s=Store.load();
  const att=(s.attempts||[]).find(a=>a.id===attemptId);
  if(!attemptId||!att){
    document.getElementById('reviewTitle').textContent='‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö';
    document.getElementById('reviewSub').textContent='‡∏•‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà';
    return;
  }
  const exam=(s.exams||[]).find(e=>e.id===att.examId);
  const _reviewIsGDrive = !!(exam && (exam.pdfUrl||'').match(/drive\.google\.com/));

  // *** FIX: use correct key s.questions (not s.questionsByExam) ***
  const qMap=s.questions||s.questionsByExam||{};
  let qs=qMap[att.examId]||[];

  // Fallback: rebuild from perQuestion saved in attempt
  if(!qs.length&&Array.isArray(att.perQuestion)&&att.perQuestion.length){
    qs=att.perQuestion.map(p=>({id:p.qid||String(p.no),no:p.no,page:p.page||1,correct:p.correct||null,choices:{}}));
  }

  // Normalize: seed data may use .number instead of .no
  qs.forEach(q=>{if(q.no==null&&q.number!=null) q.no=q.number;});

  const taker=(att.takerName||'').trim()||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
  const subj=(exam&&exam.subject)?exam.subject:(att.examSubject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏');
  document.getElementById('reviewTitle').textContent=`‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô: ${att.examTitle||'‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö'}`;
  document.getElementById('reviewSub').textContent=`‡∏ß‡∏¥‡∏ä‡∏≤: ${subj} ‚Ä¢ ‡∏ú‡∏π‡πâ‡∏ó‡∏≥: ${taker}`;
  document.getElementById('reviewScore').textContent=`‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${att.score}/${att.total}`;

  function fmtDate(iso){try{return new Date(iso).toLocaleString('th-TH');}catch(e){return iso||'';}}
  function fmtDur(sec){sec=Math.max(0,Number(sec||0));const m=Math.floor(sec/60),ss=sec%60;return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0');}

  document.getElementById('reviewMeta').textContent=`‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: ${fmtDate(att.submittedAt)} ‚Ä¢ ‡πÄ‡∏ß‡∏•‡∏≤: ${fmtDur(att.usedSeconds)}`;
  document.getElementById('reviewPdfLabel').textContent=exam?esc(exam.title||'PDF'):'PDF';

  const answers=att.answers||{};
  const total=Number(att.total||qs.length||0);
  const correctCount=Number.isFinite(Number(att.score))?Number(att.score):0;

  let wrongNos=[];
  if(Array.isArray(att.perQuestion)&&att.perQuestion.length){
    wrongNos=att.perQuestion.filter(p=>!p.isCorrect).map(p=>Number(p.no)||0).filter(n=>n>0);
  } else {
    qs.forEach((q,idx)=>{
      const chosen=(answers[q.id]??answers[String(q.id)]??null);
      const cc=chosen==null?null:String(chosen).trim();
      const qc=q.correct==null?null:String(q.correct).trim();
      if(!(cc!=null&&qc!=null&&cc===qc)) wrongNos.push(Number(q.no)||idx+1);
    });
  }

  const wrongUnique=Array.from(new Set(wrongNos)).sort((a,b)=>a-b);
  const wrongCount=Math.max(0,total-correctCount);
  const pct=total?Math.round((correctCount/total)*100):0;
  document.getElementById('reviewSummaryLine').textContent=`‡∏ñ‡∏π‡∏Å ${correctCount}/${total} (${pct}%) ‚Ä¢ ‡∏ú‡∏¥‡∏î ${wrongCount} ‡∏Ç‡πâ‡∏≠`;

  const wrongListText=document.getElementById('reviewWrongListText');
  if(wrongListText){
    const listStr=wrongUnique.length?wrongUnique.join(', '):'-';
    wrongListText.innerHTML=`<span class="label">‡∏ú‡∏¥‡∏î‡∏Ç‡πâ‡∏≠:</span> <span class="list">${listStr}</span>`;
  }

  const wrongSet=new Set(wrongUnique);
  function isCorrectQ(q){
    const no=Number(q.no)||0;
    if(no&&wrongSet.has(no)) return false;
    if(Array.isArray(att.perQuestion)&&att.perQuestion.length){
      const p=att.perQuestion.find(x=>Number(x.no)===no);
      if(p) return !!p.isCorrect;
    }
    const chosen=(answers[q.id]??answers[String(q.id)]??null);
    const cc=chosen==null?null:String(chosen).trim();
    const qc=q.correct==null?null:String(q.correct).trim();
    return(cc!=null&&qc!=null&&cc===qc);
  }

  // Nav chips
  const nav=document.getElementById('reviewNavChips');
  nav.innerHTML='';
  qs.forEach(q=>{
    const ok=isCorrectQ(q);
    const b=document.createElement('button');
    b.className='chip '+(ok?'good':'bad');
    b.textContent=q.no;
    b.onclick=()=>{
      if(!_reviewIsGDrive) setPdfPage(q.page||1);
    };
    nav.appendChild(b);
  });

  // Question list
  const list=document.getElementById('reviewQList');
  list.innerHTML='';
  qs.forEach((q)=>{
    const chosen=(answers[q.id]??answers[String(q.id)]??null);
    const correct=(q.correct==null)?null:String(q.correct).trim();
    const isCorrect=isCorrectQ(q);
    const wrap=document.createElement('div');
    wrap.className='qItem';wrap.id=`rq-${q.no}`;
    wrap.innerHTML=`
      <div class="qHead">
        <div style="font-weight:800;">‡∏Ç‡πâ‡∏≠ ${q.no} <span class="muted">(‡∏´‡∏ô‡πâ‡∏≤ ${q.page||1})</span></div>
        <div style="display:flex;gap:8px;align-items:center;">
          <span class="qBadge ${isCorrect?'good':'bad'}">${isCorrect?'‡∏ñ‡∏π‡∏Å':(chosen?'‡∏ú‡∏¥‡∏î':'‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö')}</span>
          ${(!_reviewIsGDrive && q.page) ? '<button class="btn" data-page="'+q.page+'">‡∏´‡∏ô‡πâ‡∏≤ '+q.page+'</button>' : ''}
        </div>
      </div>
      <div class="muted" style="margin-top:6px;">‡πÄ‡∏â‡∏•‡∏¢: <b>${correct||'-'}</b> ‚Ä¢ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <b>${chosen==null?'-':String(chosen).trim()}</b></div>
      <div class="opts"></div>
    `;
    const pageBtn=wrap.querySelector('button[data-page]'); if(pageBtn) pageBtn.onclick=(e)=>{e.stopPropagation();setPdfPage(Number(pageBtn.dataset.page)||1);};
    const opts=wrap.querySelector('.opts');
    ['‡∏Å','‡∏Ç','‡∏Ñ','‡∏á'].forEach(key=>{
      const text=(q.choices&&q.choices[key])?q.choices[key]:((q.options&&q.options[key])?q.options[key]:'');
      const div=document.createElement('div');
      const isChosen=chosen===key;
      const isCorr=correct===key;
      let cls='opt';
      if(isCorr) cls+=' correct';
      if(isChosen){cls+=' chosen '+(isCorr?'good':'bad');}
      div.className=cls;
      div.innerHTML=`<div class="optKey">${key}</div><div style="flex:1;min-width:0;">${text?escHtml(text):'<span class="muted">(‡∏ß‡πà‡∏≤‡∏á)</span>'}</div>${isCorr?'<div class="tag">‡πÄ‡∏â‡∏•‡∏¢</div>':(isChosen?'<div class="tag">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>':'')}`;
      opts.appendChild(div);
    });
    list.appendChild(wrap);
  });

  // PDF viewer for review page ‚Äî ‡πÉ‡∏ä‡πâ iframe ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô take page
  const reviewViewerEl = document.getElementById('reviewPdfViewer');
  reviewViewerEl.innerHTML = '';
  let _reviewCurrentPage = 1;
  let _reviewPdfLoaded = false;

  // ‡πÇ‡∏´‡∏•‡∏î PDF ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
  async function loadReviewPdf() {
    if (_reviewPdfLoaded) return;
    _reviewPdfLoaded = true;
    try {
      if (!exam || !exam.pdfUrl) return;
      const pdfUrl = exam.pdfUrl;

      if (_reviewIsGDrive) {
        // Google Drive ‚Üí iframe embed ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô take page
        const m = pdfUrl.match(/drive\.google\.com\/file\/d\/([^/?#]+)/);
        const id2 = m ? m[1] : (pdfUrl.match(/[?&]id=([^&]+)/) || [])[1];
        if (id2) {
          reviewViewerEl.style.cssText = 'width:100%;height:70vh;min-height:400px;position:relative;';
          const iframe = document.createElement('iframe');
          iframe.src = `https://drive.google.com/file/d/${id2}/preview`;
          iframe.allow = 'autoplay';
          iframe.style.cssText = 'width:100%;height:100%;border:none;display:block;';
          reviewViewerEl.appendChild(iframe);
          return;
        }
      }

      // upload file / same-origin ‚Üí PDF.js
      const _reviewPdfViewer = PdfViewer.create('reviewPdfViewer');
      let url = pdfUrl;
      if (url.startsWith('localpdf:')) {
        const key = url.slice('localpdf:'.length);
        const blob = await PdfDB.get(key);
        if (!blob) { toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF'); return; }
        url = URL.createObjectURL(blob);
      } else if (url.startsWith('./') || url.startsWith('../')) {
        url = new URL(url, window.location.href).href;
      }
      await _reviewPdfViewer.loadUrl(url, _reviewCurrentPage);

      // ‡πÄ‡∏Å‡πá‡∏ö reference ‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ setPdfPage ‡πÉ‡∏ä‡πâ
      reviewViewerEl._pdfViewer = _reviewPdfViewer;
    } catch(err) { toast(err?.message || String(err)); }
  }

  async function setPdfPage(p) {
    if (_reviewIsGDrive) return; // gdrive ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
    _reviewCurrentPage = Math.max(1, Number(p || 1));
    if (!_reviewPdfLoaded) {
      await loadReviewPdf(); // ‡πÇ‡∏´‡∏•‡∏î + ‡∏à‡∏∞ scroll ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ _reviewCurrentPage
    } else if (reviewViewerEl._pdfViewer) {
      reviewViewerEl._pdfViewer.setPage(_reviewCurrentPage); // scroll PDF ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    }
  }
  window.__reviewSetPdfPage = setPdfPage;

  document.getElementById('reviewScrollTop').onclick = () => window.scrollTo({top:0, behavior:'smooth'});

  // ‡πÇ‡∏´‡∏•‡∏î PDF ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠
  loadReviewPdf();
  const firstPage = (qs[0] && qs[0].page) ? qs[0].page : 1;
  _reviewCurrentPage = firstPage;

}

// ===================== STATS PAGE =====================
function initStats(){
  let pendingDeleteAttemptId=null;
  let currentExamFilter='all';
  let currentSubjectFilter='all';
  const filterEl=document.getElementById('statsFilterExam');
  const subjectEl=document.getElementById('statsFilterSubject');

  function getExamSubjectById(s,examId){
    if(!examId) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
    const ex=(s.exams||[]).find(e=>e.id===examId);
    if(ex?.subject) return ex.subject;
    const att=(s.attempts||[]).find(a=>a.examId===examId);
    return att?.examSubject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
  }
  function getExamTitleById(s,examId){
    if(!examId) return '‚Äî';
    return(s.exams||[]).find(e=>e.id===examId)?.title||(s.attempts||[]).find(a=>a.examId===examId)?.examTitle||'‚Äî';
  }
  function formatDuration(sec){
    sec=Math.max(0,Math.floor(sec||0));
    return String(Math.floor(sec/60)).padStart(2,'0')+':'+String(sec%60).padStart(2,'0');
  }

  function rebuildFilterOptions(s){
    if(!filterEl) return;
    const examIds=new Set();
    (s.exams||[]).forEach(e=>e?.id&&examIds.add(e.id));
    (s.attempts||[]).forEach(a=>a?.examId&&examIds.add(a.examId));
    let ids=Array.from(examIds);
    if(currentSubjectFilter!=='all') ids=ids.filter(id=>getExamSubjectById(s,id)===currentSubjectFilter);
    const options=[{value:'all',label:'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'}].concat(ids.sort((a,b)=>String(getExamTitleById(s,a)).localeCompare(String(getExamTitleById(s,b)),'th')).map(id=>({value:id,label:getExamTitleById(s,id)})));
    const prev=currentExamFilter;
    filterEl.innerHTML=options.map(o=>`<option value="${o.value}">${o.label}</option>`).join('');
    if(options.some(o=>o.value===prev)) filterEl.value=prev;
    else{currentExamFilter='all';filterEl.value='all';}
  }

  function rebuildSubjectOptions(s){
    if(!subjectEl) return;
    const subjects=new Set();
    (s.exams||[]).forEach(e=>subjects.add(e.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'));
    (s.attempts||[]).forEach(a=>subjects.add(a.examSubject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'));
    const opts=['all',...Array.from(subjects).filter(Boolean).sort((a,b)=>a.localeCompare(b,'th'))];
    subjectEl.innerHTML=opts.map(v=>`<option value="${v}">${v==='all'?'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î':v}</option>`).join('');
    if(opts.includes(currentSubjectFilter)) subjectEl.value=currentSubjectFilter;
    else{currentSubjectFilter='all';subjectEl.value='all';}
  }

  // bind listeners ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á clone ‚Äî ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô bug options ‡∏´‡∏≤‡∏¢)
  document.getElementById('statsFilterSubject').onchange=(e)=>{currentSubjectFilter=e.target.value||'all';currentExamFilter='all';document.getElementById('statsFilterExam').value='all';render();};
  document.getElementById('statsFilterExam').onchange=(e)=>{currentExamFilter=e.target.value||'all';render();};

  function openConfirm(aId){
    pendingDeleteAttemptId=aId;
    document.getElementById('statsConfirmText').textContent=`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏° (${aId})`;
    document.getElementById('statsConfirmOverlay').classList.add('show');
  }
  function closeConfirm(){pendingDeleteAttemptId=null;document.getElementById('statsConfirmOverlay').classList.remove('show');}

  document.getElementById('statsConfirmCancel').onclick=closeConfirm;
  document.getElementById('statsConfirmOverlay').onclick=(e)=>{if(e.target.id==='statsConfirmOverlay') closeConfirm();};
  document.getElementById('statsConfirmOk').onclick=()=>{
    if(!pendingDeleteAttemptId) return closeConfirm();
    const s=Store.load();
    s.attempts=(s.attempts||[]).filter(a=>a.id!==pendingDeleteAttemptId);
    Store.save(s);closeConfirm();render();
  };

  // ‚îÄ‚îÄ helpers ‚îÄ‚îÄ
  function scoreColor(pct){
    if(pct>=80) return '#16a34a';
    if(pct>=60) return '#f59e0b';
    return '#ef4444';
  }

  // ‚îÄ‚îÄ ‚ë† Summary cards ‚îÄ‚îÄ
  function renderSummaryCards(attempts){
    const el=document.getElementById('statsSummaryCards');
    if(!el) return;
    if(!attempts.length){el.innerHTML='';return;}
    const total=attempts.length;
    const avgPct=Math.round(attempts.reduce((s,a)=>s+(a.total?((a.score||0)/a.total)*100:0),0)/total);
    const best=attempts.reduce((b,a)=>(!b||(a.total&&(a.score/a.total)>(b.score/b.total)))?a:b,null);
    const avgSec=Math.round(attempts.reduce((s,a)=>s+(a.usedSeconds||0),0)/total);
    const cards=[
      {label:'‡∏ó‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',value:total+' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á',sub:'‡∏ó‡∏∏‡∏Å‡∏ä‡∏∏‡∏î‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô',accent:false},
      {label:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',value:avgPct+'%',sub:`${attempts.reduce((s,a)=>s+(a.score||0),0)} / ${attempts.reduce((s,a)=>s+(a.total||0),0)} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`,accent:true},
      {label:'‡∏ó‡∏≥‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î',value:best?(Math.round((best.score/best.total)*100))+'%':'‚Äî',sub:best?esc(best.examTitle||'‚Äî'):'',accent:false},
      {label:'‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',value:formatDuration(avgSec),sub:'‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á',accent:false},
    ];
    el.innerHTML=cards.map(c=>`
      <div class="stat-card${c.accent?' accent':''}">
        <div class="sc-label">${c.label}</div>
        <div class="sc-value">${c.value}</div>
        <div class="sc-sub">${c.sub}</div>
      </div>`).join('');
  }

  // ‚îÄ‚îÄ ‚ë° ‡∏Å‡∏£‡∏≤‡∏ü‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ (Canvas) ‚îÄ‚îÄ
  function renderChart(attempts){
    const canvas=document.getElementById('statsChart');
    const emptyEl=document.getElementById('statsChartEmpty');
    if(!canvas) return;
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏Å‡πà‡∏≤‚Üí‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 20 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const sorted=[...attempts].sort((a,b)=>(a.startedAt||0)-(b.startedAt||0)).slice(-20).filter(a=>a.total>0);
    const pts=sorted.map((a,i)=>({
      pct:Math.round((a.score/a.total)*100),
      date:a.startedAt?new Date(a.startedAt):null,
      idx:i+1
    }));
    if(pts.length<2){
      canvas.style.display='none';
      emptyEl.style.display='block';
      emptyEl.textContent=pts.length===1?`‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${pts[0].pct}%) ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`:'‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
      return;
    }
    canvas.style.display='block'; emptyEl.style.display='none';

    const W=canvas.offsetWidth||600;
    const H=210; // ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö label ‡πÅ‡∏Å‡∏ô X + Y title
    canvas.width=W; canvas.height=H;
    const ctx=canvas.getContext('2d');
    ctx.clearRect(0,0,W,H);

    // padding: ‡∏ö‡∏ô=24(Y title) ‡∏Ç‡∏ß‡∏≤=12 ‡∏•‡πà‡∏≤‡∏á=52(X label+title) ‡∏ã‡πâ‡∏≤‡∏¢=44(Y label)
    const PAD={t:24,r:12,b:52,l:44};
    const gW=W-PAD.l-PAD.r;
    const gH=H-PAD.t-PAD.b;

    // ‚îÄ‚îÄ ‡πÅ‡∏Å‡∏ô Y title (‡∏´‡∏°‡∏∏‡∏ô 90¬∞) ‚îÄ‚îÄ
    ctx.save();
    ctx.translate(11, PAD.t+gH/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillStyle='#6b7280';
    ctx.font='11px sans-serif';
    ctx.textAlign='center';
    ctx.fillText('‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (%)', 0, 0);
    ctx.restore();

    // ‚îÄ‚îÄ grid lines + Y labels ‚îÄ‚îÄ
    ctx.strokeStyle='#e5e7eb'; ctx.lineWidth=1;
    [0,25,50,75,100].forEach(v=>{
      const y=PAD.t+gH*(1-v/100);
      ctx.beginPath();ctx.moveTo(PAD.l,y);ctx.lineTo(PAD.l+gW,y);ctx.stroke();
      ctx.fillStyle='#9ca3af';ctx.font='10px sans-serif';ctx.textAlign='right';
      ctx.fillText(v+'%',PAD.l-6,y+3);
    });

    // ‚îÄ‚îÄ ‡πÅ‡∏Å‡∏ô X: ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‚îÄ‚îÄ
    const xs=pts.map((_,i)=>PAD.l+(i/(pts.length-1))*gW);
    pts.forEach((p,i)=>{
      const x=xs[i];
      // ‡πÄ‡∏™‡πâ‡∏ô tick
      ctx.strokeStyle='#d1d5db';ctx.lineWidth=1;
      ctx.beginPath();ctx.moveTo(x,PAD.t+gH);ctx.lineTo(x,PAD.t+gH+4);ctx.stroke();
      // label ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà
      ctx.fillStyle='#374151';ctx.font='bold 10px sans-serif';ctx.textAlign='center';
      ctx.fillText(`‡∏Ñ‡∏£‡∏±‡πâ‡∏á ${p.idx}`,x,PAD.t+gH+14);
      // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠
      if(p.date){
        const d=p.date;
        const dStr=`${d.getDate()}/${d.getMonth()+1}`;
        ctx.fillStyle='#9ca3af';ctx.font='9px sans-serif';
        ctx.fillText(dStr,x,PAD.t+gH+26);
      }
    });

    // ‚îÄ‚îÄ X axis title ‚îÄ‚îÄ
    ctx.fillStyle='#6b7280';ctx.font='11px sans-serif';ctx.textAlign='center';
    ctx.fillText('‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥ (‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÉ‡∏´‡∏°‡πà)',PAD.l+gW/2,H-4);

    // ‚îÄ‚îÄ line + gradient fill ‚îÄ‚îÄ
    const ys=pts.map(p=>PAD.t+gH*(1-p.pct/100));
    const grad=ctx.createLinearGradient(0,PAD.t,0,PAD.t+gH);
    grad.addColorStop(0,'rgba(17,24,39,.15)');grad.addColorStop(1,'rgba(17,24,39,0)');
    ctx.beginPath();ctx.moveTo(xs[0],ys[0]);
    for(let i=1;i<pts.length;i++) ctx.lineTo(xs[i],ys[i]);
    ctx.lineTo(xs[xs.length-1],PAD.t+gH);ctx.lineTo(xs[0],PAD.t+gH);
    ctx.closePath();ctx.fillStyle=grad;ctx.fill();
    ctx.beginPath();ctx.moveTo(xs[0],ys[0]);
    for(let i=1;i<pts.length;i++) ctx.lineTo(xs[i],ys[i]);
    ctx.strokeStyle='#111827';ctx.lineWidth=2;ctx.stroke();

    // ‚îÄ‚îÄ dots + value labels ‚îÄ‚îÄ
    pts.forEach((p,i)=>{
      ctx.beginPath();ctx.arc(xs[i],ys[i],4,0,Math.PI*2);
      ctx.fillStyle=scoreColor(p.pct);ctx.fill();
      ctx.strokeStyle='#fff';ctx.lineWidth=1.5;ctx.stroke();
      ctx.fillStyle='#374151';ctx.font='bold 10px sans-serif';ctx.textAlign='center';
      ctx.fillText(p.pct+'%',xs[i],ys[i]-8);
    });
  }

  // ‚îÄ‚îÄ ‚ë¢ TOP 10 ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏ö‡πà‡∏≠‡∏¢ ‚îÄ‚îÄ
  function renderWrongTop(attempts){
    const el=document.getElementById('statsWrongTop');
    const emptyEl=document.getElementById('statsWrongTopEmpty');
    if(!el) return;
    const wrongCount={};
    attempts.forEach(a=>{
      if(!Array.isArray(a.perQuestion)) return;
      a.perQuestion.forEach(p=>{ if(!p.isCorrect&&p.no){ wrongCount[p.no]=(wrongCount[p.no]||0)+1; } });
    });
    const sorted=Object.entries(wrongCount).sort((a,b)=>b[1]-a[1]).slice(0,10);
    if(!sorted.length){el.innerHTML='';emptyEl.style.display='block';return;}
    emptyEl.style.display='none';
    const max=sorted[0][1];
    el.innerHTML=sorted.map(([no,cnt],i)=>`
      <div class="wrong-row">
        <div class="wrong-rank${i<3?' top3':''}">‡∏Ç‡πâ‡∏≠${no}</div>
        <div class="wrong-bar-wrap"><div class="wrong-bar-fill" style="width:${Math.round((cnt/max)*100)}%"></div></div>
        <div style="font-weight:700;font-size:12px;white-space:nowrap;">${cnt} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
      </div>`).join('');
  }

  // ‚îÄ‚îÄ ‚ë£ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏° progress bar ‚îÄ‚îÄ
  function render(){
    const s=Store.load();
    rebuildSubjectOptions(s);rebuildFilterOptions(s);
    const allAttempts=(s.attempts||[]).slice().sort((a,b)=>(b.startedAt||0)-(a.startedAt||0));
    const bySubject=currentSubjectFilter==='all'?allAttempts:allAttempts.filter(a=>(a.examSubject||getExamSubjectById(s,a.examId))===currentSubjectFilter);
    const attempts=currentExamFilter==='all'?bySubject:bySubject.filter(a=>a.examId===currentExamFilter);

    // render panels (‡πÉ‡∏ä‡πâ filtered attempts ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô summary ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    renderSummaryCards(bySubject);
    renderChart(attempts.length?attempts:bySubject);
    renderWrongTop(attempts.length?attempts:bySubject);

    const rowsEl=document.getElementById('statsRows');
    if(!attempts.length){rowsEl.innerHTML=`<tr><td colspan="8" class="muted" style="padding:20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</td></tr>`;return;}
    rowsEl.innerHTML=attempts.map((a,idx)=>{
      const exam=(s.exams||[]).find(e=>e.id===a.examId);
      const examTitle=exam?.title||a.examTitle||'‚Äî';
      const examSubject=a.examSubject||exam?.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
      const takerName=a.takerName||'‚Äî';
      const started=a.startedAt?new Date(a.startedAt):null;
      const dateStr=started?started.toLocaleString('th-TH'):'‚Äî';
      const usedSec=Number.isFinite(a.usedSeconds)?a.usedSeconds:0;
      const pct=a.total?Math.round((a.score||0)/a.total*100):0;
      const barColor=scoreColor(pct);
      return `<tr>
        <td><b>${idx+1}</b></td>
        <td>${dateStr}<small>${a.id||''}</small></td>
        <td>${esc(takerName)}</td>
        <td>${esc(examSubject)}</td>
        <td>${esc(examTitle)}</td>
        <td>
          <div class="score-cell">
            <div><b>${a.score||0}/${a.total||0}</b> <span style="color:${barColor};font-weight:700;font-size:12px;">(${pct}%)</span></div>
            <div class="score-bar-wrap"><div class="score-bar-fill" style="width:${pct}%;background:${barColor};"></div></div>
          </div>
        </td>
        <td>${formatDuration(usedSec)}</td>
        <td><button class="btn-delete" data-del="${a.id}">‡∏•‡∏ö</button> <button class="btn" style="padding:6px 10px;font-size:12px;" data-review="${a.id}">‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢</button></td>
      </tr>`;
    }).join('');
    rowsEl.querySelectorAll('[data-del]').forEach(btn=>btn.addEventListener('click',()=>openConfirm(btn.getAttribute('data-del'))));
    rowsEl.querySelectorAll('[data-review]').forEach(btn=>btn.addEventListener('click',()=>navigate('review',{attemptId:btn.getAttribute('data-review')})));

    // render chart after DOM settled (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ width)
    requestAnimationFrame(()=>renderChart(attempts.length?attempts:bySubject));
  }

  document.getElementById('statsBtnExport').onclick=()=>{
    if(typeof XLSX==='undefined'){toast('SheetJS ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à');return;}
    const s=Store.load();
    const attempts=s.attempts||[];
    if(!attempts.length){toast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥');return;}

    // Sheet 1: ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    const header=['‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà','‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥','‡∏ú‡∏π‡πâ‡∏ó‡∏≥','‡∏ß‡∏¥‡∏ä‡∏≤','‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö','‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô','‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î','%','‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)','attempt_id'];
    const rows=attempts.map((a,i)=>{
      const pct=a.total?Math.round((a.score||0)/a.total*100):0;
      return [i+1, a.startedAt?new Date(a.startedAt).toLocaleString('th-TH'):'', a.takerName||'', a.examSubject||'', a.examTitle||'', a.score||0, a.total||0, pct, a.usedSeconds||0, a.id||''];
    });
    const ws1=XLSX.utils.aoa_to_sheet([header,...rows]);
    ws1['!cols']=[{wch:8},{wch:22},{wch:14},{wch:14},{wch:30},{wch:8},{wch:10},{wch:6},{wch:16},{wch:24}];

    // Sheet 2: perQuestion ‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏ó‡∏∏‡∏Å attempt (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö import ‡∏Å‡∏•‡∏±‡∏ö)
    const hdr2=['attempt_id','examId','examTitle','examSubject','takerName','startedAt','submittedAt','usedSeconds','score','total','no','isCorrect','correct','answered'];
    const rows2=[];
    attempts.forEach(a=>{
      if(!Array.isArray(a.perQuestion)||!a.perQuestion.length){
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ perQuestion ‡πÉ‡∏™‡πà‡πÅ‡∏ñ‡∏ß‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô
        rows2.push([a.id,a.examId,a.examTitle,a.examSubject,a.takerName,a.startedAt,a.submittedAt,a.usedSeconds,a.score,a.total,'','','','']);
      } else {
        a.perQuestion.forEach(p=>{
          rows2.push([a.id,a.examId,a.examTitle,a.examSubject,a.takerName,a.startedAt,a.submittedAt,a.usedSeconds,a.score,a.total,p.no,p.isCorrect?1:0,p.correct||'',p.answered||'']);
        });
      }
    });
    const ws2=XLSX.utils.aoa_to_sheet([hdr2,...rows2]);
    ws2['!cols']=[{wch:20},{wch:20},{wch:28},{wch:14},{wch:14},{wch:22},{wch:22},{wch:10},{wch:7},{wch:7},{wch:6},{wch:8},{wch:8},{wch:8}];

    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws1,'‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    XLSX.utils.book_append_sheet(wb,ws2,'‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠');
    XLSX.writeFile(wb,`‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥_${new Date().toISOString().slice(0,10)}.xlsx`);
  };

  document.getElementById('statsFileImport').onchange=async(e)=>{
    const file=e.target.files&&e.target.files[0];
    if(!file) return;
    try{
      if(typeof XLSX==='undefined') throw new Error('SheetJS ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à');
      const buf=await file.arrayBuffer();
      const wb=XLSX.read(buf,{type:'array'});

      // ‡∏≠‡πà‡∏≤‡∏ô sheet "‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠" ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö
      const sheetName=wb.SheetNames.includes('‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠')?'‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠':wb.SheetNames[1]||wb.SheetNames[0];
      const ws=wb.Sheets[sheetName];
      const rows=XLSX.utils.sheet_to_json(ws,{defval:''});

      if(!rows.length) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå');

      // group rows by attempt_id ‚Üí rebuild attempts array
      const map=new Map();
      rows.forEach(r=>{
        const aid=String(r['attempt_id']||'').trim();
        if(!aid) return;
        if(!map.has(aid)){
          map.set(aid,{
            id:aid,
            examId:String(r['examId']||''),
            examTitle:String(r['examTitle']||''),
            examSubject:String(r['examSubject']||''),
            takerName:String(r['takerName']||''),
            startedAt:String(r['startedAt']||''),
            submittedAt:String(r['submittedAt']||''),
            usedSeconds:Number(r['usedSeconds'])||0,
            score:Number(r['score'])||0,
            total:Number(r['total'])||0,
            perQuestion:[],
          });
        }
        const no=Number(r['no']);
        if(no>0){
          map.get(aid).perQuestion.push({
            no,
            isCorrect:Number(r['isCorrect'])===1||r['isCorrect']===true||r['isCorrect']==='true',
            correct:String(r['correct']||''),
            answered:String(r['answered']||''),
          });
        }
      });

      const imported=Array.from(map.values());
      if(!imported.length) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö attempt ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå');

      const s=Store.load();
      // merge: ‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö attempt ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡∏ï‡∏≤‡∏° id)
      const existingIds=new Set((s.attempts||[]).map(a=>a.id));
      const newOnes=imported.filter(a=>!existingIds.has(a.id));
      s.attempts=[...newOnes,...(s.attempts||[])];
      Store.save(s);
      render();
      toast(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${imported.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÉ‡∏´‡∏°‡πà ${newOnes.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`);
    }
    catch(err){alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+(err?.message||err));}
    finally{e.target.value='';}
  };

  document.getElementById('statsBtnClear').onclick=()=>{
    if(!confirm('‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')) return;
    const s=Store.load();s.attempts=[];Store.save(s);render();
  };

  render();
}

// ===================== ADMIN PAGE =====================
function initAdmin(){
  const s=Store.init();
  let subjectFilter='';
  const subjFilterEl=document.getElementById('adminSubjFilter');

  document.getElementById('adminLoginBtn').onclick=()=>{s.adminLoggedIn=true;Store.save(s);toast('Logged in (demo)');renderAdmin();};
  document.getElementById('adminLogoutBtn').onclick=()=>{s.adminLoggedIn=false;Store.save(s);toast('Logged out (demo)');renderAdmin();};
  if(subjFilterEl) subjFilterEl.onchange=(e)=>{subjectFilter=e.target.value;renderAdmin();};

  function renderAdmin(){
    if(!s.adminLoggedIn){
      document.getElementById('adminGate').innerHTML=`<div class="card" style="padding:16px;"><div style="font-weight:900;">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô</div><div class="muted" style="margin-top:6px;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Login ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô (‡πÄ‡∏î‡πÇ‡∏°)</div></div>`;
      document.getElementById('adminContent').style.display='none';
      return;
    }
    document.getElementById('adminGate').innerHTML='';
    document.getElementById('adminContent').style.display='block';

    const all=(s.exams||[]).slice().sort((a,b)=>((a.order??0)-(b.order??0))||((a.uploadedAt??0)-(b.uploadedAt??0)));
    const subjects=Array.from(new Set(all.map(e=>(e.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏')))).sort((a,b)=>a.localeCompare(b,'th'));
    if(subjFilterEl){
      subjFilterEl.innerHTML=`<option value="">‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>${subjects.map(sub=>`<option value="${esc(sub)}" ${sub===subjectFilter?'selected':''}>${esc(sub)}</option>`).join('')}`;
    }

    const list=subjectFilter?all.filter(e=>(e.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏')===subjectFilter):all;
    const fmtDate=(ts)=>{if(!ts) return '-';try{return new Date(ts).toLocaleString('th-TH');}catch{return '-';}};
    const tb=document.getElementById('adminTbody');tb.innerHTML='';
    list.forEach((e,idx)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td style="font-weight:900;">${esc(e.title)}</td>
        <td>${esc(e.subject||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏')}</td>
        <td><div style="display:flex;flex-direction:column;gap:6px;"><button class="btn" style="padding:6px 10px;" data-move="up" data-id="${e.id}" ${idx===0?'disabled':''}>‚ñ≤</button><button class="btn" style="padding:6px 10px;" data-move="down" data-id="${e.id}" ${idx===list.length-1?'disabled':''}>‚ñº</button></div></td>
        <td><div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;"><span class="badge ${e.published?'ok':'warn'}">${e.published?'‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà':'‡∏ã‡πà‡∏≠‡∏ô'}</span><select class="statusSel" data-status="${e.id}" style="padding:6px 10px;border:1px solid var(--border);border-radius:12px;background:#fff;"><option value="published" ${e.published?'selected':''}>‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</option><option value="hidden" ${!e.published?'selected':''}>‡∏ã‡πà‡∏≠‡∏ô</option></select></div></td>
        <td>${e.questionCount}</td>
        <td class="muted">${fmtDate(e.uploadedAt)}</td>
        <td class="muted" style="max-width:260px;word-break:break-all;">${esc(e.pdfUrl)}</td>
        <td><button class="btn" data-edit="${e.id}">‡πÄ‡∏õ‡∏¥‡∏î Editor</button></td>
        <td><button class="btn" style="border-color:#ef4444;color:#b91c1c;" data-del="${e.id}">‡∏•‡∏ö</button></td>
      `;
      tb.appendChild(tr);
    });
    tb.querySelectorAll('[data-status]').forEach(sel=>{
      sel.addEventListener('change',()=>{
        const id=sel.getAttribute('data-status');const exam=s.exams.find(x=>x.id===id);if(!exam) return;
        exam.published=(sel.value==='published');Store.save(s);toast(exam.published?'‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß':'‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß');renderAdmin();
      });
    });
    tb.querySelectorAll('[data-del]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id=btn.getAttribute('data-del');const exam=s.exams.find(x=>x.id===id);if(!exam) return;
        if(!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${exam.title}"?`)) return;
        s.exams=s.exams.filter(x=>x.id!==id);
        if(s.questions&&s.questions[id]) delete s.questions[id];
        Store.save(s);toast('‡∏•‡∏ö‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß');renderAdmin();
      });
    });
    tb.querySelectorAll('[data-edit]').forEach(btn=>{
      btn.addEventListener('click',()=>navigate('admin_editor',{id:btn.getAttribute('data-edit')}));
    });
    tb.querySelectorAll('[data-move]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id=btn.getAttribute('data-id'),dir=btn.getAttribute('data-move');
        s.exams.forEach((ex,idx)=>{if(typeof ex.order!=='number') ex.order=idx+1;});
        const sorted=s.exams.slice().sort((a,b)=>((a.order??0)-(b.order??0))||((a.uploadedAt??0)-(b.uploadedAt??0)));
        const i=sorted.findIndex(x=>x.id===id);if(i<0) return;
        const j=dir==='up'?i-1:i+1;if(j<0||j>=sorted.length) return;
        const tmp=sorted[i].order;sorted[i].order=sorted[j].order;sorted[j].order=tmp;
        Store.save(s);renderAdmin();
      });
    });
  }

  renderAdmin();
}

// ===================== ADMIN NEW PAGE =====================
function initAdminNew(){
  const s=Store.init();
  if(!s.adminLoggedIn){navigate('admin');return;}

  let lastUploadedPdfKey=null;
  const pdfFileEl=document.getElementById('newPdfFile');
  const pdfUrlEl=document.getElementById('newPdfUrl');

  // reset file input
  if(pdfFileEl) pdfFileEl.value='';

  const newPdfFileEl=pdfFileEl.cloneNode(true);
  pdfFileEl.parentNode.replaceChild(newPdfFileEl,pdfFileEl);
  newPdfFileEl.addEventListener('change',async(e)=>{
    try{
      const f=e.target.files&&e.target.files[0];
      if(!f) return;
      if(f.type&&f.type!=='application/pdf'){toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF');return;}
      const key=`pdf_${Date.now()}_${Math.random().toString(16).slice(2)}`;
      await PdfDB.put(key,f);
      lastUploadedPdfKey=key;
      pdfUrlEl.value=`localpdf:${key}`;
      toast('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)');
    }catch(err){toast('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+(err?.message||err));}
  });

  const createBtn=document.getElementById('newCreateBtn');
  const newCreateBtn=createBtn.cloneNode(true);
  createBtn.parentNode.replaceChild(newCreateBtn,createBtn);
  newCreateBtn.addEventListener('click',()=>{
    const title=document.getElementById('newTitle').value.trim()||'Exam ‡πÉ‡∏´‡∏°‡πà';
    const subject=document.getElementById('newSubject').value.trim();
    const minutes=Math.max(1,Number(document.getElementById('newMinutes').value||45));
    const published=document.getElementById('newPublished').value==='true';
    const pdfUrl=document.getElementById('newPdfUrl').value.trim();
    const createPlaceholder=document.getElementById('newCreatePlaceholder').checked;
    const qCount=Math.min(999,Math.max(1,Math.floor(Number(document.getElementById('newQCount').value||50))));
    if(!subject) return toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤');
    const maxOrder=Math.max(0,...(s.exams||[]).map(e=>(typeof e.order==='number'?e.order:0)));
    const id='exam_'+Math.random().toString(16).slice(2);
    s.exams.unshift({id,subject,title,durationSeconds:Math.round(minutes*60),published,pdfUrl,questionCount:createPlaceholder?qCount:0,uploadedAt:Date.now(),order:maxOrder+1});
    s.questions[id]=createPlaceholder?Array.from({length:qCount}).map((_,i)=>({id:'q'+(i+1),number:i+1,no:i+1,page:Math.max(1,Math.ceil((i+1)/5)),choices:{A:'',B:'',C:'',D:''},correct:'A'})):[];
    // apply excel data ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    if(window._newExcelData && window._newExcelData.length > 0){
      window._newExcelData.forEach(row=>{
        const q=s.questions[id].find(q=>(q.number||q.no)===row.no);
        if(q){ q.page=row.page; q.correct=row.correct; }
      });
      window._newExcelData=null;
    }
    Store.save(s);toast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    setTimeout(()=>navigate('admin_editor',{id}),400);
  });
}

// ===================== ADMIN EDITOR PAGE =====================
function initEditor(examId){
  const s=Store.init();
  if(!s.adminLoggedIn){navigate('admin');return;}
  const exam=s.exams.find(e=>e.id===examId);
  if(!exam){navigate('admin');return;}

  // normalize
  const list=(s.questions[examId]||[]).map(q=>({...q, no:q.no??q.number??0}));

  document.getElementById('editorTitle').textContent='‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö: '+exam.title;
  document.getElementById('editorMeta').textContent=`‡πÄ‡∏ß‡∏•‡∏≤ ${Math.round(exam.durationSeconds/60)} ‡∏ô‡∏≤‡∏ó‡∏µ ‚Ä¢ PDF: ${exam.pdfUrl} ‚Ä¢ ‡∏ß‡∏¥‡∏ä‡∏≤: ${exam.subject||'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}`;

  const titleInput=document.getElementById('editorExamTitle');
  const renameBtn=document.getElementById('editorRenameBtn');
  if(titleInput) titleInput.value=exam.title||'';

  function applyRename(){
    const v=(titleInput?.value||'').trim();
    if(!v){alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö');titleInput?.focus?.();return;}
    exam.title=v;Store.save(s);
    document.getElementById('editorTitle').textContent='‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö: '+exam.title;
    toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß');
  }
  renameBtn.onclick=(e)=>{e.preventDefault();applyRename();};
  titleInput.onkeydown=(e)=>{if(e.key==='Enter'){e.preventDefault();applyRename();}};

  const subjectInput=document.getElementById('editorExamSubject');
  const subjectBtn=document.getElementById('editorSubjectBtn');
  if(subjectInput) subjectInput.value=exam.subject||'';

  function applySubject(){
    const v=(subjectInput?.value||'').trim()||'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';
    exam.subject=v;Store.save(s);
    document.getElementById('editorMeta').textContent=`‡πÄ‡∏ß‡∏•‡∏≤ ${Math.round(exam.durationSeconds/60)} ‡∏ô‡∏≤‡∏ó‡∏µ ‚Ä¢ PDF: ${exam.pdfUrl} ‚Ä¢ ‡∏ß‡∏¥‡∏ä‡∏≤: ${exam.subject||'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}`;
    toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
  }
  subjectBtn.onclick=(e)=>{e.preventDefault();applySubject();};
  subjectInput.onkeydown=(e)=>{if(e.key==='Enter'){e.preventDefault();applySubject();}};

  let selectedIndex=0;
  const refs={};
  const fieldOrder=['page','correct'];

  function select(i){selectedIndex=Math.max(0,Math.min(list.length-1,i));highlight();}
  function highlight(){[...document.getElementById('editorTbody').children].forEach((tr,idx)=>{tr.className=idx===selectedIndex?'rowActive':'';}); }
  function focusField(ri,field){const el=refs[`${ri}:${field}`];if(el&&el.focus) el.focus();}
  function nextField(ri,field){const i=fieldOrder.indexOf(field);if(i<fieldOrder.length-1) return{rowIndex:ri,field:fieldOrder[i+1]};return{rowIndex:Math.min(ri+1,list.length-1),field:'page'};}
  function prevField(ri,field){const i=fieldOrder.indexOf(field);if(i>0) return{rowIndex:ri,field:fieldOrder[i-1]};return{rowIndex:Math.max(ri-1,0),field:'correct'};}
  function onFastKey(e,ri,field){
    if(!document.getElementById('editorFast').checked) return;
    if(e.key==='Enter'||e.key==='Tab'){e.preventDefault();const back=e.shiftKey;const t=back?prevField(ri,field):nextField(ri,field);select(t.rowIndex);requestAnimationFrame(()=>focusField(t.rowIndex,t.field));}
  }

  function renderTable(){
    const tbody=document.getElementById('editorTbody');
    tbody.innerHTML='';
    // clear refs
    Object.keys(refs).forEach(k=>delete refs[k]);
    list.forEach((q,idx)=>{
      const tr=document.createElement('tr');
      tr.addEventListener('click',()=>select(idx));
      tr.innerHTML=`<td style="font-weight:900;">${q.number||q.no}</td><td><input type="number" min="1" value="${q.page}" data-field="page" /></td><td><div class="correctBtns" data-field="correct"><button type="button" class="correctBtn" data-val="A">‡∏Å</button><button type="button" class="correctBtn" data-val="B">‡∏Ç</button><button type="button" class="correctBtn" data-val="C">‡∏Ñ</button><button type="button" class="correctBtn" data-val="D">‡∏á</button></div></td>`;
      const correctVal = q.correct||'A';
      tr.querySelectorAll('.correctBtn').forEach(btn=>{
        if(btn.getAttribute('data-val')===correctVal) btn.classList.add('selected');
        btn.addEventListener('click',(e)=>{
          e.stopPropagation();
          select(idx);
          tr.querySelectorAll('.correctBtn').forEach(b=>b.classList.remove('selected'));
          btn.classList.add('selected');
          q.correct=btn.getAttribute('data-val');
        });
      });
      const pageInput = tr.querySelector('input[data-field="page"]');
      refs[`${idx}:page`]=pageInput;
      pageInput.addEventListener('focus',()=>select(idx));
      pageInput.addEventListener('keydown',(e)=>onFastKey(e,idx,'page'));
      pageInput.addEventListener('input',()=>{ q.page=Math.max(1,Number(pageInput.value||1)); });
      tbody.appendChild(tr);
    });
    select(selectedIndex);
  }
  renderTable();

  document.getElementById('editorSave').onclick=()=>{
    s.questions[examId]=list;Store.save(s);toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
  };

  // bind excel import ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö editor
  bindEditorExcel(examId, list, renderTable);
}

// ===================== EXCEL TEMPLATE DOWNLOAD =====================
function downloadExcelTemplate(qCount, filename) {
  if (typeof XLSX === 'undefined') { alert('SheetJS ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà'); return; }

  // header row
  const rows = [['‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà', '‡∏´‡∏ô‡πâ‡∏≤ PDF', '‡πÄ‡∏â‡∏•‡∏¢ (‡∏Å/‡∏Ç/‡∏Ñ/‡∏á)']];

  // data rows ‚Äî ‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏Å ‡πÑ‡∏ß‡πâ‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ ‡∏´‡∏ô‡πâ‡∏≤ PDF ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏•‡∏∞ 5 ‡∏Ç‡πâ‡∏≠
  for (let i = 1; i <= qCount; i++) {
    rows.push([i, Math.max(1, Math.ceil(i / 5)), '‡∏Å']);
  }

  const ws = XLSX.utils.aoa_to_sheet(rows);

  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á column
  ws['!cols'] = [{ wch: 10 }, { wch: 12 }, { wch: 20 }];

  // style header (SheetJS community ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà basic)
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, '‡πÄ‡∏â‡∏•‡∏¢');
  XLSX.writeFile(wb, filename || 'template_‡πÄ‡∏â‡∏•‡∏¢.xlsx');
}

// bind ‡∏õ‡∏∏‡πà‡∏° admin_new
(function bindNewTemplate() {
  const btn = document.getElementById('newDownloadTemplate');
  if (!btn) return;
  btn.addEventListener('click', () => {
    const qCount = Math.max(1, parseInt(document.getElementById('newQCount')?.value || 50));
    const title = (document.getElementById('newTitle')?.value || 'exam').trim().replace(/\s+/g, '_');
    downloadExcelTemplate(qCount, `template_${title}.xlsx`);
  });
})();

// ===================== EXCEL IMPORT =====================

// ‡πÅ‡∏õ‡∏•‡∏á ‡∏Å/‡∏Ç/‡∏Ñ/‡∏á ‡∏´‡∏£‡∏∑‡∏≠ A/B/C/D ‚Üí A/B/C/D
function normalizeAnswer(v) {
  if (!v) return null;
  const s = String(v).trim().toUpperCase();
  const map = {'‡∏Å':'A','‡∏Ç':'B','‡∏Ñ':'C','‡∏á':'D'};
  if (map[String(v).trim()]) return map[String(v).trim()];
  if (['A','B','C','D'].includes(s)) return s;
  return null;
}

// ‡∏≠‡πà‡∏≤‡∏ô Excel/CSV ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∑‡∏ô array [{no, page, correct}]
function parseExcelFile(file) {
  return new Promise((resolve, reject) => {
    if (typeof XLSX === 'undefined') {
      reject(new Error('SheetJS ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'));
      return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const wb = XLSX.read(e.target.result, { type: 'array' });
        const ws = wb.Sheets[wb.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(ws, { header: 1, defval: '' });

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô header ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤
        // ‡∏ñ‡πâ‡∏≤ col A ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‚Üí ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô header ‡∏Ç‡πâ‡∏≤‡∏°
        let startRow = 0;
        if (rows.length > 0) {
          const firstVal = String(rows[0][0] || '').trim();
          if (isNaN(Number(firstVal)) || firstVal === '') startRow = 1;
        }

        const result = [];
        for (let i = startRow; i < rows.length; i++) {
          const row = rows[i];
          const no = parseInt(row[0]);
          const page = parseInt(row[1]) || 1;
          const correct = normalizeAnswer(row[2]);
          if (!isNaN(no) && no > 0 && correct) {
            result.push({ no, page, correct });
          }
        }
        resolve(result);
      } catch(err) {
        reject(err);
      }
    };
    reader.onerror = () => reject(new Error('‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'));
    reader.readAsArrayBuffer(file);
  });
}

// ‚îÄ‚îÄ admin_new: bind excel input ‚îÄ‚îÄ
(function bindNewExcel() {
  const input = document.getElementById('newExcelFile');
  const status = document.getElementById('newExcelStatus');
  const preview = document.getElementById('newExcelPreview');
  if (!input) return;

  // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà parse ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô closure ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô create
  window._newExcelData = null;

  input.addEventListener('change', async () => {
    const file = input.files[0];
    if (!file) return;
    status.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô...';
    preview.style.display = 'none';
    try {
      const data = await parseExcelFile(file);
      if (data.length === 0) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà valid ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå');
      window._newExcelData = data;
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï qCount ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö excel
      const qCountEl = document.getElementById('newQCount');
      if (qCountEl) qCountEl.value = data.length;
      status.textContent = '';
      preview.style.display = 'block';
      preview.textContent = `‚úÖ ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${data.length} ‡∏Ç‡πâ‡∏≠ ‚Äî ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏Ç‡πâ‡∏≠${data[0].no} ‡∏´‡∏ô‡πâ‡∏≤${data[0].page} ‡πÄ‡∏â‡∏•‡∏¢${data[0].correct}`;
    } catch(err) {
      window._newExcelData = null;
      status.textContent = '‚ùå ' + err.message;
      preview.style.display = 'none';
    }
  });
})();

// ‚îÄ‚îÄ admin_editor: bind excel input ‚îÄ‚îÄ
function bindEditorExcel(examId, list, renderFn) {
  // bind template download
  const dlBtn = document.getElementById('editorDownloadTemplate');
  if (dlBtn) {
    const newDlBtn = dlBtn.cloneNode(true);
    dlBtn.parentNode.replaceChild(newDlBtn, dlBtn);
    newDlBtn.addEventListener('click', () => {
      downloadExcelTemplate(list.length, `template_‡πÄ‡∏â‡∏•‡∏¢_${examId}.xlsx`);
    });
  }

  const input = document.getElementById('editorExcelFile');
  const status = document.getElementById('editorExcelStatus');
  if (!input) return;

  // remove old listener
  const newInput = input.cloneNode(true);
  input.parentNode.replaceChild(newInput, input);

  newInput.addEventListener('change', async () => {
    const file = newInput.files[0];
    if (!file) return;
    status.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô...';
    try {
      const data = await parseExcelFile(file);
      if (data.length === 0) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà valid ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå');

      // merge ‡πÄ‡∏Ç‡πâ‡∏≤ list
      let updated = 0;
      data.forEach(row => {
        const q = list.find(q => (q.number || q.no) === row.no);
        if (q) {
          q.page = row.page;
          q.correct = row.correct;
          updated++;
        }
      });
      // re-render table
      if (renderFn) renderFn();
      status.textContent = `‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ${updated} ‡∏Ç‡πâ‡∏≠`;
      toast(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${updated} ‡∏Ç‡πâ‡∏≠`);
    } catch(err) {
      status.textContent = '‚ùå ' + err.message;
    }
  });
}


const PRESET_BENCHMARKS = [{"id": "bm_gate69", "name": "‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö GATE ‡∏õ‡∏µ 2569 (‡∏ú‡∏•‡∏à‡∏£‡∏¥‡∏á)", "examId": null, "rows": [{"rank": 1, "total": 834.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 336.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 350.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 88.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 3, "total": 750.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 4, "total": 742.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 80.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 68.0}}, {"rank": 11, "total": 726.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 80.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 12, "total": 724.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 84.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 13, "total": 722.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 310.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 14, "total": 722.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 20, "total": 708.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 352.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 21, "total": 706.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 22, "total": 704.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 340.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 26, "total": 694.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 28.0}}, {"rank": 27, "total": 694.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 28, "total": 694.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 32, "total": 686.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 35, "total": 682.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 368.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 36, "total": 680.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 300.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 60.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 37, "total": 680.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 42, "total": 672.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 45, "total": 666.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 310.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 80.0}}, {"rank": 49, "total": 660.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 300.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 72.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 50, "total": 658.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 52, "total": 654.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 58, "total": 650.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 63, "total": 648.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 65, "total": 648.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 68, "total": 646.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 74, "total": 638.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 72.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 75, "total": 638.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 76, "total": 636.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 88.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 32.0}}, {"rank": 78, "total": 636.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 79, "total": 632.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 208.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 80.0}}, {"rank": 84, "total": 624.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 85, "total": 624.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 68.0}}, {"rank": 87, "total": 624.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 32.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 94, "total": 620.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 24.0}}, {"rank": 94, "total": 620.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 24.0}}, {"rank": 97, "total": 618.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 68.0}}, {"rank": 98, "total": 618.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 101, "total": 616.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 105, "total": 612.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 106, "total": 612.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 108, "total": 610.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 109, "total": 608.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 300.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 32.0}}, {"rank": 111, "total": 606.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 112, "total": 604.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 113, "total": 604.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 114, "total": 604.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 118, "total": 600.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 120, "total": 600.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 123, "total": 598.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 126, "total": 596.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 80.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 12.0}}, {"rank": 128, "total": 594.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 80.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 129, "total": 592.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 24.0}}, {"rank": 132, "total": 590.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 208.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 134, "total": 590.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 60.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 135, "total": 588.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 25.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 64.0}}, {"rank": 140, "total": 582.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 20.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 40.0}}, {"rank": 142, "total": 582.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 58.0}}, {"rank": 143, "total": 582.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 146, "total": 578.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 147, "total": 578.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 150, "total": 578.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 152, "total": 576.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 155, "total": 574.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 156, "total": 574.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 163, "total": 570.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 165, "total": 566.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 20.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 167, "total": 562.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 169, "total": 560.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 208.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 185, "total": 552.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 72.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 190, "total": 550.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 72.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 198, "total": 544.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 20.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 199, "total": 544.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 24.0}}, {"rank": 202, "total": 544.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 212, "total": 538.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 213, "total": 538.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 32.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 239, "total": 520.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 16.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 40.0}}, {"rank": 244, "total": 520.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 255, "total": 510.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 32.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 262, "total": 508.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 276, "total": 500.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 176.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 292, "total": 490.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 208.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 309, "total": 484.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 208.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 311, "total": 484.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 144.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 316, "total": 482.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 176.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 317, "total": 482.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 144.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 72.0}}, {"rank": 321, "total": 480.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 412, "total": 428.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 176.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}], "subjectCols": ["‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢"], "totalRanks": 900, "createdAt": 1700000000000}, {"id": "bm_eplus69", "name": "‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö EPLUS ‡∏õ‡∏µ 2569 (‡∏ú‡∏•‡∏à‡∏£‡∏¥‡∏á)", "examId": null, "rows": [{"rank": 1, "total": 876.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 480.0}}, {"rank": 2, "total": 872.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 212.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 3, "total": 841.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 181.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 5, "total": 817.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 187.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 460.0}}, {"rank": 6, "total": 808.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 450.0}}, {"rank": 8, "total": 803.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 193.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 410.0}}, {"rank": 9, "total": 802.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 162.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 470.0}}, {"rank": 10, "total": 795.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 460.0}}, {"rank": 11, "total": 793.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 140.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 193.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 460.0}}, {"rank": 12, "total": 793.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 193.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 360.0}}, {"rank": 12, "total": 793.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 193.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 360.0}}, {"rank": 13, "total": 791.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 181.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 460.0}}, {"rank": 14, "total": 791.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 181.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 14, "total": 791.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 181.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 17, "total": 781.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 131.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 460.0}}, {"rank": 19, "total": 778.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 140.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 470.0}}, {"rank": 21, "total": 770.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 460.0}}, {"rank": 22, "total": 770.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 460.0}}, {"rank": 23, "total": 770.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 450.0}}, {"rank": 25, "total": 767.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 137.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 440.0}}, {"rank": 29, "total": 763.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 193.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 400.0}}, {"rank": 30, "total": 762.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 162.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 33, "total": 756.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 130.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 470.0}}, {"rank": 34, "total": 756.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 450.0}}, {"rank": 36, "total": 755.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 370.0}}, {"rank": 37, "total": 752.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 162.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 38, "total": 750.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 450.0}}, {"rank": 38, "total": 750.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 450.0}}, {"rank": 39, "total": 748.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 40, "total": 748.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 41, "total": 747.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 140.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 187.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 42, "total": 747.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 187.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 370.0}}, {"rank": 44, "total": 745.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 50, "total": 736.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 90.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 490.0}}, {"rank": 51, "total": 735.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 130.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 52, "total": 732.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 162.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 400.0}}, {"rank": 56, "total": 725.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 130.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 56, "total": 725.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 130.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 57, "total": 725.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 125.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 410.0}}, {"rank": 58, "total": 725.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 400.0}}, {"rank": 61, "total": 721.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 130.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 181.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 410.0}}, {"rank": 62, "total": 718.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 80.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 470.0}}, {"rank": 63, "total": 718.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 140.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 410.0}}, {"rank": 64, "total": 718.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 218.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 330.0}}, {"rank": 66, "total": 717.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 110.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 187.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 68, "total": 715.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 175.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 69, "total": 713.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 140.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 143.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 70, "total": 712.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 162.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 72, "total": 708.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 390.0}}, {"rank": 79, "total": 697.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 187.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 390.0}}, {"rank": 80, "total": 696.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 60.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 480.0}}, {"rank": 84, "total": 693.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 143.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 360.0}}, {"rank": 95, "total": 686.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 380.0}}, {"rank": 98, "total": 682.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 162.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 360.0}}, {"rank": 112, "total": 671.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 100.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 131.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 440.0}}, {"rank": 129, "total": 657.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 87.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 390.0}}, {"rank": 133, "total": 652.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 162.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 310.0}}, {"rank": 134, "total": 651.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 130.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 131.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 390.0}}, {"rank": 196, "total": 607.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 137.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 350.0}}, {"rank": 215, "total": 590.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 100.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 340.0}}, {"rank": 234, "total": 566.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 90.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 320.0}}, {"rank": 248, "total": 553.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 143.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 290.0}}, {"rank": 252, "total": 547.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 50.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 87.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 410.0}}], "subjectCols": ["‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"], "totalRanks": 900, "createdAt": 1700000000000}, {"id": "bm_gate68", "name": "‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö GATE ‡∏õ‡∏µ 2568 (‡∏ú‡∏•‡∏à‡∏£‡∏¥‡∏á)", "examId": null, "rows": [{"rank": 1, "total": 826.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 368.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 330.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 92.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 2, "total": 768.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 336.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 300.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 84.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 3, "total": 744.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 352.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 300.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 6, "total": 722.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 336.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 88.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 8, "total": 710.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 352.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 32.0}}, {"rank": 9, "total": 702.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 60.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 12, "total": 692.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 384.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 88.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 20.0}}, {"rank": 14, "total": 690.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 336.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 15, "total": 688.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 368.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 16, "total": 686.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 290.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 48.0}}, {"rank": 17, "total": 684.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 320.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 20.0}}, {"rank": 27, "total": 646.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 28.0}}, {"rank": 28, "total": 644.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 31, "total": 640.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 80.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 32, "total": 640.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 33, "total": 638.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 34, "total": 636.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 336.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 68.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 35, "total": 636.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 60.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 52.0}}, {"rank": 37, "total": 634.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 39, "total": 632.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 40, "total": 630.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 270.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 28.0}}, {"rank": 45, "total": 628.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 46, "total": 628.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 60.0}}, {"rank": 49, "total": 620.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 51, "total": 618.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 352.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 32.0}}, {"rank": 53, "total": 616.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 55, "total": 616.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 54.0}}, {"rank": 60, "total": 612.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 208.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 300.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 60.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 70, "total": 602.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 71, "total": 600.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 28.0}}, {"rank": 79, "total": 594.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 40.0}}, {"rank": 80, "total": 592.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 81, "total": 592.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 12.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 32.0}}, {"rank": 82, "total": 592.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 84, "total": 590.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 60.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 86, "total": 590.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 272.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 32.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 88, "total": 586.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 16.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 32.0}}, {"rank": 91, "total": 584.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 56.0}}, {"rank": 93, "total": 582.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 28.0}}, {"rank": 97, "total": 578.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 98, "total": 578.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 56.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 32.0}}, {"rank": 102, "total": 574.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 44.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 104, "total": 572.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 36.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 40.0}}, {"rank": 105, "total": 572.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 12.0}}, {"rank": 111, "total": 568.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 260.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 112, "total": 568.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 220.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 64.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 113, "total": 568.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 200.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 28.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 116, "total": 566.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 60.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 122, "total": 562.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 224.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 52.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 123, "total": 562.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 40.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 128, "total": 560.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 288.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 76.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 36.0}}, {"rank": 131, "total": 558.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 256.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 210.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 48.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}, {"rank": 138, "total": 550.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 240.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 250.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 20.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 40.0}}, {"rank": 140, "total": 548.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 304.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 24.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 40.0}}, {"rank": 142, "total": 548.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 192.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 280.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 32.0, "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢": 44.0}}], "subjectCols": ["‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢"], "totalRanks": 855, "createdAt": 1700000000000}, {"id": "bm_eplus68", "name": "‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö EPLUS ‡∏õ‡∏µ 2568 (‡∏ú‡∏•‡∏à‡∏£‡∏¥‡∏á)", "examId": null, "rows": [{"rank": 1, "total": 828.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 230.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 168.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 3, "total": 726.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 180.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 390.0}}, {"rank": 11, "total": 665.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 125.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 350.0}}, {"rank": 13, "total": 658.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 160.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 118.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 380.0}}, {"rank": 15, "total": 641.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 131.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 340.0}}, {"rank": 16, "total": 641.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 131.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 360.0}}, {"rank": 17, "total": 640.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 370.0}}, {"rank": 20, "total": 636.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 80.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 156.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 400.0}}, {"rank": 23, "total": 626.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 100.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 106.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 24, "total": 622.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 190.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 112.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 320.0}}, {"rank": 25, "total": 622.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 140.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 62.6, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 420.0}}, {"rank": 27, "total": 620.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 80.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 390.0}}, {"rank": 28, "total": 618.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 118.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 330.0}}, {"rank": 30, "total": 612.5, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 112.5, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 380.0}}, {"rank": 33, "total": 608.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 140.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 68.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 400.0}}, {"rank": 35, "total": 606.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 170.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 106.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 330.0}}, {"rank": 37, "total": 601.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 90.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 81.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 430.0}}, {"rank": 44, "total": 591.25, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 150.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 81.25, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 360.0}}, {"rank": 49, "total": 583.75, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 120.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 93.75, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 370.0}}, {"rank": 52, "total": 580.0, "subjects": {"‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 100.0, "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": 100.0, "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": 380.0}}, {"rank": 59, "total": 563.75, "subjects": {}}], "subjectCols": ["‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"], "totalRanks": 413, "createdAt": 1700000000000}];

// ===================== BENCHMARK HELPERS =====================

// interpolate ‡∏´‡∏≤‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏≤‡∏Å score
function bmInterpolateRank(rows, score, col) {
  // rows = [{rank, total, [subjectScores]}] ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° rank ascending
  if (!rows || !rows.length) return null;
  const vals = rows.map(r => ({rank: r.rank, score: col==='total' ? r.total : (r.subjects||{})[col]||null}))
    .filter(v => v.score !== null);
  if (!vals.length) return null;
  // ‡∏ñ‡πâ‡∏≤‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1
  if (score >= vals[0].score) return {rank: 1, exact: false};
  // ‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
  const last = vals[vals.length-1];
  if (score <= last.score) return {rank: last.rank, exact: false, below: true};
  // interpolate
  for (let i=0; i<vals.length-1; i++) {
    const hi = vals[i], lo = vals[i+1];
    if (score <= hi.score && score >= lo.score) {
      const t = (hi.score - score) / (hi.score - lo.score);
      const rank = Math.round(hi.rank + t * (lo.rank - hi.rank));
      return {rank, exact: false};
    }
  }
  return null;
}

// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì tier badge
function bmTierBadge(rank, totalRanks) {
  if (!rank || !totalRanks) return null;
  const pct = rank / totalRanks * 100;
  if (pct <= 5)  return {label:'üèÜ Top 5%',  color:'#16a34a', bg:'#dcfce7'};
  if (pct <= 10) return {label:'ü•á Top 10%', color:'#16a34a', bg:'#dcfce7'};
  if (pct <= 25) return {label:'ü•à Top 25%', color:'#d97706', bg:'#fef9c3'};
  if (pct <= 50) return {label:'üìä Top 50%', color:'#2563eb', bg:'#eff6ff'};
  return {label:'üìâ ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á', color:'#ef4444', bg:'#fff5f5'};
}

// ===================== INIT ADMIN BENCHMARK =====================
function initAdminBenchmark() {
  const s = Store.init();
  if (!s.adminLoggedIn) { navigate('admin'); return; }

  let _bmData = null; // parsed excel data

  // populate exam select
  const examSelect = document.getElementById('bmExamLink');
  if (examSelect) {
    examSelect.innerHTML = '<option value="">‚Äî ‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å ‚Äî</option>' +
      (s.exams||[]).map(e => `<option value="${e.id}">${e.subject} ¬∑ ${e.title}</option>`).join('');
  }

  // download template
  document.getElementById('bmDownloadTemplate').onclick = () => {
    if (typeof XLSX === 'undefined') { toast('SheetJS ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à'); return; }
    const subjects = [...new Set((s.exams||[]).map(e=>e.subject).filter(Boolean))];
    const headers = ['‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö', '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°', ...subjects];
    const rows = [headers];
    [1,5,10,20,30,50,100,150,200].forEach(r => {
      rows.push([r, '', ...subjects.map(()=>'')]);
    });
    const ws = XLSX.utils.aoa_to_sheet(rows);
    ws['!cols'] = headers.map((_,i) => ({wch: i===0?8:i===1?12:14}));
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Benchmark');
    XLSX.writeFile(wb, 'template_benchmark.xlsx');
  };

  // parse excel
  document.getElementById('bmExcelFile').onchange = async (e) => {
    const file = e.target.files[0]; if (!file) return;
    const status = document.getElementById('bmExcelStatus');
    const preview = document.getElementById('bmPreview');
    status.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô...'; preview.style.display='none';
    try {
      if (typeof XLSX === 'undefined') throw new Error('SheetJS ‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à');
      const buf = await file.arrayBuffer();
      const wb = XLSX.read(buf, {type:'array'});
      const ws = wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(ws, {header:1, defval:''});
      if (!rows.length) throw new Error('‡πÑ‡∏ü‡∏•‡πå‡∏ß‡πà‡∏≤‡∏á');

      // ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô header
      const headers = rows[0].map(h=>String(h).trim());
      // col 0 = rank, col 1 = total, col 2+ = subjects
      const subjectCols = headers.slice(2);
      const parsed = [];
      for (let i=1; i<rows.length; i++) {
        const r = rows[i];
        const rank = parseInt(r[0]);
        const total = parseFloat(r[1]);
        if (isNaN(rank) || isNaN(total)) continue;
        const subjects = {};
        subjectCols.forEach((col,ci) => {
          const v = parseFloat(r[2+ci]);
          if (!isNaN(v)) subjects[col] = v;
        });
        parsed.push({rank, total, subjects});
      }
      parsed.sort((a,b)=>a.rank-b.rank);
      if (!parsed.length) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà valid');
      _bmData = {rows: parsed, subjectCols, headers};
      status.textContent = '';
      preview.style.display = 'block';
      preview.textContent = `‚úÖ ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${parsed.length} ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ¬∑ ‡∏ß‡∏¥‡∏ä‡∏≤: ${subjectCols.join(', ')||'‡πÑ‡∏°‡πà‡∏°‡∏µ'} ¬∑ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: ${parsed[0].total}`;
    } catch(err) {
      _bmData = null;
      status.textContent = '‚ùå ' + err.message;
      preview.style.display = 'none';
    }
  };

  // save benchmark
  document.getElementById('bmSaveBtn').onclick = () => {
    const name = document.getElementById('bmName').value.trim();
    if (!name) return toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ Benchmark');
    if (!_bmData) return toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Excel ‡∏Å‡πà‡∏≠‡∏ô');
    const examId = document.getElementById('bmExamLink').value || null;
    const bm = {
      id: 'bm_' + Math.random().toString(16).slice(2),
      name, examId: examId||null,
      rows: _bmData.rows,
      subjectCols: _bmData.subjectCols,
      totalRanks: _bmData.rows[_bmData.rows.length-1].rank,
      createdAt: Date.now()
    };
    const st = Store.load();
    if (!Array.isArray(st.benchmarks)) st.benchmarks = [];
    st.benchmarks.unshift(bm);
    Store.save(st);
    _bmData = null;
    document.getElementById('bmName').value = '';
    document.getElementById('bmExcelFile').value = '';
    document.getElementById('bmPreview').style.display = 'none';
    document.getElementById('bmExcelStatus').textContent = '';
    toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Benchmark ‡πÅ‡∏•‡πâ‡∏ß');
    renderBmList();
  };

  function renderBmList() {
    const st = Store.load();
    const el = document.getElementById('bmList');
    const bms = st.benchmarks||[];
    if (!bms.length) {
      el.innerHTML = '<div class="muted" style="padding:16px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Benchmark</div>';
      return;
    }
    el.innerHTML = bms.map(bm => {
      const exam = (st.exams||[]).find(e=>e.id===bm.examId);
      const examLabel = exam ? `üìé ${exam.title}` : '‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö';
      return `<div class="card" style="padding:14px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
        <div>
          <div style="font-weight:800;">${bm.name}</div>
          <div class="muted" style="font-size:12px;margin-top:3px;">${examLabel} ¬∑ ${bm.rows.length} ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ¬∑ ‡∏ß‡∏¥‡∏ä‡∏≤: ${bm.subjectCols.join(', ')||'‡πÑ‡∏°‡πà‡∏°‡∏µ'} ¬∑ ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î rank ${bm.totalRanks}</div>
        </div>
        <button class="btn-delete" data-del-bm="${bm.id}">‡∏•‡∏ö</button>
      </div>`;
    }).join('');
    el.querySelectorAll('[data-del-bm]').forEach(btn => {
      btn.onclick = () => {
        if (!confirm('‡∏•‡∏ö Benchmark ‡∏ô‡∏µ‡πâ?')) return;
        const st2 = Store.load();
        st2.benchmarks = (st2.benchmarks||[]).filter(b=>b.id!==btn.getAttribute('data-del-bm'));
        Store.save(st2); renderBmList(); toast('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
      };
    });
  }
  renderBmList();
}

// ===================== BENCHMARK COMPARE WIDGET =====================
// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô ‡∏´‡∏ô‡πâ‡∏≤ result ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞ ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
// score = {total: number, totalMax: number, subjects: {‡∏ß‡∏¥‡∏ä‡∏≤: {score, max}}}
function renderBenchmarkWidget(containerId, score, examId) {
  const container = document.getElementById(containerId);
  if (!container) return;
  const s = Store.load();
  const bms = (s.benchmarks||[]).filter(bm => !bm.examId || bm.examId===examId);
  if (!bms.length) { container.innerHTML=''; return; }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á UI: toggle ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å benchmark (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö")
  const options = [{id:'none', name:'‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö'}, ...bms];

  function getHtml(selectedId) {
    const bm = bms.find(b=>b.id===selectedId);

    const toggleHtml = `<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;">
      ${options.map(o=>`<button class="bm-toggle-btn ${o.id===selectedId?'bm-toggle-active':''}" data-bmid="${o.id}"
        style="padding:5px 12px;border-radius:99px;font-size:12px;font-weight:700;cursor:pointer;border:1.5px solid ${o.id===selectedId?'#111':'var(--border)'};background:${o.id===selectedId?'#111':'#fff'};color:${o.id===selectedId?'#fff':'#374151'};">
        ${o.name}</button>`).join('')}
    </div>`;

    if (!bm) return `<div style="padding:12px;background:#f9fafb;border-radius:14px;border:1px solid var(--border);">${toggleHtml}<div class="muted" style="font-size:13px;">‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</div></div>`;

    // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°
    const pctScore = score.totalMax ? Math.round(score.total/score.totalMax*100) : 0;
    // normalize ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡πá‡∏ô % ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ benchmark ‡∏≠‡∏≤‡∏à‡∏°‡∏µ totalMax ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
    const bmMaxTotal = bm.rows[0]?.total||100;
    const normalizedScore = score.totalMax ? (score.total/score.totalMax)*bmMaxTotal : score.total;
    const rankResult = bmInterpolateRank(bm.rows, normalizedScore, 'total');
    const tier = rankResult ? bmTierBadge(rankResult.rank, bm.totalRanks) : null;

    // rows ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö bar chart
    const chartRows = [{
      label:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', score: normalizedScore, max: bmMaxTotal,
      rank: rankResult, tier, isTotal: true
    }];

    // ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤
    (bm.subjectCols||[]).forEach(subj => {
      const subData = score.subjects?.[subj];
      if (!subData) return;
      const bmMaxSubj = bm.rows[0]?.subjects?.[subj]||50;
      const normSubj = subData.max ? (subData.score/subData.max)*bmMaxSubj : subData.score;
      const r = bmInterpolateRank(bm.rows, normSubj, subj);
      chartRows.push({label:subj, score:normSubj, max:bmMaxSubj, rank:r, tier: r?bmTierBadge(r.rank,bm.totalRanks):null});
    });

    const barsHtml = chartRows.map(row => {
      const pct = row.max ? Math.round(row.score/row.max*100) : 0;
      const barColor = row.tier ? row.tier.color : '#9ca3af';
      const rankStr = row.rank ? (row.rank.below ? `> ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ${row.rank.rank}` : `~‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ${row.rank.rank}`) : '‚Äî';
      const tierHtml = row.tier ? `<span style="background:${row.tier.bg};color:${row.tier.color};border-radius:99px;padding:2px 8px;font-size:11px;font-weight:800;">${row.tier.label}</span>` : '';
      return `<div style="display:grid;gap:4px;margin-bottom:10px;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:4px;">
          <span style="font-weight:${row.isTotal?'900':'700'};font-size:${row.isTotal?'14':'13'}px;">${row.label}</span>
          <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;">
            ${tierHtml}
            <span style="font-size:12px;color:#6b7280;">${rankStr} ‡∏à‡∏≤‡∏Å ${bm.totalRanks} ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</span>
          </div>
        </div>
        <div style="height:8px;background:#e5e7eb;border-radius:99px;overflow:hidden;">
          <div style="height:100%;width:${pct}%;background:${barColor};border-radius:99px;transition:width .6s ease;"></div>
        </div>
        <div style="font-size:11px;color:#9ca3af;">${Math.round(row.score*10)/10} / ${row.max} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (${pct}%)</div>
      </div>`;
    }).join('');

    return `<div style="padding:14px;background:#f9fafb;border-radius:14px;border:1px solid var(--border);">
      ${toggleHtml}
      <div style="font-weight:800;font-size:13px;margin-bottom:10px;">‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö: ${bm.name}</div>
      ${barsHtml}
      <div class="muted" style="font-size:11px;margin-top:6px;">* ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å interpolation ‡∏Ç‡∏≠‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${bm.rows.map(r=>r.rank).join(', ')}</div>
    </div>`;
  }

  function render(selectedId) {
    container.innerHTML = getHtml(selectedId);
    container.querySelectorAll('.bm-toggle-btn').forEach(btn => {
      btn.onclick = () => render(btn.getAttribute('data-bmid'));
    });
  }
  render(bms[0]?.id||'none');
}

// ===================== INIT =====================
Store.init();
// Show login page on startup (navigate handles auth guard)
navigate('login');
setTimeout(()=>document.getElementById('loginPinInput')?.focus(), 300);



// ===================== ENTRANCE STATS =====================

// Metadata ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ benchmark
const BM_META = {
  bm_gate69:  { label:'GATE 2569', shortLabel:'GATE 69', color:'#6366f1', admit:144,
    criteria:[{subj:'‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:40},{subj:'‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:40},{subj:'‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©',pct:10},{subj:'‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢',pct:10}] },
  bm_eplus69: { label:'EPLUS 2569', shortLabel:'EPLUS 69', color:'#f59e0b', admit:90,
    criteria:[{subj:'‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:25},{subj:'‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:25},{subj:'‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©',pct:50}] },
  bm_gate68:  { label:'GATE 2568', shortLabel:'GATE 68', color:'#8b5cf6', admit:144,
    criteria:[{subj:'‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:40},{subj:'‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:40},{subj:'‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©',pct:10},{subj:'‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢',pct:10}] },
  bm_eplus68: { label:'EPLUS 2568', shortLabel:'EPLUS 68', color:'#10b981', admit:60,
    criteria:[{subj:'‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:25},{subj:'‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',pct:25},{subj:'‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©',pct:50}] },
};

function esBmAll() {
  return (Store.load().benchmarks || []);
}

// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì cutoff score (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏ì ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö)
function esCutoff(bm) {
  const meta = BM_META[bm.id];
  if (!meta) return null;
  const eligible = bm.rows.filter(r => r.rank <= meta.admit);
  if (!eligible.length) return null;
  return Math.min(...eligible.map(r => r.total));
}
function esCutoffRow(bm) {
  // return row ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô cutoff ‡∏à‡∏£‡∏¥‡∏á (rank <= admit, total ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î)
  const meta = BM_META[bm.id];
  if (!meta) return null;
  const eligible = bm.rows.filter(r => r.rank <= meta.admit);
  if (!eligible.length) return null;
  const minTotal = Math.min(...eligible.map(r => r.total));
  return eligible.find(r => r.total === minTotal) || null;
}

// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö‡∏ï‡∏¥‡∏î ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤
function esAvgAdmitted(bm) {
  const meta = BM_META[bm.id];
  if (!meta) return {};
  const admitted = bm.rows.filter(r => r.rank <= meta.admit && r.rank >= 1);
  if (!admitted.length) return {};
  const result = { total: 0 };
  let totalCount = 0;
  admitted.forEach(r => { result.total += r.total; totalCount++; });
  result.total = result.total / totalCount;
  // ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤
  const subjCounts = {};
  admitted.forEach(r => {
    Object.entries(r.subjects||{}).forEach(([k,v]) => {
      if (v == null) return;
      if (!result[k]) { result[k] = 0; subjCounts[k] = 0; }
      result[k] += v; subjCounts[k]++;
    });
  });
  Object.keys(subjCounts).forEach(k => { result[k] = result[k] / subjCounts[k]; });
  return result;
}

// ===================== ENTRANCE STATS ‚Äî ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà =====================

// ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
const ES_SCHOOLS = [
  { id: 'suankularb', name: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢', short: '‡∏™‡∏ß‡∏ô‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö',
    programs: [
      { id: 'gate',  name: 'GATE',  desc: '‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå + ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',  bmIds: ['bm_gate69','bm_gate68'] },
      { id: 'eplus', name: 'EPLUS', desc: '‡πÄ‡∏ô‡πâ‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© + ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå + ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', bmIds: ['bm_eplus69','bm_eplus68'] },
    ]
  },
  { id: 'other', name: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ', short: '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ', programs: [], comingSoon: true },
];

function esGetBms() { return Store.load().benchmarks || []; }

// state ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô sessionStorage ‡πÄ‡∏û‡∏∑‡πà‡∏≠ back ‡πÑ‡∏î‡πâ)
function esSaveState(obj) { sessionStorage.setItem('esState', JSON.stringify(obj)); }
function esGetState() { try { return JSON.parse(sessionStorage.getItem('esState')||'{}'); } catch { return {}; } }

// ‚îÄ‚îÄ ‡∏´‡∏ô‡πâ‡∏≤ 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚îÄ‚îÄ
function initEntranceStats() {
  const el = document.getElementById('esSchoolList');
  if (!el) return;
  el.innerHTML = ES_SCHOOLS.map((sch, idx) => {
    const programs = sch.programs.map(p=>p.name).join(' ¬∑ ');
    const sub = sch.comingSoon ? '‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ' : programs;
    const style = sch.comingSoon ? 'opacity:0.5;cursor:not-allowed;pointer-events:none;' : '';
    return '<div class="linkCard" data-school-idx="'+idx+'" style="'+style+'">'
      +'<div style="font-weight:900;font-size:16px;">'+sch.name+'</div>'
      +'<div class="muted" style="margin-top:6px;">'+sub+'</div>'
      +'</div>';
  }).join('');
  el.querySelectorAll('.linkCard').forEach(card => {
    const idx = parseInt(card.dataset.schoolIdx);
    const sch = ES_SCHOOLS[idx];
    if (sch && !sch.comingSoon) {
      card.onclick = () => navigate('entrance_program', {schoolId: sch.id});
    }
  });
}
// ‚îÄ‚îÄ ‡∏´‡∏ô‡πâ‡∏≤ 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‚îÄ‚îÄ
function initEntranceProgram(params) {
  const sch = ES_SCHOOLS.find(s=>s.id===(params?.schoolId||esGetState().schoolId));
  if (!sch) { navigate('entrance_stats'); return; }
  esSaveState({...esGetState(), schoolId: sch.id});

  document.getElementById('epSchoolTitle').textContent = sch.name;
  document.getElementById('epSchoolSub').textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';

  const el = document.getElementById('epProgramList');
  if (!el) return;
  el.innerHTML = sch.programs.map(prog => `
    <div class="linkCard" onclick="navigate('entrance_year',{schoolId:'${sch.id}',programId:'${prog.id}'})">
      <div style="font-weight:900;font-size:16px;">${prog.name}</div>
      <div class="muted" style="margin-top:6px;">${prog.desc}</div>
    </div>`).join('');
}

// ‚îÄ‚îÄ ‡∏´‡∏ô‡πâ‡∏≤ 3: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ + ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‚îÄ‚îÄ
function initEntranceYear(params) {
  const state = {...esGetState(), ...(params||{})};
  esSaveState(state);
  const {schoolId, programId} = state;

  const sch = ES_SCHOOLS.find(s=>s.id===schoolId);
  const prog = sch?.programs.find(p=>p.id===programId);
  if (!sch||!prog) { navigate('entrance_stats'); return; }

  document.getElementById('eyTitle').textContent = `${sch.short} ‚Äî ${prog.name}`;
  document.getElementById('eySub').textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏° 1,000 ‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
  document.getElementById('eyBackBtn').onclick = () => navigate('entrance_program', {schoolId});

  const bms = esGetBms();
  const progBms = prog.bmIds.map(id=>bms.find(b=>b.id===id)).filter(Boolean);
  if (!progBms.length) {
    document.getElementById('esOverviewCards').innerHTML = '<div class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
    return;
  }

  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô
  const yearOrder = {'bm_gate69':0,'bm_eplus69':0,'bm_gate68':1,'bm_eplus68':1};
  progBms.sort((a,b)=>(yearOrder[a.id]||0)-(yearOrder[b.id]||0));

  let activeBmId = progBms[0].id;

  // ‚îÄ‚îÄ Year tabs ‚îÄ‚îÄ
  function renderYearTabs() {
    const el = document.getElementById('eyYearTabs');
    if (!el) return;
    el.innerHTML = progBms.map(bm => {
      const meta = BM_META[bm.id]||{};
      const active = bm.id === activeBmId;
      const yearLabel = bm.id.endsWith('69') ? '‡∏õ‡∏µ 2569' : '‡∏õ‡∏µ 2568';
      return `<button onclick="eySetYear('${bm.id}')"
        style="padding:9px 20px;border-radius:12px;font-weight:700;font-size:14px;cursor:pointer;
               border:2px solid ${active?meta.color||'#111':'var(--border)'};
               background:${active?meta.color||'#111':'#fff'};color:${active?'#fff':'#374151'};">
        ${yearLabel}
      </button>`;
    }).join('');
  }
  window.eySetYear = function(id) { activeBmId = id; renderYear(); };

  // ‚îÄ‚îÄ Overview cards ‚îÄ‚îÄ
  function renderOverview() {
    const el = document.getElementById('esOverviewCards');
    if (!el) return;
    const bm = progBms.find(b=>b.id===activeBmId);
    if (!bm) return;
    const meta = BM_META[bm.id]||{};
    const cutoff = esCutoff(bm);
    const avg = esAvgAdmitted(bm);
    const topScore = bm.rows[0]?.total||0;
    const cards = [
      {label:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1)', value:topScore.toFixed(2), sub:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° (‡πÄ‡∏ï‡πá‡∏° 1,000)', color:meta.color},
      {label:'Cutoff Score', value:cutoff?cutoff.toFixed(2):'‚Äî', sub:(()=>{ const cr=esCutoffRow(bm); return cr?`‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${cr.rank} (‡∏£‡∏±‡∏ö ${meta.admit} ‡∏Ñ‡∏ô)`:`‡∏£‡∏±‡∏ö ${meta.admit} ‡∏Ñ‡∏ô`; })(), color:'#ef4444'},
      {label:'‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏ô‡∏™‡∏≠‡∏ö‡∏ï‡∏¥‡∏î', value:avg.total?avg.total.toFixed(1):'‚Äî', sub:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', color:'#16a34a'},
      {label:'‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°', value:bm.rows.length+' ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö', sub:`‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ${bm.totalRanks.toLocaleString()} ‡∏Ñ‡∏ô`, color:'#6b7280'},
    ];
    el.innerHTML = cards.map(c=>`
      <div class="stat-card" style="border-left:4px solid ${c.color};">
        <div class="stat-card-label">${c.label}</div>
        <div class="stat-card-value" style="color:${c.color};font-size:20px;">${c.value}</div>
        <div class="stat-card-sub">${c.sub}</div>
      </div>`).join('');
  }

  // ‚îÄ‚îÄ Distribution chart ‚îÄ‚îÄ
  function renderDistChart() {
    const canvas = document.getElementById('esDistChart');
    const emptyEl = document.getElementById('esDistEmpty');
    const bm = progBms.find(b=>b.id===activeBmId);
    if (!bm||!canvas) return;
    const meta = BM_META[bm.id]||{};
    const color = meta.color||'#6366f1';
    const cutoff = esCutoff(bm);
    const totals = bm.rows.map(r=>r.total).filter(v=>v>0);
    if (totals.length < 2) { canvas.style.display='none'; emptyEl.style.display='block'; return; }
    canvas.style.display='block'; emptyEl.style.display='none';

    const binSize = 50;
    const minV = Math.floor(Math.min(...totals)/binSize)*binSize;
    const maxV = Math.ceil(Math.max(...totals)/binSize)*binSize;
    const bins = [];
    for (let v=minV; v<maxV; v+=binSize) {
      bins.push({label:`${v}`, min:v, max:v+binSize, count:0, hasCutoff: cutoff&&cutoff>=v&&cutoff<v+binSize});
    }
    totals.forEach(t=>{ const b=bins.find(b=>t>=b.min&&t<b.max)||bins[bins.length-1]; if(b)b.count++; });

    const W = canvas.offsetWidth||400;
    const H = 200;
    canvas.width = W*2; canvas.height = H*2; // retina
    canvas.style.width = W+'px'; canvas.style.height = H+'px';
    const ctx = canvas.getContext('2d');
    ctx.scale(2,2);
    ctx.clearRect(0,0,W,H);

    const PAD = {t:28,r:16,b:52,l:44};
    const gW = W-PAD.l-PAD.r, gH = H-PAD.t-PAD.b;
    const maxCount = Math.max(...bins.map(b=>b.count),1);
    const bW = gW/bins.length;

    // Y grid lines + labels
    [0,0.25,0.5,0.75,1].forEach(pct => {
      const y = PAD.t + gH*(1-pct);
      const val = Math.round(maxCount*pct);
      ctx.strokeStyle='#e5e7eb'; ctx.lineWidth=0.5;
      ctx.beginPath(); ctx.moveTo(PAD.l,y); ctx.lineTo(PAD.l+gW,y); ctx.stroke();
      ctx.fillStyle='#9ca3af'; ctx.font='9px sans-serif'; ctx.textAlign='right';
      ctx.fillText(val, PAD.l-4, y+3);
    });

    // ‡πÅ‡∏Å‡∏ô Y title
    ctx.save();
    ctx.translate(10, PAD.t+gH/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillStyle='#6b7280'; ctx.font='bold 9px sans-serif'; ctx.textAlign='center';
    ctx.fillText('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Ñ‡∏ô)', 0, 0);
    ctx.restore();

    // bars
    bins.forEach((bin,i) => {
      const x = PAD.l+i*bW;
      const bh = (bin.count/maxCount)*gH;
      const y = PAD.t+gH-bh;
      ctx.fillStyle = bin.hasCutoff ? '#ef4444' : color+'cc';
      ctx.beginPath();
      ctx.roundRect(x+1.5, y, bW-3, bh, [3,3,0,0]);
      ctx.fill();
      if (bin.count>0) {
        ctx.fillStyle='#374151'; ctx.font='bold 9px sans-serif'; ctx.textAlign='center';
        ctx.fillText(bin.count, x+bW/2, y-4);
      }
    });

    // X labels ‚Äî ‡∏ó‡∏∏‡∏Å bar ‡πÅ‡∏™‡∏î‡∏á
    bins.forEach((bin,i) => {
      const x = PAD.l+i*bW+bW/2;
      ctx.fillStyle='#6b7280'; ctx.font='9px sans-serif'; ctx.textAlign='center';
      ctx.fillText(bin.label, x, H-PAD.b+14);
    });

    // ‡πÅ‡∏Å‡∏ô X title
    ctx.fillStyle='#6b7280'; ctx.font='bold 9px sans-serif'; ctx.textAlign='center';
    ctx.fillText('‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° (‡πÄ‡∏ï‡πá‡∏° 1,000)', PAD.l+gW/2, H-4);

    // cutoff dashed line
    const cutoffBinIdx = bins.findIndex(b=>b.hasCutoff);
    if (cutoffBinIdx>=0) {
      const cx = PAD.l + cutoffBinIdx*bW + bW/2;
      ctx.strokeStyle='#ef4444'; ctx.lineWidth=1.5;
      ctx.setLineDash([4,3]);
      ctx.beginPath(); ctx.moveTo(cx,PAD.t); ctx.lineTo(cx,PAD.t+gH); ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle='#ef4444'; ctx.font='bold 9px sans-serif'; ctx.textAlign='center';
      ctx.fillText(`cutoff ${cutoff?.toFixed(0)}`, cx, PAD.t-6);
    }
  }

  // ‚îÄ‚îÄ Criteria ‚îÄ‚îÄ
  function renderCriteria() {
    const el = document.getElementById('esCriteria');
    if (!el) return;
    const bm = progBms.find(b=>b.id===activeBmId);
    if (!bm) return;
    const meta = BM_META[bm.id]||{};
    const avg = esAvgAdmitted(bm);
    el.innerHTML = `
      <div class="muted" style="font-size:12px;margin-bottom:10px;">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
      ${(meta.criteria||[]).map(c=>`
        <div style="display:grid;gap:4px;margin-bottom:10px;">
          <div style="display:flex;justify-content:space-between;font-size:13px;">
            <span style="font-weight:700;">${c.subj}</span>
            <span style="color:${meta.color||'#111'};font-weight:800;">${c.pct}%</span>
          </div>
          <div style="height:6px;background:#e5e7eb;border-radius:99px;overflow:hidden;">
            <div style="height:100%;width:${c.pct}%;background:${meta.color||'#111'};border-radius:99px;"></div>
          </div>
          <div class="muted" style="font-size:11px;">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏ô‡∏™‡∏≠‡∏ö‡∏ï‡∏¥‡∏î: ${avg[c.subj]?avg[c.subj].toFixed(1):'‚Äî'}</div>
        </div>`).join('')}
      <div style="margin-top:10px;padding:8px 12px;background:#f9fafb;border-radius:10px;font-size:12px;line-height:1.7;">
        üìå ‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <b>${meta.admit||'‚Äî'} ‡∏Ñ‡∏ô</b><br>
        üìã ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏ß‡∏° <b>1,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</b>
      </div>`;
  }

  // ‚îÄ‚îÄ Rank table ‚îÄ‚îÄ
  function renderRankTable(filter='') {
    const bm = progBms.find(b=>b.id===activeBmId);
    const head = document.getElementById('esRankHead');
    const body = document.getElementById('esRankBody');
    if (!bm||!head||!body) return;
    const meta = BM_META[bm.id]||{};
    const subjs = bm.subjectCols||[];
    const maxTotal = Math.max(...bm.rows.map(r=>r.total));
    const maxSubj = {};
    subjs.forEach(s=>{ maxSubj[s]=Math.max(...bm.rows.map(r=>r.subjects?.[s]??-Infinity).filter(isFinite)); });

    head.innerHTML = `<tr>
      <th style="width:60px;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
      <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°<br/><span style="font-weight:400;font-size:10px;color:#9ca3af;">‚≠ê = ${maxTotal.toFixed(0)}</span></th>
      ${subjs.map(s=>`<th>${s}<br/><span style="font-weight:400;font-size:10px;color:#9ca3af;">‚≠ê ${maxSubj[s]?.toFixed(0)||'‚Äî'}</span></th>`).join('')}
      <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
    </tr>`;

    const rows = bm.rows.filter(r=>!filter||String(r.rank).includes(filter));
    body.innerHTML = rows.map(r=>{
      const admitted = r.rank<=meta.admit;
      const isCutoff = r.rank===meta.admit;
      const isTopTotal = r.total===maxTotal;
      const statusHtml = admitted
        ? `<span style="color:#16a34a;font-weight:700;font-size:11px;">‚úÖ ‡∏ï‡∏¥‡∏î</span>`
        : `<span style="color:#9ca3af;font-size:11px;">‚Äî</span>`;
      const rowStyle = isCutoff?'background:#fef9c3;':admitted?'background:#f0fdf4;':'';
      const cutoffBorder = isCutoff?'border-bottom:3px solid #ef4444;':'';
      const totalCell = `<td style="font-weight:700;">${r.total.toFixed(2)}${isTopTotal?' <span style="color:#f59e0b;">‚≠ê</span>':''}</td>`;
      const subjCells = subjs.map(s=>{
        const v=r.subjects?.[s];
        const isBest=v!=null&&v===maxSubj[s];
        return `<td style="${isBest?'background:#fffbeb;font-weight:800;':''}">${v!=null?v.toFixed(2):'‚Äî'}${isBest?' <span style="color:#f59e0b;">‚≠ê</span>':''}</td>`;
      }).join('');
      return `<tr style="${rowStyle}${cutoffBorder}">
        <td style="font-weight:800;text-align:center;">${r.rank}</td>
        ${totalCell}${subjCells}
        <td>${statusHtml}</td>
      </tr>`;
    }).join('')||`<tr><td colspan="${subjs.length+3}" class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
  }

  document.getElementById('esRankSearch')?.addEventListener('input', e=>renderRankTable(e.target.value));

  function renderYear() {
    renderYearTabs();
    renderOverview();
    requestAnimationFrame(()=>renderDistChart());
    renderCriteria();
    renderRankTable();
  }
  renderYear();
}

// ‚îÄ‚îÄ ‡∏´‡∏ô‡πâ‡∏≤ 4: ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏™‡∏≠‡∏ö ‚îÄ‚îÄ
function initEntranceCompare(params) {
  const state = esGetState();
  const bms   = esGetBms();
  document.getElementById('ecBackBtn').onclick = () => navigate('entrance_year', state);

  const SKEYS = { gate:'ecStudents_gate', eplus:'ecStudents_eplus' };
  const YKEYS = { gate:'ecYears_gate',    eplus:'ecYears_eplus' };
  function loadStu(p){ try{return JSON.parse(localStorage.getItem(SKEYS[p])||'[]');}catch{return[];} }
  function saveStu(p,a){
    localStorage.setItem(SKEYS[p],JSON.stringify(a));
    if(FirebaseSync.ready()) FirebaseSync.saveDoc(SKEYS[p], a).catch(()=>{});
  }
  function loadYrs(p){ try{return new Set(JSON.parse(localStorage.getItem(YKEYS[p])||'["69","68"]'));}catch{return new Set(['69','68']);} }
  function saveYrs(p,s){
    localStorage.setItem(YKEYS[p],JSON.stringify([...s]));
    if(FirebaseSync.ready()) FirebaseSync.saveDoc(YKEYS[p],[...s]).catch(()=>{});
  }
  // On load: try to pull latest from Firestore (async, update UI when done)
  async function syncEcFromCloud(p){
    const [stuCloud, yrCloud] = await Promise.all([
      FirebaseSync.loadDoc(SKEYS[p]),
      FirebaseSync.loadDoc(YKEYS[p])
    ]);
    let changed=false;
    if(stuCloud){
      try{ localStorage.setItem(SKEYS[p],JSON.stringify(stuCloud)); }catch(e){}
      st[p].students=stuCloud; changed=true;
    }
    if(yrCloud){
      try{ localStorage.setItem(YKEYS[p],JSON.stringify(yrCloud)); }catch(e){}
      st[p].years=new Set(yrCloud); changed=true;
    }
    if(changed) renderAll();
  }
  // Migrate old localStorage ‚Üí Firestore (one-time)
  async function migrateEcToCloud(p){
    await FirebaseSync.migrateLS(SKEYS[p], SKEYS[p]);
    await FirebaseSync.migrateLS(YKEYS[p], YKEYS[p]);
  }
  // Real-time listener for ecStudents (updates from other devices)
  function listenEcRealtime(p){
    FirebaseSync.listenDoc(SKEYS[p], (data)=>{
      try{ localStorage.setItem(SKEYS[p],JSON.stringify(data)); }catch(e){}
      st[p].students=data; renderAll();
    });
    FirebaseSync.listenDoc(YKEYS[p], (data)=>{
      try{ localStorage.setItem(YKEYS[p],JSON.stringify(data)); }catch(e){}
      st[p].years=new Set(data); renderAll();
    });
  }

  const SUBJ = {
    gate:  ['‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©','‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢'],
    eplus: ['‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©','‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
  };
  const META = {
    gate:  { label:'GATE',  icon:'üìò', color:'#6366f1', desc:'‡∏ß‡∏¥‡∏ó‡∏¢‡πå ¬∑ ‡πÄ‡∏•‡∏Ç ¬∑ ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ¬∑ ‡πÑ‡∏ó‡∏¢' },
    eplus: { label:'EPLUS', icon:'üìó', color:'#f59e0b', desc:'‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ¬∑ ‡∏Ñ‡∏ì‡∏¥‡∏ï ¬∑ ‡∏ß‡∏¥‡∏ó‡∏¢‡πå' },
  };
  const COLORS = ['#6366f1','#f59e0b','#10b981','#ef4444','#8b5cf6','#f97316','#06b6d4','#ec4899'];

  const st = {
    gate:  { students:loadStu('gate'),  years:loadYrs('gate'),  editing:false },
    eplus: { students:loadStu('eplus'), years:loadYrs('eplus'), editing:false },
  };
  // Start in viewing mode if already have students
  st.gate.editing  = st.gate.students.length  === 0;
  st.eplus.editing = st.eplus.students.length === 0;

  let activeProg = state.programId || 'gate';

  // ‚îÄ‚îÄ Stats ‚îÄ‚îÄ
  function getActiveBms(p){ return bms.filter(b=>b.id.includes(p)&&st[p].years.has(b.id.endsWith('69')?'69':'68')); }

  function calcStats(p) {
    const abs=getActiveBms(p), subjs=SUBJ[p];
    if(!abs.length) return null;
    const poolT=[],poolS={};
    abs.forEach(bm=>{
      const meta=BM_META[bm.id]||{};
      bm.rows.filter(r=>r.rank>=1&&r.rank<=meta.admit).forEach(r=>{
        poolT.push(r.total);
        Object.entries(r.subjects||{}).forEach(([k,v])=>{ if(v!=null){if(!poolS[k])poolS[k]=[];poolS[k].push(v);} });
      });
    });
    const avgTotal=poolT.length?poolT.reduce((a,b)=>a+b,0)/poolT.length:0;
    const avgSubj={};
    Object.entries(poolS).forEach(([k,a])=>{ avgSubj[k]=a.reduce((x,y)=>x+y,0)/a.length; });
    const cuts=abs.map(b=>esCutoff(b)).filter(v=>v!=null);
    const avgCutoff=cuts.length?cuts.reduce((a,b)=>a+b,0)/cuts.length:null;
    const bmLabel=abs.map(b=>b.id.endsWith('69')?'‡∏õ‡∏µ 2569':'‡∏õ‡∏µ 2568').join(' + ');
    const maxS={};
    subjs.forEach(s=>{ const v=abs.flatMap(b=>b.rows.map(r=>r.subjects?.[s]||0)); maxS[s]=v.length?Math.max(...v):500; if(maxS[s]<1)maxS[s]=500; });
    const cutoffSubj={};
    subjs.forEach(s=>{
      const vals=abs.flatMap(bm=>{ const m=BM_META[bm.id]||{}; const ct=esCutoff(bm); if(!ct)return []; const zone=bm.rows.filter(r=>r.rank<=m.admit&&r.total<=ct+5&&r.total>=ct-5); const fb=bm.rows.filter(r=>r.rank<=m.admit).slice(-3); return (zone.length?zone:fb).map(r=>r.subjects?.[s]).filter(v=>v!=null); });
      if(vals.length) cutoffSubj[s]=vals.reduce((a,b)=>a+b,0)/vals.length;
    });
    const topTotal=Math.max(...abs.map(b=>b.rows[0]?.total||0),1000);
    return {avgTotal,avgSubj,avgCutoff,cutoffSubj,bmLabel,activeBms:abs,maxS,topTotal};
  }
  const pct=(v,mx)=>Math.min(99.5,Math.max(0,mx>0?v/mx*100:0));

  // ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ
  function renderTabs(){
    const el=document.getElementById('ecProgTabs'); if(!el)return;
    el.innerHTML=['gate','eplus'].map(p=>{
      const m=META[p],on=p===activeProg,cnt=st[p].students.length;
      return `<button onclick="ecSetProg('${p}')" style="padding:10px 22px;border-radius:14px;font-weight:800;font-size:14px;cursor:pointer;border:2px solid ${on?m.color:'var(--border)'};background:${on?m.color:'#fff'};color:${on?'#fff':'#374151'};display:flex;align-items:center;gap:8px;transition:.15s;">${m.icon} ${m.label}${cnt?`<span style="background:${on?'rgba(255,255,255,.3)':'#e5e7eb'};color:${on?'#fff':'#374151'};border-radius:99px;padding:1px 8px;font-size:11px;">${cnt}</span>`:''}</button>`;
    }).join('');
  }
  window.ecSetProg = p => { activeProg=p; renderAll(); };

  // ‚îÄ‚îÄ Section header (year toggles + buttons) ‚îÄ‚îÄ
  function renderHeader(p) {
    const m=META[p], years=st[p].years;
    const yBtns=['69','68'].map(y=>{ if(!bms.some(b=>b.id.includes(p)&&b.id.endsWith(y)))return ''; const on=years.has(y); return `<button onclick="ecToggleYear('${p}','${y}')" style="padding:6px 16px;border-radius:10px;font-size:12px;font-weight:700;cursor:pointer;border:2px solid ${on?m.color:'var(--border)'};background:${on?m.color:'#fff'};color:${on?'#fff':'#374151'};">‡∏õ‡∏µ 25${y}</button>`; }).join('');
    const rightBtns = st[p].editing
      ? `<button class="btn" id="ecAddBtn" style="font-size:13px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
         <button class="btn btnPrimary" id="ecSaveBtn" style="font-size:13px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>`
      : `<button class="btn" id="ecAddBtn" style="font-size:13px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
         <button class="btn" id="ecEditBtn" style="font-size:13px;border-color:${m.color};color:${m.color};">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>`;
    return `<div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:14px;">
      <div><div style="font-weight:900;font-size:15px;color:${m.color};">${m.icon} ${m.label}</div><div class="muted" style="font-size:12px;">${m.desc}</div></div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;"><span style="font-size:12px;font-weight:700;color:#6b7280;">‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö:</span>${yBtns}${rightBtns}</div>
    </div>`;
  }

  // ‚îÄ‚îÄ Active section ‚îÄ‚îÄ
  function renderActiveSection(){
    const el=document.getElementById('ecActiveSection'); if(!el)return;
    const p=activeProg, subjs=SUBJ[p], students=st[p].students;

    let body='';
    if(st[p].editing){
      // Input cards
      if(!students.length){
        body=`<div style="padding:14px;color:#9ca3af;font-size:13px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Äî ‡∏Å‡∏î "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"</div>`;
      } else {
        body=students.map((stu,i)=>{
          const total=subjs.reduce((s,k)=>s+(parseFloat(stu.scores?.[k])||0),0);
          const fields=subjs.map(s=>`<div style="display:grid;gap:4px;flex:1;min-width:90px;"><span style="font-size:11px;font-weight:700;color:#6b7280;">${s}</span><input type="number" min="0" max="1000" step="0.25" class="btn" style="text-align:center;padding:10px;width:100%;border-radius:10px;font-size:15px;font-weight:700;" placeholder="0" value="${stu.scores?.[s]??''}" oninput="ecLiveScore('${p}',${i},'${s}',this.value)"/></div>`).join('');
          return `<div class="card" style="padding:16px;margin-bottom:10px;">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:12px;">
              <input value="${esc(stu.name||'')}" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="btn" style="text-align:left;padding:9px 14px;font-weight:700;border-radius:12px;flex:1;max-width:220px;" oninput="ecLiveName('${p}',${i},this.value)"/>
              <div style="display:flex;gap:8px;align-items:center;">
                <span id="ec-total-${p}-${i}" style="font-weight:900;font-size:16px;">${total.toFixed(2)}<span style="font-size:11px;color:#9ca3af;"> / 1,000</span></span>
                <button class="btn-delete" onclick="ecRemove('${p}',${i})">‡∏•‡∏ö</button>
              </div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">${fields}</div>
          </div>`;
        }).join('');
      }
    } else if(students.length){
      // Compact saved rows
      body=`<div style="display:grid;gap:6px;">${students.map((stu,i)=>{
        const total=subjs.reduce((s,k)=>s+(parseFloat(stu.scores?.[k])||0),0);
        const scoreStr=subjs.map(s=>`<span style="color:#6b7280;font-size:11px;">${s.replace('‡∏†‡∏≤‡∏©‡∏≤','').replace('‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡∏ß‡∏¥‡∏ó‡∏¢‡πå').replace('‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡πÄ‡∏•‡∏Ç')}:</span><b style="font-size:12px;margin-left:2px;">${parseFloat(stu.scores?.[s])||0}</b>`).join('<span style="margin:0 5px;color:#d1d5db;">¬∑</span>');
        return `<div style="display:flex;justify-content:space-between;align-items:center;gap:10px;padding:10px 14px;background:#f9fafb;border-radius:12px;flex-wrap:wrap;">
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;flex:1;">
            <span style="font-weight:800;font-size:14px;">${esc(stu.name||`‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${i+1}`)}</span>
            <div style="display:flex;gap:5px;flex-wrap:wrap;align-items:center;">${scoreStr}</div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="font-weight:900;font-size:15px;">${total.toFixed(0)}<span style="font-size:10px;color:#9ca3af;"> /1000</span></span>
            <button class="btn-delete" onclick="ecRemove('${p}',${i})" style="font-size:11px;padding:4px 10px;">‡∏•‡∏ö</button>
          </div>
        </div>`;
      }).join('')}</div>`;
    }

    el.innerHTML = renderHeader(p) + body;

    document.getElementById('ecAddBtn')?.addEventListener('click',()=>{
      st[p].editing=true; st[p].students.push({id:'s'+Date.now(),name:'',scores:{}});
      renderActiveSection(); renderTabs();
    });
    document.getElementById('ecSaveBtn')?.addEventListener('click',()=>{
      saveStu(p,st[p].students); st[p].editing=false;
      renderAll();
    });
    document.getElementById('ecEditBtn')?.addEventListener('click',()=>{
      st[p].editing=true; renderActiveSection();
    });
  }

  window.ecLiveName  = (p,i,v) => { st[p].students[i].name=v; };
  window.ecLiveScore = (p,i,s,v) => {
    if(!st[p].students[i].scores) st[p].students[i].scores={};
    st[p].students[i].scores[s]=v===''?null:parseFloat(v);
    const tot=SUBJ[p].reduce((a,k)=>a+(parseFloat(st[p].students[i].scores?.[k])||0),0);
    const el=document.getElementById(`ec-total-${p}-${i}`);
    if(el) el.innerHTML=tot.toFixed(2)+'<span style="font-size:11px;color:#9ca3af;"> / 1,000</span>';
  };
  window.ecRemove = (p,i) => {
    st[p].students.splice(i,1); saveStu(p,st[p].students);
    if(!st[p].students.length) st[p].editing=false;
    renderAll();
  };
  window.ecToggleYear = (p,y) => {
    if(st[p].years.has(y)) st[p].years.delete(y); else st[p].years.add(y);
    saveYrs(p,st[p].years); renderActiveSection(); renderBottom();
  };

  // ‚îÄ‚îÄ Individual compare cards ‚îÄ‚îÄ
  function renderCompareResults(){
    const el=document.getElementById('ecCompareResults'); if(!el)return;
    const p=activeProg, students=st[p].students;
    if(!students.length || st[p].editing){ el.innerHTML=''; return; }
    const stats=calcStats(p); if(!stats){el.innerHTML='';return;}
    const {avgTotal,avgSubj,avgCutoff,cutoffSubj,bmLabel,maxS,topTotal}=stats;
    const subjs=SUBJ[p], m=META[p];

    el.innerHTML=students.map((stu,i)=>{
      const total=subjs.reduce((s,k)=>s+(parseFloat(stu.scores?.[k])||0),0);
      const name=stu.name||`‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${i+1}`;
      const gap=avgCutoff!=null?total-avgCutoff:null;
      const gapCol=gap==null?'#9ca3af':gap>=0?'#16a34a':'#dc2626';
      const gapTxt=gap==null?'‚Äî':gap>=0?`+${gap.toFixed(2)} (‡πÄ‡∏Å‡∏¥‡∏ô cutoff)`:`${gap.toFixed(2)} (‡∏Ç‡∏≤‡∏î ${Math.abs(gap).toFixed(2)})`;
      const chance=!avgCutoff||!total?'‚Äî':total/avgCutoff>=1?'üü¢ ‡πÄ‡∏Å‡∏¥‡∏ô cutoff':total/avgCutoff>=.9?'üü° ‡πÉ‡∏Å‡∏•‡πâ cutoff (‚â•90%)':total/avgCutoff>=.75?'üü† ‡∏´‡πà‡∏≤‡∏á‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£':'üî¥ ‡∏¢‡∏±‡∏á‡∏´‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å (<75%)';
      const pS=pct(total,topTotal), pC=avgCutoff?pct(avgCutoff,topTotal):null, pA=pct(avgTotal,topTotal);
      const tbCol=gap!=null&&gap>=0?'#16a34a':'#dc2626';

      const subjBars=subjs.map(s=>{
        const sc=parseFloat(stu.scores?.[s])||0, avg=avgSubj[s]||0, coff=cutoffSubj[s]??null, diff=sc-avg;
        const bc=diff>=0?'#16a34a':'#dc2626', dc=diff>=0?'#15803d':'#dc2626', mx=maxS[s]||500;
        return `<div style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:4px;">
            <span style="font-weight:700;">${s}</span>
            <span><b>${sc.toFixed(2)}</b><span style="color:${dc};font-size:11px;margin-left:4px;">(${diff>=0?'+':''}${diff.toFixed(1)} ‡∏à‡∏≤‡∏Å avg)</span></span>
          </div>
          <div style="position:relative;height:12px;background:#e5e7eb;border-radius:99px;overflow:visible;">
            <div style="height:100%;width:${pct(sc,mx)}%;background:${bc};border-radius:99px;"></div>
            ${coff!=null?`<div style="position:absolute;top:-3px;left:${pct(coff,mx)}%;width:3px;height:18px;background:#f97316;border-radius:2px;"></div>`:''}
            <div style="position:absolute;top:-3px;left:${pct(avg,mx)}%;width:3px;height:18px;background:#1f2937;border-radius:2px;"></div>
          </div>
          <div style="display:flex;gap:10px;font-size:10px;color:#6b7280;margin-top:2px;">
            <span>avg ‡∏Ñ‡∏ô‡∏ï‡∏¥‡∏î: <b>${avg.toFixed(1)}</b></span>
            ${coff!=null?`<span><span style="display:inline-block;width:8px;height:8px;background:#f97316;border-radius:2px;margin-right:2px;"></span>cutoff: <b>${coff.toFixed(1)}</b></span>`:''}
          </div></div>`;
      }).join('');

      return `<div class="card" style="padding:20px;border-top:4px solid ${m.color};">
        <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:10px;">
          <div>
            <div style="font-size:11px;font-weight:800;color:${m.color};">${m.label}</div>
            <div style="font-weight:900;font-size:17px;">${esc(name)}</div>
            <div class="muted" style="font-size:12px;">‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö ${bmLabel}</div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:22px;font-weight:900;">${total.toFixed(2)}<span style="font-size:13px;color:#9ca3af;"> / 1,000</span></div>
            <div style="font-size:13px;color:${gapCol};font-weight:700;">${gapTxt}</div>
          </div>
        </div>
        <div style="padding:9px 14px;background:#f9fafb;border-radius:10px;font-size:13px;margin-bottom:14px;">
          ${chance}&nbsp;&nbsp;¬∑&nbsp;&nbsp;cutoff: <b>${avgCutoff?avgCutoff.toFixed(0):'‚Äî'}</b>&nbsp;&nbsp;¬∑&nbsp;&nbsp;avg ‡∏Ñ‡∏ô‡∏ï‡∏¥‡∏î: <b>${avgTotal.toFixed(0)}</b>
        </div>
        <div style="margin-bottom:14px;">
          <div style="display:flex;justify-content:space-between;font-size:13px;font-weight:700;margin-bottom:4px;"><span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</span><span>${total.toFixed(2)} / 1,000</span></div>
          <div style="position:relative;height:15px;background:#e5e7eb;border-radius:99px;overflow:visible;">
            <div style="height:100%;width:${pS}%;background:${tbCol};border-radius:99px;"></div>
            ${pC?`<div style="position:absolute;top:-3px;left:${pC}%;width:3px;height:21px;background:#f97316;border-radius:2px;"></div>`:''}
            <div style="position:absolute;top:-3px;left:${pA}%;width:3px;height:21px;background:#1f2937;border-radius:2px;"></div>
          </div>
          <div style="display:flex;gap:12px;font-size:10px;color:#6b7280;margin-top:3px;">
            <span><span style="display:inline-block;width:8px;height:8px;background:#f97316;border-radius:2px;margin-right:3px;"></span>cutoff ${avgCutoff?avgCutoff.toFixed(0):'‚Äî'}</span>
            <span><span style="display:inline-block;width:8px;height:8px;background:#1f2937;border-radius:2px;margin-right:3px;"></span>avg ${avgTotal.toFixed(0)}</span>
          </div>
        </div>
        <div style="border-top:1px solid #e5e7eb;margin:10px 0 12px;"></div>
        ${subjBars}</div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ Overview: ranking + HTML-only grouped bar chart (no canvas) ‚îÄ‚îÄ
  function renderOverviewChart(){
    const el=document.getElementById('ecOverviewChart'); if(!el)return;
    const p=activeProg, students=st[p].students.filter(s=>s.name);
    if(!students.length||st[p].editing){el.innerHTML='';return;}
    const stats=calcStats(p); if(!stats){el.innerHTML='';return;}
    const {avgTotal,avgCutoff,topTotal,maxS,avgSubj,cutoffSubj}=stats;
    const subjs=SUBJ[p], m=META[p];

    const ranked=[...students].map((stu,oi)=>{
      const total=subjs.reduce((s,k)=>s+(parseFloat(stu.scores?.[k])||0),0);
      return {...stu,total,oi};
    }).sort((a,b)=>b.total-a.total);

    // ‚îÄ‚îÄ Ranking list ‚îÄ‚îÄ
    const rankRows=ranked.map((stu,ri)=>{
      const gap=avgCutoff?stu.total-avgCutoff:null;
      const gapCol=gap==null?'#9ca3af':gap>=0?'#16a34a':'#dc2626';
      const badge=ri===0?'ü•á':ri===1?'ü•à':ri===2?'ü•â':`${ri+1}`;
      const pct2=avgCutoff?Math.round(stu.total/avgCutoff*100):null;
      const bW=Math.min(99.5,stu.total/topTotal*100);
      const bc=gap!=null&&gap>=0?'#16a34a':'#dc2626';
      return `<div style="padding:10px 12px;border-bottom:1px solid #f3f4f6;background:${ri%2?'#fafafa':'#fff'};">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:5px;">
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="font-size:15px;min-width:26px;">${badge}</span>
            <span style="font-weight:800;font-size:14px;">${esc(stu.name||`‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${stu.oi+1}`)}</span>
            ${pct2!=null?`<span style="font-size:11px;color:#6b7280;">(${pct2}% of cutoff)</span>`:''}
          </div>
          <div style="font-weight:900;font-size:15px;"><span style="color:${gapCol}">${stu.total.toFixed(0)}</span><span style="font-size:11px;margin-left:6px;color:${gapCol}">${gap==null?'':gap>=0?`+${gap.toFixed(0)}`:gap.toFixed(0)}</span></div>
        </div>
        <div style="position:relative;height:8px;background:#e5e7eb;border-radius:99px;overflow:visible;">
          <div style="height:100%;width:${bW}%;background:${bc};border-radius:99px;"></div>
          ${avgCutoff?`<div style="position:absolute;top:-2px;left:${Math.min(99,avgCutoff/topTotal*100)}%;width:2px;height:12px;background:#f97316;border-radius:1px;"></div>`:''}
          ${avgTotal?`<div style="position:absolute;top:-2px;left:${Math.min(99,avgTotal/topTotal*100)}%;width:2px;height:12px;background:#1f2937;border-radius:1px;"></div>`:''}
        </div>
      </div>`;
    }).join('');

    // ‚îÄ‚îÄ Grouped bar chart: pure HTML divs ‚îÄ‚îÄ
    // X axis = subjects, each subject has N bars (one per student)
    const globalMax=Math.max(...ranked.flatMap(stu=>subjs.map(s=>parseFloat(stu.scores?.[s])||0)),1);

    const groupedBars=subjs.map(s=>{
      const avg_s=avgSubj[s]||0, coff_s=cutoffSubj[s]??null, mx=maxS[s]||globalMax;
      const barH=140; // px, max height of chart area
      const avgPct=avg_s/mx*100, coffPct=coff_s!=null?coff_s/mx*100:null;

      const bars=ranked.map((stu,ri)=>{
        const sc=parseFloat(stu.scores?.[s])||0;
        const h=Math.max(0,sc/mx*barH);
        const bc=COLORS[ri%COLORS.length];
        const isAboveAvg=sc>=avg_s;
        return `<div style="display:flex;flex-direction:column;align-items:center;gap:3px;flex:1;min-width:28px;max-width:48px;">
          <span style="font-size:9px;font-weight:700;color:#374151;">${sc>0?sc.toFixed(0):''}</span>
          <div style="width:100%;height:${barH}px;display:flex;align-items:flex-end;position:relative;">
            <div style="width:100%;height:${h}px;background:${bc};border-radius:4px 4px 0 0;opacity:${isAboveAvg?1:0.7};position:relative;z-index:1;"></div>
            <!-- avg line -->
            <div style="position:absolute;bottom:${avgPct}%;left:0;right:0;height:2px;background:#1f2937;z-index:2;"></div>
            ${coffPct!=null?`<div style="position:absolute;bottom:${coffPct}%;left:0;right:0;height:2px;background:#f97316;z-index:2;"></div>`:''}
          </div>
          <span style="font-size:9px;color:${bc};font-weight:700;text-align:center;max-width:40px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">${esc((stu.name||'').split('')[0]||`#${ri+1}`)}</span>
        </div>`;
      }).join('');

      return `<div style="flex:1;min-width:80px;max-width:200px;display:flex;flex-direction:column;align-items:center;gap:6px;padding:8px 6px;border-right:1px solid #f3f4f6;">
        <div style="display:flex;align-items:flex-end;gap:3px;width:100%;justify-content:center;">${bars}</div>
        <div style="font-weight:700;font-size:11px;color:#374151;text-align:center;">${s.replace('‡∏†‡∏≤‡∏©‡∏≤','').replace('‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡∏ß‡∏¥‡∏ó‡∏¢‡πå').replace('‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡πÄ‡∏•‡∏Ç')}</div>
        <div style="font-size:10px;color:#6b7280;">avg: <b>${avg_s.toFixed(0)}</b>${coff_s!=null?` ¬∑ cut: <b>${coff_s.toFixed(0)}</b>`:''}</div>
      </div>`;
    }).join('');

    // subject avg table
    const subjTable=subjs.map(s=>{
      const vals=ranked.map(st=>parseFloat(st.scores?.[s])||0);
      const mx=Math.max(...vals), mn=Math.min(...vals), av=vals.reduce((a,b)=>a+b,0)/vals.length;
      return `<tr style="border-bottom:1px solid #f3f4f6;">
        <td style="padding:6px 8px;font-weight:700;font-size:12px;">${s.replace('‡∏†‡∏≤‡∏©‡∏≤','').replace('‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡∏ß‡∏¥‡∏ó‡∏¢‡πå').replace('‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå','‡πÄ‡∏•‡∏Ç')}</td>
        <td style="text-align:center;padding:6px;font-size:12px;color:#6b7280;">${(avgSubj[s]||0).toFixed(1)}</td>
        <td style="text-align:center;padding:6px;font-size:12px;font-weight:700;color:#16a34a;">${mx.toFixed(0)}</td>
        <td style="text-align:center;padding:6px;font-size:12px;font-weight:700;color:#dc2626;">${mn.toFixed(0)}</td>
        <td style="text-align:center;padding:6px;font-size:12px;">${av.toFixed(1)}</td>
      </tr>`;
    }).join('');

    el.innerHTML=`
      <div class="hr" style="margin:28px 0;"></div>
      <div style="font-weight:900;font-size:16px;margin-bottom:4px;">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ${m.label} ‚Äî ${ranked.length} ‡∏Ñ‡∏ô</div>
      <div style="font-size:11px;color:#6b7280;margin-bottom:16px;">
        <span style="display:inline-block;width:10px;height:10px;background:#f97316;border-radius:2px;margin-right:4px;vertical-align:middle;"></span>cutoff ${avgCutoff?avgCutoff.toFixed(0):'‚Äî'}
        &nbsp;&nbsp;<span style="display:inline-block;width:10px;height:10px;background:#1f2937;border-radius:2px;margin-right:4px;vertical-align:middle;"></span>avg ‡∏Ñ‡∏ô‡∏ï‡∏¥‡∏î ${avgTotal.toFixed(0)}
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;min-width:0;">
        <div class="card" style="padding:0;overflow:hidden;min-width:200px;">
          <div style="padding:10px 14px;font-weight:800;font-size:13px;border-bottom:1px solid #e5e7eb;">üèÜ ‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</div>
          ${rankRows}
        </div>
        <div class="card" style="padding:16px;">
          <div style="font-weight:800;font-size:13px;margin-bottom:10px;">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</div>
          <table style="width:100%;border-collapse:collapse;font-size:12px;">
            <thead><tr style="border-bottom:2px solid #e5e7eb;">
              <th style="text-align:left;padding:4px 8px;color:#6b7280;">‡∏ß‡∏¥‡∏ä‡∏≤</th>
              <th style="text-align:center;padding:4px;color:#6b7280;">avg<br>‡∏Ñ‡∏ô‡∏ï‡∏¥‡∏î</th>
              <th style="text-align:center;padding:4px;color:#16a34a;">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</th>
              <th style="text-align:center;padding:4px;color:#dc2626;">‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</th>
              <th style="text-align:center;padding:4px;color:#6b7280;">avg<br>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
            </tr></thead>
            <tbody>${subjTable}</tbody>
          </table>
        </div>
      </div>

      <div class="card" style="padding:16px;">
        <div style="font-weight:800;font-size:13px;margin-bottom:4px;">üìà ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</div>
        <div style="font-size:11px;color:#6b7280;margin-bottom:12px;">‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏° = 1 ‡∏ß‡∏¥‡∏ä‡∏≤ ¬∑ ‡∏™‡∏µ = ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ¬∑ ‡πÄ‡∏™‡πâ‡∏ô üü† cutoff ¬∑ ‡πÄ‡∏™‡πâ‡∏ô ‚¨õ avg ‡∏Ñ‡∏ô‡∏ï‡∏¥‡∏î</div>
        <!-- Legend -->
        <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px;">
          ${ranked.map((stu,ri)=>`<span style="display:flex;align-items:center;gap:4px;font-size:11px;font-weight:700;"><span style="display:inline-block;width:12px;height:12px;background:${COLORS[ri%COLORS.length]};border-radius:3px;"></span>${esc(stu.name||`#${ri+1}`)}</span>`).join('')}
          <span style="display:flex;align-items:center;gap:4px;font-size:11px;margin-left:6px;"><span style="display:inline-block;width:16px;height:2px;background:#f97316;"></span>cutoff</span>
          <span style="display:flex;align-items:center;gap:4px;font-size:11px;"><span style="display:inline-block;width:16px;height:2px;background:#1f2937;border-top:2px dashed #1f2937;"></span>avg ‡∏Ñ‡∏ô‡∏ï‡∏¥‡∏î</span>
        </div>
        <!-- Grouped bars (pure HTML) -->
        <div style="display:flex;gap:4px;align-items:flex-end;overflow-x:auto;padding-bottom:4px;">${groupedBars}</div>
      </div>`;
  }

  function renderBottom(){ renderCompareResults(); renderOverviewChart(); }
  function renderAll(){ renderTabs(); renderActiveSection(); renderBottom(); }

  // ‚îÄ‚îÄ Firebase: migrate, sync latest, then listen for real-time changes ‚îÄ‚îÄ
  if(FirebaseSync.ready()){
    migrateEcToCloud('gate');
    migrateEcToCloud('eplus');
    syncEcFromCloud('gate');
    syncEcFromCloud('eplus');
    listenEcRealtime('gate');
    listenEcRealtime('eplus');
  }

  renderAll();
}













</script>
</body>
</html>

